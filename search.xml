<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[使用 ZFile 搭建自己的文件分享站（Linux & Windows）]]></title>
    <url>%2Fsetting-up-your-own-netdisk-by-zfile-on-windows-and-linux%2F</url>
    <content type="text"><![CDATA[网盘目录程序各式各样，这里分享一个页面简洁大方的在线网盘项目 Z-File。 此项目是一个在线文件目录的程序，支持各种对象存储和本地存储，使用定位是个人放常用工具下载，或做公共的文件库。不会向多账户方向开发。 前端基于 h5ai 的原有功能使用 Vue 重新开发了一遍。后端采用 SpringBoot，数据库采用内嵌数据库。 为适应不同场景下需求，分别在 Linux 以及 Windows 中进行测试。 准备工作 FTP 服务器 Windows 自带的的 Internet Information Services (IIS) 搭建 FTP 服务器会出现中文文件名乱码、认证错误等问题，于是转向开源的 FileZilla Server 搭建 FTP 服务器。 Linux 部署 ZFile 安装依赖 123456# CentOS系统yum install -y java-1.8.0-openjdk unzip# Debian/Ubuntu系统apt updateapt install -y openjdk-8-jre-headless unzip 下载项目 123wget -P https://c.jun6.net/ZFILE/zfile-release.warmkdir zfile &amp;&amp; unzip zfile-release.war -d zfilechmod +x zfile/bin/*.sh 常用命令 123~/zfile/bin/start.sh # 启动项目~/zfile/bin/stop.sh # 停止项目~/zfile/bin/restart.sh # 重启项目 后台配置 运行 start.sh 启动程序，进入网页端 http://&lt;ip:port&gt; 设置后台管理账密（前端端口在 zfile/WEB-INF/classes/application.xml 中配置，默认为 8080），后台管理界面网址为：http://&lt;ip:port&gt;/#/admin。通过「驱动器列表」页面新增驱动器并进行必要配置，即可在前端显示目录内容。 挂载 FTP 驱动器 默认情况下挂载的 FTP 驱动器在前端下载协议为 ftp:// ，部分客户端浏览器不支持 ftp 协议下载，且 ftp 协议下载链接会暴露用户名密码，故 Zfile 提供「加速域名」的方式，即事先实现以 HTTP 方式访问 FTP 目录，用户通过 HTTP 进行下载从而隐藏敏感信息。而实际情况中 FTP 服务器可能无法搭建 HTTP 服务，故考虑将远程 FTP 挂载到本地目录，在 Zfile 管理界面新增本地存储的方式进行展示。 下面利用 curlftpfs 挂载 FTP 服务器： 1234567891011# 在线安装yum install -y epel-releaseyum install -y curlftpfs# 离线安装# yum install --downloadonly curlftpfs --downloaddir=.# 挂载 FTP 目录mkdir -p $MOUNTPOINTcurlftpfs $IP:$PORT $MOUNTPOINT -o user=$USERNAME:$PASSWORD,codepage=utf8# 取消挂载fusermount -u $MOUNTPOINT Windows 部署 ZFile 12java -Dfile.encoding=utf-8 -jar -Dserver.port=8080 .\zfile-release.jar# 如需要修改配置文件, 可去 Github 复制一份配置文件, 放到 jar 文件同路径即可. 挂载 FTP 驱动器 与 Linux 下同理，相应需安装 Rclone 及 WinFsp，配置过程不再赘述。]]></content>
      <categories>
        <category>Handy Utilities</category>
      </categories>
      <tags>
        <tag>ZFile</tag>
        <tag>FTP</tag>
        <tag>Fuse</tag>
        <tag>NetDisk</tag>
        <tag>FileZilla</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows 下多网卡路由表设置]]></title>
    <url>%2Fsettings-of-multi-nic-and-routing-table-on-windows%2F</url>
    <content type="text"><![CDATA[经常遇到这样的情形：办公网与外网不通，办公时如需连外网查资料，不得不来回切换网络或通过其他设备上外网再回到办公电脑前，来回折腾苦不堪言。自然产生需求：同一台设备如何同时连接办公内网及外网？ 实验配置 内网端：办公网口 / 可分享网络的办公用电脑 外网端：连通外网的路由器 / 热点 / 移动设备 USB 分享 / 其他可连至外网的设备或信号 多网卡计算机 其中内网端可为办公网口，通过网线接入目标笔记本；但一般情况下公司会提供办公专用笔记本，通过网络共享技术，可将办公网络共享给通过网线与之相连的设备。外网端顾名思义，可使目标笔记本上外网的设备或手段。多网卡设备中的「多网卡」可以认为是以太网（Ethernet）及无线网（Wi-Fi）或其他计算机中的网络设备。 实验场景一：个人电脑通过办公电脑上公司内网 首先从简单的场景实验开始：办公电脑 A 通过 Wi-Fi 连接公司内网，并通过网线与个人电脑 B 相连。 将办公电脑 A 中网络适配器设置的 Wi-Fi 适配器（设备名可能不同）共享打开：属性 - 共享 - 勾选允许网络用户通过该电脑连接至网络。此时电脑 A 的以太网适配器会将 IP 设置为 192.168.137.1。 在电脑 B 中的以太网设置中： 自动获取 IP 地址 / DNS 服务器地址 如需固定 IP 地址，则需将默认网关及 DNS 服务器设置为 192.168.137.1 实验场景二：设置个人电脑内网外网均可访问 有了实验一的经验，可否简单地将外网网线接入个人电脑，并成功访问外网及内网？ 此时打开个人电脑 Wi-Fi，发现外网可访问，但实验一中的内网网址无法访问了。管理员权限下在 cmd 中输入 1route print -4 可获取路由表信息（IPv4）： 12345678910111213141516171819202122232425262728293031323334===========================================================================Interface List 15...xx xx xx xx xx xx ......Realtek PCIe GbE Family Controller 32...xx xx xx xx xx xx ......Microsoft Wi-Fi Direct Virtual Adapter 16...xx xx xx xx xx xx ......Realtek 8821CE Wireless LAN 802.11ac PCI-E NIC 1...........................Software Loopback Interface 1===========================================================================IPv4 Route Table===========================================================================Active Routes:Network Destination Netmask Gateway Interface Metric 0.0.0.0 0.0.0.0 192.168.137.1 192.168.137.101 281 0.0.0.0 0.0.0.0 192.168.8.1 192.168.8.101 50 127.0.0.0 255.0.0.0 On-link 127.0.0.1 331 127.0.0.1 255.255.255.255 On-link 127.0.0.1 331 127.255.255.255 255.255.255.255 On-link 127.0.0.1 331 192.168.8.0 255.255.255.0 On-link 192.168.8.101 306 192.168.8.101 255.255.255.255 On-link 192.168.8.101 306 192.168.8.255 255.255.255.255 On-link 192.168.8.101 306 192.168.137.0 255.255.255.0 On-link 192.168.137.101 281 192.168.137.101 255.255.255.255 On-link 192.168.137.101 281 192.168.137.255 255.255.255.255 On-link 192.168.137.101 281 224.0.0.0 240.0.0.0 On-link 127.0.0.1 331 224.0.0.0 240.0.0.0 On-link 192.168.8.101 306 224.0.0.0 240.0.0.0 On-link 192.168.137.101 281 255.255.255.255 255.255.255.255 On-link 127.0.0.1 331 255.255.255.255 255.255.255.255 On-link 192.168.8.101 306 255.255.255.255 255.255.255.255 On-link 192.168.137.101 281===========================================================================Persistent Routes: Network Address Netmask Gateway Address Metric 0.0.0.0 0.0.0.0 192.168.137.1 Default=========================================================================== 可以看到针对目的网段 0.0.0.0，活动路由中存在 2 条路由设定。Windows 下默认网关是指发往 0.0.0.0 缺省网段的地址，其目的地为所有未知路由的网段，所以设置了 2 个默认网关之后，其中的一个网关将被启用，而另外一个将作为冗余。所以在浏览器中试图访问内网时，例如访问 IP 为 10.30.10.101，系统在 2 条路由中挑选一条进行访问，系统会偏向跳数（Metric）较小的路由进行访问，在测试中的情况即为网关为外网的这条路由，导致内网无法访问。 解决方案 针对 0.0.0.0 网段进行针对性设置，如默认网段走外网 192.168.8.1，而内网网段走内网 192.168.137.1 针对内网网段，设定网关为内网 192.168.137.1 例如，公司内网网段为 10.30.*.*，首先删除路由为 0.0.0.0 的 2 条记录，并添加默认网段的路由网关为 192.168.8.1，内网网段的路由网关为 192.168.137.1。需要注意的是命令中的接口号是否与实际情况相对应。 1234route delete 0.0.0.0route add -p 0.0.0.0 mask 0.0.0.0 192.168.8.1 IF 16route add -p 10.30.0.0 mask 255.255.0.0 192.168.137.1 IF 15route add -p 192.168.137.0 mask 255.255.255.0 192.168.137.1 IF 15 设定后的路由表： 1234567891011121314151617181920212223242526IPv4 Route Table===========================================================================Active Routes:Network Destination Netmask Gateway Interface Metric 0.0.0.0 0.0.0.0 192.168.8.1 192.168.8.101 51 10.30.0.0 255.255.0.0 192.168.137.1 192.168.137.101 26 127.0.0.0 255.0.0.0 On-link 127.0.0.1 331 127.0.0.1 255.255.255.255 On-link 127.0.0.1 331 127.255.255.255 255.255.255.255 On-link 127.0.0.1 331 192.168.8.0 255.255.255.0 On-link 192.168.8.101 306 192.168.8.101 255.255.255.255 On-link 192.168.8.101 306 192.168.8.255 255.255.255.255 On-link 192.168.8.101 306 192.168.137.0 255.255.255.0 192.168.137.1 192.168.137.101 26 192.168.137.101 255.255.255.255 On-link 192.168.137.101 281 224.0.0.0 240.0.0.0 On-link 127.0.0.1 331 224.0.0.0 240.0.0.0 On-link 192.168.8.101 306 224.0.0.0 240.0.0.0 On-link 192.168.137.101 281 255.255.255.255 255.255.255.255 On-link 127.0.0.1 331 255.255.255.255 255.255.255.255 On-link 192.168.8.101 306 255.255.255.255 255.255.255.255 On-link 192.168.137.101 281===========================================================================Persistent Routes: Network Address Netmask Gateway Address Metric 192.168.137.0 255.255.255.0 192.168.137.1 1 10.30.0.0 255.255.0.0 192.168.137.1 1 0.0.0.0 0.0.0.0 192.168.8.1 1 GUI 程序设定路由表 NetRouteView - Network Route Utility for Windows]]></content>
      <categories>
        <category>Research</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>Routing</tag>
        <tag>NetMask</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MacOS 安装 Homebrew]]></title>
    <url>%2Fhomebrew-installation-on-macos%2F</url>
    <content type="text"><![CDATA[The Missing Package Manager for macOS (or Linux) — Homebrew 作为一名业余的 Mac User，怎能不会熟练使用 Homebrew？但国内访问官方 Homebrew 速度过慢，需通过更改 Homebrew 安装源为国内源解决，以下操作主要借鉴成功解决macos 安装homebrew速度慢。 下载 Homebrew 安装脚本 目前官方已经不推荐利用 Ruby 脚本的方式去安装 Homebrew 了，首先通过科技手段直接下载 install.sh。 修改 Homebrew 源 将脚本 install.sh 中的 1BREW_REPO="https://github.com/Homebrew/brew" 改为 1BREW_REPO="https://mirrors.ustc.edu.cn/brew.git" 执行安装脚本 12chmod +x install.sh./install.sh 脚本会停在 12==&gt; Tapping homebrew/coreCloning into ‘/usr/local/Homebrew/Library/Taps/homebrew/homebrew-core’ 此时关闭当前进程，从国内源拉取 homebrew-core： 1git clone git://mirrors.ustc.edu.cn/homebrew-core.git/ /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core --depth=1 将 brew 切换到国内镜像源 123456# 步骤一cd "$(brew --repo)"git remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.gitcd "$(brew --repo)/Library/Taps/homebrew/homebrew-core"git remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.gitbrew update ENJOY!]]></content>
      <tags>
        <tag>MacOS</tag>
        <tag>Homebrew</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows 下 Haskell-stack 开发环境搭建]]></title>
    <url>%2Fsetting-up-haskell-stack-development-environment%2F</url>
    <content type="text"><![CDATA[An advanced, purely functional programming language 抛却「Haskell 语言能装逼」这一光环，笔者认为学习 Haskell 的另一主要动机在于尝试体验另一种编程思维，即「做什么」而非「怎么做」，Haskell 写出的程序更像是人脑的思维而不是机器的思维。当然了，装 x 也 hin 重要。 目前 Haskell 官方下载页 推荐三种下载方案： 最小安装程序 stack Haskell 平台 总体而言，Haskell 在 *nix / OS X 操作系统下的生态优于 Windows 环境，但对于熟悉 Windows 操作、醉心于各类工具流的笔者而言，必须要在 Windows 系统下完成环境搭建。为方便后续各类包的安装更新等操作，这里采用 Cabal 的替代品 – stack。以下诸多关键操作均参考 Arvind Devarajan 的博客。 预热 在 Windows 操作系统环境中，如果没有设定环境变量 STACK_ROOT，则通过 stack 下载的程序文件以及包快照会被存放在 %LOCALAPPDATA%\Programs\stack 以及 %APPDATA%\stack 目录下。经常变动的包安放在系统盘总会令人不安，也不便于管理。所以在首次使用 stack 之前，应设定环境变量 STACK_ROOT，这里笔者将其设为 F:\HaskellStack。另外推荐设定编译器 GHC 的下载安装目录，见后文 config.yaml 文件的配置。（stack 帮助文档关于此问题的说明） 配置 这里有几点关于我个人在开发过程中的习惯配置。 提前安装好 MSYS2 作为 C/C++ 等工具的开发环境，并添加至环境变量 PATH。详细配置过程见 MSYS2 的日常操作 将一个包含常用可执行文件的目录加入环境变量 PATH，如 F:\WorkingDirectory\Bin stack 默认使用的软件源在国外，这里换上国内的清华大学开源网站镜像。由于之前已设定了 STACK_ROOT 环境变量，首次运行 stack 会在此目录下生成一些文件，修改 config.yaml 文件： %STACK_ROOT%\config.yaml123456789101112131415setup-info: "http://mirrors.tuna.tsinghua.edu.cn/stackage/stack-setup.yaml"urls: latest-snapshot: http://mirrors.tuna.tsinghua.edu.cn/stackage/snapshots.json lts-build-plans: http://mirrors.tuna.tsinghua.edu.cn/stackage/lts-haskell/ nightly-build-plans: http://mirrors.tuna.tsinghua.edu.cn/stackage/stackage-nightly/package-indices: - name: Tsinghua download-prefix: http://mirrors.tuna.tsinghua.edu.cn/hackage/package/ http: http://mirrors.tuna.tsinghua.edu.cn/hackage/00-index.tar.gzskip-msys: truelocal-programs-path: F:\HaskellStack\programslocal-bin-path: F:\WorkingDirectory\Bin 以上参考 stackage 镜像使用帮助 以及 hackage 镜像使用帮助。另作几点说明： Windows 下的 stack 会自动安装 MSYS2，由于之前已在机器中安装过，故在配置中跳过 MSYS 的安装 通过 stack install 生成的可执行文件默认在 %APPDATA% 目录下，这里统一放置于之前提到的可执行文件合集目录中 执行 stack setup 下载最新版的 GHC，目前版本为 8.4.3。 如一切顺利，stack path 输出如下： 1234567891011121314151617181920212223stack-root: F:\HaskellStackproject-root: F:\HaskellStack\global-projectconfig-location: F:\HaskellStack\global-project\stack.yamlbin-path: .;F:\HaskellStack\snapshots\55eb7f36\bin;F:\HaskellStack\compiler-tools\x86_64-windows\ghc-8.4.3\bin;F:\HaskellStack\programs\x86_64-windows\ghc-8.4.3\bin;F:\HaskellStack\programs\x86_64-windows\ghc-8.4.3\mingw\bin;C:\Windows\system32;...programs: F:\HaskellStack\programs\x86_64-windowscompiler-exe: F:\HaskellStack\programs\x86_64-windows\ghc-8.4.3\bin\ghc.EXEcompiler-bin: F:\HaskellStack\programs\x86_64-windows\ghc-8.4.3\bincompiler-tools-bin: F:\HaskellStack\compiler-tools\x86_64-windows\ghc-8.4.3\binlocal-bin: F:\WorkingDirectory\Binextra-include-dirs:extra-library-dirs:snapshot-pkg-db: F:\HaskellStack\snapshots\55eb7f36\pkgdblocal-pkg-db: F:\HaskellStack\global-project\.stack-work\install\620260b6\pkgdbglobal-pkg-db: F:\HaskellStack\programs\x86_64-windows\ghc-8.4.3\lib\package.conf.dghc-package-path: F:\HaskellStack\global-project\.stack-work\install\620260b6\pkgdb;F:\HaskellStack\snapshots\55eb7f36\pkgdb;F:\HaskellStack\programs\x86_64-windows\ghc-8.4.3\lib\package.conf.dsnapshot-install-root: F:\HaskellStack\snapshots\55eb7f36local-install-root: F:\HaskellStack\global-project\.stack-work\install\620260b6snapshot-doc-root: F:\HaskellStack\snapshots\55eb7f36\doclocal-doc-root: F:\HaskellStack\global-project\.stack-work\install\620260b6\docdist-dir: .stack-work\dist\7d103d30local-hpc-root: F:\HaskellStack\global-project\.stack-work\install\620260b6\hpclocal-bin-path: F:\WorkingDirectory\Binghc-paths: F:\HaskellStack\programs\x86_64-windows 最后，如要修改 GHCi 的命令行提示符或在启动时加载某些包，可通过添加 / 修改 %APPDATA%\ghc\ghci.conf 文件为以下内容： ghci.conf1234import Text.Show.Pretty (ppShow, pPrint):set -interactive-print pPrint:set prompt &quot;|&gt; &quot; 编辑器 考虑编辑效率和插件生态，推荐使用 VSCode 作为主力编辑器。安装插件： Haskell Syntax Highlight Haskelly hindent-format brittany 后两者为代码格式化插件，任选一即可。 hindent-format 貌似不能正确读取配置文件，故手动修改之（当前版本 0.0.8） hindent-format 插件修改后代码 extension.js12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697'use strict';Object.defineProperty(exports, "__esModule", &#123; value: true &#125;);const vscode = require("vscode");const child_process = require("child_process");const path = require("path");class HindentFormatEditsProvider &#123; constructor() &#123; this.hindentAvailable = false; this.enable = true; this.command = "hindent"; this.arguments = []; this.configure(); &#125; configure() &#123; const config = vscode.workspace.getConfiguration('hindent-format'); this.enable = config.get('enable', true); this.command = config.get('command', 'hindent'); this.arguments = [ "--indent-size", "4", "--line-length", 100 ]; if (this.enable) &#123; let result = child_process.spawnSync(this.command, ['--version']); if (!result.status) &#123; this.hindentAvailable = true; console.log("hindent-format: using executable: " + this.command); &#125; else &#123; this.hindentAvailable = false; vscode.window.showWarningMessage("hindent-format: cannot execute hindent command: " + this.command); &#125; &#125; &#125; formatHindent(text) &#123; let cwd = '.'; // May this helps hindent pick up the .hindent.yaml file if (vscode.window.activeTextEditor) &#123; let documentPath = vscode.window.activeTextEditor.document.uri.fsPath; cwd = path.dirname(documentPath); &#125; let result = child_process.spawnSync(this.command, this.arguments, &#123; 'cwd': cwd, 'input': text &#125;); if (!result.status) &#123; return result.stdout.toString(); &#125; else &#123; vscode.window.showWarningMessage(result.stderr.toString().split('\n')[0]); return ''; &#125; &#125; provideDocumentFormattingEdits(document, options, token) &#123; let formatted = this.formatHindent(document.getText()); if (formatted !== '') &#123; let range = document.validateRange(new vscode.Range(0, 0, Number.MAX_VALUE, Number.MAX_VALUE)); return [vscode.TextEdit.replace(range, formatted)]; &#125; else &#123; return []; &#125; &#125; provideDocumentRangeFormattingEdits(document, range, options, token) &#123; let formatted = this.formatHindent(document.getText(range)); if (formatted !== '') &#123; return [vscode.TextEdit.replace(range, formatted)]; &#125; else &#123; return []; &#125; &#125;&#125;function activate(context) &#123; console.log("hindent-format: active!"); let hindentFormatProvider = new HindentFormatEditsProvider(); if (hindentFormatProvider.hindentAvailable) &#123; vscode.languages.registerDocumentFormattingEditProvider('haskell', hindentFormatProvider); console.log("hindent-format: registered document formatting provider"); vscode.languages.registerDocumentRangeFormattingEditProvider('haskell', hindentFormatProvider); console.log("hindent-format: registered selection formatting provider"); vscode.commands.registerTextEditorCommand('hindent-format.format', (textEditor, edit, args) =&gt; &#123; let range = textEditor.selection.with(); if (range.isEmpty) &#123; range = textEditor.document.validateRange(new vscode.Range(0, 0, Number.MAX_VALUE, Number.MAX_VALUE)); &#125; let formatted = hindentFormatProvider.formatHindent(textEditor.document.getText(range)); if (formatted !== '') &#123; edit.replace(range, formatted); &#125; &#125;); console.log("hindent-format: registered palette command"); &#125;&#125;exports.activate = activate;function deactivate() &#123; &#125;exports.deactivate = deactivate;//# sourceMappingURL=extension.js.map 个人更青睐 brittany 格式化的效果。 但目前 VSCode 插件 brittany 对未保存文档不能正确执行格式化，同样需要修改插件源代码（当前版本 0.0.1） brittany 插件修改后代码 extension.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101'use strict';Object.defineProperty(exports, "__esModule", &#123; value: true &#125;);const vscode = require("vscode");const proc = require("child_process");const path = require("path");const tmp = require("tmp");const fs = require("fs");function activate(context) &#123; // Use the console to output diagnostic information (console.log) and errors (console.error) // This line of code will only be executed once when your extension is activated if (isEnabled() === false) &#123; console.log("brittany extension disabled; not registering it."); return; &#125; else &#123; console.log("Registering brittany extension"); &#125; context.subscriptions.push(vscode.languages.registerDocumentRangeFormattingEditProvider('haskell', &#123; provideDocumentRangeFormattingEdits(document, range) &#123; if (isEnabled() === false) &#123; return new Promise((resolve, reject) =&gt; &#123; return reject([]); &#125;); &#125; console.log('brittany asked to format'); // If we're formatting the whole document // Brittany operates on files only, so we need to // Improvement TODO: Instead of making a tmp file, pass the source code into STDIN. // Could also potentially unify this approach with the full-file approach. let substring = document.getText(range); let tmpobj = tmp.fileSync(); console.log('brittany: Temporary file: ', tmpobj.name); return new Promise((resolve, reject) =&gt; &#123; fs.write(tmpobj.fd, substring, (err, written, str) =&gt; &#123; if (err) &#123; return reject(err); &#125; else &#123; return resolve(runBrittany(document, range, tmpobj.name, tmpobj)); &#125; &#125;); &#125;); &#125; &#125;));&#125;exports.activate = activate;function runBrittany(document, range, inputFilename, tmpobj) &#123; return new Promise((resolve, reject) =&gt; &#123; const file = document.uri.fsPath; var cmd = brittanyCmd() + " \"" + inputFilename + "\"" +" " + additionalFlags(); var maybeWorkspaceFolder = vscode.workspace.getWorkspaceFolder(document.uri); var dir = maybeWorkspaceFolder !== undefined ? maybeWorkspaceFolder.uri.fsPath : path.dirname(document.uri.fsPath); console.log("brittany command is: " + cmd); console.log("brittany folder is: " + dir); var options = &#123; encoding: 'utf8', // timeout: 0, // maxBuffer: 200 * 1024, // ? // killSignal: 'SIGTERM', cwd: dir, &#125;; proc.exec(cmd, options, (error, stdout, stderr) =&gt; &#123; if (error) &#123; if (tmpobj) &#123; tmpobj.removeCallback(); &#125; console.error("Error running brittany:"); console.error(error); console.error(stdout); console.error(stderr); vscode.window.showErrorMessage("Failed to run brittany; see the developer tools console for details. " + error); return reject([]); &#125; else &#123; if (tmpobj) &#123; tmpobj.removeCallback(); &#125; return resolve([vscode.TextEdit.replace(range, stdout)]); &#125; &#125;); &#125;);&#125;// this method is called when your extension is deactivatedfunction deactivate() &#123;&#125;exports.deactivate = deactivate;function brittanyCmd() &#123; return vscode.workspace.getConfiguration("brittany")["path"];&#125;function additionalFlags() &#123; return vscode.workspace.getConfiguration("brittany")["additional-flags"];&#125;function isEnabled() &#123; return vscode.workspace.getConfiguration("brittany")["enable"];&#125;function fullDocumentRange(document) &#123; const lastLineId = document.lineCount - 1; return new vscode.Range(0, 0, lastLineId, document.lineAt(lastLineId).text.length);&#125;//# sourceMappingURL=extension.js.map 另外，建议利用 config.yaml 文件搭配 brittany 进行深度配置。在控制台执行一次 brittany 命令，生成的配置文件位置为 %APPDATA%\brittany\config.yaml，示例配置如下。 brittany 配置文件 %APPDATA%\brittany\config.yaml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657conf_debug: dconf_roundtrip_exactprint_only: false dconf_dump_bridoc_simpl_par: false dconf_dump_ast_unknown: false dconf_dump_bridoc_simpl_floating: false dconf_dump_config: false dconf_dump_bridoc_raw: false dconf_dump_bridoc_final: false dconf_dump_bridoc_simpl_alt: false dconf_dump_bridoc_simpl_indent: false dconf_dump_annotations: false dconf_dump_bridoc_simpl_columns: false dconf_dump_ast_full: falseconf_forward: options_ghc: - -XLambdaCase - -XMultiWayIf - -XGADTs - -XPatternGuards - -XViewPatterns - -XRecursiveDo - -XTupleSections - -XExplicitForAll - -XImplicitParams - -XQuasiQuotes - -XTemplateHaskell - -XBangPatternsconf_errorHandling: econf_ExactPrintFallback: ExactPrintFallbackModeInline econf_Werror: false econf_omit_output_valid_check: false econf_produceOutputOnErrors: falseconf_preprocessor: ppconf_CPPMode: CPPModeAbort ppconf_hackAroundIncludes: falseconf_obfuscate: falseconf_roundtrip_exactprint_only: falseconf_version: 1conf_layout: lconfig_reformatModulePreamble: true lconfig_altChooser: tag: AltChooserBoundedSearch contents: 3 lconfig_allowSingleLineExportList: false lconfig_importColumn: 50 lconfig_hangingTypeSignature: false lconfig_importAsColumn: 50 lconfig_alignmentLimit: 30 lconfig_indentListSpecial: true lconfig_indentAmount: 4 lconfig_alignmentBreakOnMultiline: true lconfig_cols: 80 lconfig_indentPolicy: IndentPolicyFree lconfig_indentWhereSpecial: true lconfig_columnAlignMode: tag: ColumnAlignModeMajority contents: 0.7 参考 Installing Haskell stack (in Windows) 重拾Haskell]]></content>
      <categories>
        <category>Development and Deployment</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>Stack</tag>
        <tag>Haskell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Lingo 学习（一）]]></title>
    <url>%2Flearning-lingo-01%2F</url>
    <content type="text"><![CDATA[环境搭建 Lingo 17.0 (Windows 10 x64) Notepad++ 7.4.2 x86 NppExec Visimulator 语法高亮及代码补全 Lingo 界面速览 文件类型 扩展名 文件类型 扩展名 文件类型 .lg4 Windows 下模型文件，支持字体、格式、OLE .lng 纯文本格式模型文件 .ldt 数据文件 .ltf 命令脚本文件 .ltx Lindo 语法的模型文件 .lgr 报告文件 Lingo 菜单 中文 英文 中文 英文 求解结果 Solution 灵敏性分析 Range 生成模型展开形式 Generate 生成图形 Picture 调试 Debug 模型统计资料 Model Statistics 查看 Look 求解器状态窗口信息 变量数量 (Variables) 约束变量 (Constraints) 非零系数数量 (Nonzeroes) 内存使用量 (Generator Memory Used) 已运行时间 (Elapsed Runtime) 求解器状态 (Solver Status) 模型类型 (Model Class)：线性规划 (LP)、二次规划 (QP)、整数线性规划 (ILP)、整数二次规划 (IQP)、纯整数线性规划 (PILP)、纯整数二次规划 (PIQP)、非线性规划 (NLP)、混合整数规划 (MIP)、整数非线性工 (INLP)、纯整数非线性规划 (PINLP)、混合整数非线性规划 (MINLP) 当前解的状态 (State)：全局最优解 (Global Optimum)、局部最优解 (Local Optimum)、可行解 (Feasible)、不可行解 (Infeasible)、无界 (Unbounded)、中断 (Interrupted)、未确定 (Undetermined) 当前解的目标函数值 (Objective) 当前约束不满足的总量 (Infeasibility) 迭代次数 (Iterations) 扩展求解器状态 (Extended Solver Status)：特殊算法类型 (Solver Type)、可行解的最佳目标函数值 (Best Obj)、目标函数值的界限 (Obj Bound)、特殊求解程序运行步数 (Steps)、有效步数 (Active) Lingo 语言速览 逻辑运算符 运算符 作用 运算符 作用 运算符 作用 #EQ# 两操作数相等时为真 #NE# 两操作数不等时为真 #GT# 左边（严格）大于右边时为真 #GE# 左边大于或等于右边时为真 #LT# 左边（严格）小于右边时为真 #LE# 左边小于或等于右边时为真 #NOT# 取反 #AND# 逻辑与 #OR# 逻辑或 注：#AND# 和 #OR# 优先级较低，但高于 &lt;=、=、&gt;=。 数学函数 函数名 解释 函数名 解释 函数名 解释 @abs(x) 绝对值 @acos(x) 反余弦 @acosh(x) 反双曲余弦 @asin(x) 反正弦 @asinh(x) 反双曲正弦 @atan(x) 反正切 @atan2(x, y) \(\arctan (y/x)\) @atanh(x) 反双曲正切 @cos(x) 余弦 @cosh(x) 双曲余弦 @exp(x) \(e^x\) @floor(x) 向 0 取整 @int(x) 向负无穷取整 @integral(proc, x, xl, xu, y) 辛普森数值积分 @lgm(x) Gamma 函数自然对数 @log(x) 自然对数 @log10(x) 10 为底对数 @logb(x, b) b 为底对数 @mod(x, y) 取模 @pi() 圆周率 @pow(x, y) \(x^y\) @round(x, n) 最近四舍五入 @rounddown(x, n) 向零四舍五入 @roundup(x, n) 远离零四舍五入 @sign(x) 符号函数 @sin(x) 正弦 @sinh(x) 双曲正弦 @smax(x1, x2, …, xn) 最大值 @smin(x1, x2, …, xn) 最小值 @sqr(x) 平方 @sqrt(x) 开方 @tan(x) 正切 @tanh(x) 双曲正切 概率函数 函数名 解释 函数名 解释 函数名 解释 @norminv(p, mu, sigma) 正态分布下分位数 @normsinv(p) 标准正态分布分位数 @pbn(p, n, x) 二项分布 CDF 值 @pcx(n, x) 卡方分布 CDF 值 @peb(a, x) 允许无穷排队的 Erlang 繁忙概率 @pel(a, x) 不允许无穷排队的 Erlang 繁忙概率 @pfd(n, d, x) F 分布 CDF 值 @pfs(a, x, c) Poisson 服务系统期望值 @phg(pop, g, n, x) 超几何分布概率值 @ppl(a, x) 泊松分布线性损失函数 @pps(a, x) 泊松分布 CDF 值 @psl(x) 单位正态线性损失函数 @psn(x) 标准正态分布 CDF 值 @ptd(n, x) t 分布 CDF 值 @qrand(seed) (0, 1) 间随机数 变量界定函数 函数名 解释 函数名 解释 函数名 解释 @bin(variable) 限制变量取 0 或 1 @bnd(lower, variable, upper) 限制 \(L\leqslant x \leqslant U\) @free(variable) 取消变量限制，可取任意实数 @gin(variable) 限制为整数 @priority(variable, priority) 设置优先级 @semic(lower, variable, upper) 或者为 0，或者在区间 (lower, upper) 集合操作函数 @for(s: e) @max(s: e) @prod(s: e) @size(s) @insert(s, idx) @sum(s: e) @min(s: e) @in(s, e) @index(s: e) @wrap(idx, limit) 一些经典问题 运输问题 假设 Wireless Widget有 6 个供货仓库，货物分别发往 8 个供销商。每个仓库有一定的库存量，现要制定出最小化运输成本，使得运输方案达到每个供销商需求的运输方案。 已知信息如下： 仓库 库存 供销商 需求 1 60 1 35 2 55 2 37 3 51 3 22 4 43 4 32 5 41 5 41 6 52 6 32 7 43 8 38 每个仓库（WH1 ~ WH6）到每个供销商的单位运费表如下： V1 V2 V3 V4 V5 V6 V7 V8 WH1 6 2 6 7 4 2 5 9 WH2 4 9 5 3 8 5 8 2 WH3 5 2 1 9 7 4 3 3 WH4 7 6 7 3 9 2 7 1 WH5 2 3 9 5 7 2 6 5 WH6 5 5 2 2 8 1 4 3 对问题建模，记 \(\text{volume}_{ij}\) 为第 \(i\) 个仓库到第 \(j\) 个供销商的货运量，\(\text{cost}_{ij}\) 表示第 \(i\) 个仓库到第 \(j\) 个供销商的单位货物运价，\(\text{capacity}_i\) 表示第 \(i\) 个仓库的最大供货量，\(\text{demand}_j\) 表示第 \(j\) 个供销商的订货量。 目标函数是令总运输费用最少。约束条件： 各仓库的出货量不超过其库存 各供销商收到的货物总量等于订货数 决策变量 \(\text{cost}_{ij}\) 非负。 数学表达为： \[ \begin{array}{cl} \min &amp; z = \sum\limits_{i=1}^6 \sum\limits_{j=1}^8 \text{cost}_{ij}\ \text{volume}_{ij} \\ \text{s.t.} &amp; \begin{cases} \sum\limits_{j=1}^8 \text{volume}_{ij} \leqslant \text{capacity}_i, &amp; i = 1,2,\ldots,6 \\ \sum\limits_{i=1}^6 \text{volume}_{ij} = \text{demand}_j, &amp; j = 1,2,\ldots,8 \\ \text{volume}_{ij} \geqslant 0, &amp; i=1,2,\ldots,6, \ j=1,2,\ldots,8 \\ \end{cases} \end{array} \] 相应的 Lingo 程序代码： 123456789101112131415161718192021222324model: sets: warehouses/wh1..wh6/:capacity; vendors/vd1..vd8/:demand; crosstab(warehouses, vendors): volume, cost; endsets data: capacity = 60 55 51 43 41 52; demand = 35 37 22 32 41 32 43 38; cost = 6 2 6 7 4 2 5 9 4 9 5 3 8 5 8 2 5 2 1 9 7 4 3 3 7 6 7 3 9 2 7 1 2 3 9 5 7 2 6 5 5 5 2 2 8 1 4 3; enddata min = @sum(crosstab(i, j): volume(i, j) * cost(i, j)); @for(warehouses(i): @sum(vendors(j): volume(i, j)) &lt;= capacity(i)); @for(vendors(j): @sum(warehouses(i): volume(i, j)) = demand(j));end 其中 SET 过程大大简化了程序代码，也提升了程序的可读性，否则对于每个变量都需要进行硬编码。其语法 为 &lt;集合名称&gt;[集合元素][:&lt;集合属性&gt;]。当然 SET 中的前两个关于库存和供销商的描述可以拆分为 12345678910sets: warehouses:capacity; vendors:demand; ...endsetsdata: warehouses = wh1..wh6; demand = vd1..vd8;enddata 当然笔者更青睐紧凑的方式。crosstab 表示由 warehouses 和 demand 构成的派生集，即包含了 6 × 8 = 48 个变量。在目标函数及约束条件语句中，由于目标函数的操作数完全来自 crosstab，所以可省略部分语句：min = @sum(crosstab: volume * cost);。 程序经过 17 次迭代后得出的目标函数值为 664.0000，最优运输方案如下表。 V1 V2 V3 V4 V5 V6 V7 V8 合计 库存 WH1 0 19 0 0 41 0 0 0 60 60 WH2 1 0 0 32 0 0 0 0 33 55 WH3 0 11 0 0 0 0 40 0 51 51 WH4 0 0 0 0 0 5 0 38 43 43 WH5 34 7 0 0 0 0 0 0 41 41 WH6 0 0 22 0 0 27 3 0 52 52 合计 35 37 22 32 41 32 43 38 需求 35 37 22 32 41 32 43 38 值班问题 某项工作一周 7 天都需有人上班，周一至周日所需的最少人数分别为 20、16、13、16、19、14 和 12。要求员工一周连续工作 5 天接着休息 2 天。给出人员安排，使每周所需人数最少。 若安排得当，记周一至周日分别安排 \(X(i)\) 人上班。那么周一上班的人必然周五、周六休息，以此类推。令总上班人数为 \(Z\)，那么上周周二、周三的人仍在休息中，所以有 \(X(1) = Z-X(1)-X(2)\)，同样可以得到其他 6 个等式。概括之就是 \[X(i) = Z-X(i+1)-X(i+2), \ i=1,2,\ldots, 7\] 当然，\(X(8)\) 相当于 \(X(1)\)，\(X(9)\) 相当于 \(X(2)\)。所以需要特殊的函数对其进行转化，wrap 函数正合此意。除了此函数，由此 公式 也可。代码如下： 123456789101112131415model: sets: days/mon..sun/: r, x; endsets data: r = 20 16 13 16 19 14 12; enddata min = z; z = @sum(days: x); n = @size(days); @for(days(i): z-x(@wrap(i+1,n))-x(@wrap(i+2,n)) &gt;= r(i)); ! @for(days(i): z-x(1+@mod(i,n))-x(1+@mod(i+1,n)) &gt;= r(i));end 程序得出的最优解为：8、2、0、6、3、3、0。这说明每周最少需要 22 名员工，周一安排 8 人开始上班，或者说这 8 人休周六和周日，周一工作，其余类推。周二安排 2 人，等等。待轮休稳定后即可满足每天所需要的最少上班员工数。 投资的收益和风险 市场上有 \(n\) 种资产 \(S_i (i=1,2,\ldots,n)\) 供投资者选择，某公司有数额为 \(M\) 的一笔资金用于一个时期的投资。公司财务分析人员对这 \(n\) 种资产进行了评估，估算出在这一时期内购买 \(S_i\) 的平均收益率为 \(r_i\)，并预测出购买 \(S_i\) 的风险损失率为 \(q_i\)。考虑到投资越分散，总的风险越小，公司决定当用这笔资金购买若干种资产时，总体风险可用所投资的 \(S_i\) 中最大的一个风险来度量。购买 \(S_i\) 要付交易费，费率为 \(p_i\)，并且当购买额不超过给定值 \(u_i\) 时，交易费按购买 \(u_i\) 计算（不买当然无须付费）。另外，假定同期银行存款利率是 \(r_0\), 且既无交易费又无风险（\(r_0=5\%\)）。 数据表 $E_i$ $r_i$(%) $q_i$(%) $p_i$(%) $u_i$(元) S1 9.6 42.0 2.1 181 S2 18.5 54.0 3.2 407 S3 49.4 60.0 6.0 428 S4 23.9 42.0 1.5 549 S5 8.1 1.2 7.6 270 S6 14.0 39.0 3.4 397 S7 40.7 68.0 5.6 178 S8 31.2 33.4 3.1 220 S9 33.6 53.3 2.7 475 S10 36.8 40.0 2.9 248 S11 11.8 31.0 5.1 195 S12 9.0 5.5 5.7 320 S13 35.0 46.0 2.7 267 S14 9.4 5.3 4.5 328 S15 15.0 23.0 7.6 131 要使净收益尽可能大，总体风险尽可能小，这是一个多目标的规划模型： \[ \begin{gather*} \max \ Q(x) = r_0 x_0 + \sum_{i=1}^n r_ix_i - \sum_{i=1}^n p_iy_i, \ i=1,2,\ldots,n \\ \min \ F(x) = \max\limits_{1\leqslant i\leqslant n}\{q_ix_i\} \end{gather*} \] 这里仅考虑模型的一种简化情形：投资者承受风险的程度不同，故给定风险一个界限 \(a\)，使得所有风险率均小于此值，即 \(q_ix_i \leqslant Ma (i=1,2,\ldots,n)\)。所以目标函数中最小化风险的要求转化为其中一个约束条件。 约束条件为： \[ \begin{cases} \displaystyle \sum_{i=1}^nx_i + \sum_{i=1}^n p_iy_i = M, &amp; i=1,2,\cdots,n\\ \displaystyle x_i \geqslant 0, &amp; i=1,2,\cdots,n\\ \displaystyle y_i = \begin{cases} x_i, &amp;x_i&gt;u_i\\ u_i, &amp;0&lt;x_i\leqslant u_i\\ 0, &amp;x_i=0 \end{cases}, &amp; i=1,2,\cdots, n \end{cases} \] 由于约束条件中含有分段函数，这时可引入 0 - 1 变量将模型转化为混合整数线性规划模型，但也可以利用 Lingo 中的 @if 函数来构造条件，但模型为非线性规划模型。 混合整数线性规划模型 Lingo 程序 1234567891011121314151617181920212223242526272829303132333435model: sets: S/1..15/:x,y,r,p,q,u,z1,z2,z3,b1,b2,b3; endsets data: M=4000; bili=0.05; r0=5; r=9.6 18.5 49.4 23.9 8.1 14 40.7 31.2 33.6 36.8 11.8 9 35 9.4 15; q=42 54 60 42 1.2 39 68 33.4 53.3 40 31 5.5 46 5.3 23; p=2.1 3.2 6 1.5 7.6 3.4 5.6 3.1 2.7 2.9 5.1 5.7 2.7 4.5 7.6; u=181 407 428 549 270 397 178 220 475 248 195 320 267 328 131; enddata max=r0*x0/100+@Sum(S:r*x/100)-@Sum(S:p*y/100); @For(S:q*x/100&lt;M*bili); x0+@Sum(S:x)+@Sum(S:p*y/100)=M; @For(S:y=z1+z2+z3); @For(S:b1+b2+b3=1); @For(S:u-x&lt;2*M*(1-b1)); @For(S:x-M&lt;2*M*(1-b1)); @For(S:-x&lt;2*M*(1-b2)); @For(S:x-u&lt;2*M*(1-b2)); @For(S:-x&lt;2*M*(1-b3)); @For(S:x&lt;2*M*(1-b3)); @For(S:-2*M*b1&lt;z1); @For(S:z1&lt;2*M*b1); @For(S:x-2*M*(1-b1)&lt;z1); @For(S:z1&lt;x+2*M*(1-b1)); @For(S:-2*M*b2&lt;z2); @For(S:z2&lt;2*M*b2); @For(S:u-2*M*(1-b2)&lt;z2); @For(S:z2&lt;u+2*M*(1-b2)); @For(S:z3=0); @For(S:@Bin(b1)); @For(S:@Bin(b2)); @For(S:@Bin(b3));end 非线性规划模型 Lingo 程序 123456789101112131415161718192021222324252627model: sets: assets/1..15/: x, y, r, q, p, u; endsets data: M = 4000; r0 = 5; a = 0.05; r = 9.6 18.5 49.4 23.9 8.1 14.0 40.7 31.2 33.6 36.8 11.8 9.0 35.0 9.4 15.0; q = 42 54 60 42 1.2 39 68 33.4 53.3 40 31 5.5 46 5.3 23; p = 2.1 3.2 6.0 1.5 7.6 3.4 5.6 3.1 2.7 2.9 5.1 5.7 2.7 4.5 7.6; u = 181 407 428 549 270 397 178 220 475 248 195 320 267 328 131; enddata max=(x0*r0+@sum(assets: r*x-p*y))/100; @for(assets: y=@if(x #le# u, @if(x #eq# 0, 0, u), x)); @for(assets: q*x/100&lt;=M*a); x0+@sum(assets: x)+@sum(assets: p*y/100)=M;end 程序输出结果如下： Variable Value Variable Value Variable Value Variable Value X0 0 X4 476.1905 X8 598.8024 X12 0 S1 0 X5 0 X9 375.2345 X13 434.7826 X2 370.3704 X6 479.8182 X10 500 X14 0 X3 333.3333 X7 294.1176 X11 0 X15 0 在此种投资组合下，收益 1045.604 元。 分段函数处理方法 上述关于混合整数线性规划模型的 Lingo 程序中引入不少中间决策变量，这里对其展开讨论，下面内容节选自余胜威《MATLAB 数学建模经典案例实战》。（部分改动） 设有限区间的有界分段函数： $$ y = f(x) = \begin{cases} \varphi_1(x), & x\in(a_1, b_1) & \\ \varphi_2(x), & x\in(a_2, b_2) & \\ \hfil \cdots \\ \varphi_n(x), & x\in(a_n, b_n) & \\ \end{cases}, \quad a_1 < b_1 \leqslant a_2 < b_2 \leqslant \cdots \leqslant a_n < b_n $$ 等价为： $$ \begin{cases} y = y_1 + y_2 + \cdots y_n \\ \delta_1 + \delta_2 + \cdots + \delta_n = 1, \delta_i \in \{0,1\} \\ x - a_i \geqslant -(1-\delta_i)L_x \\ x - b_i \leqslant (1-\delta_i)U_x \\ -\delta_i L_{y1} \leqslant y_i \leqslant \delta_i U_{y1} \\ -(1-\delta_i) L_{y2} \leqslant y_i-\varphi_i(x) \leqslant (1-\delta_i) U_{y2} \end{cases} $$ 其中 \(\delta_i\) 表明 \(x\) 所处区间，通过上述约束条件中的第 3、4 式保证。具体而言，给定 \(i\in\{1,\ldots,n\}\)，若 \(x \in (a_i, b_i)\)，必然有 \(x-a_i \geqslant 0\) 以及 \(x-b_i \leqslant 0\)；对其他区间而言，有 \(x-a_i \geqslant -L\)，以及 \(x-b_i \leqslant U\)，其中 \(U, L &gt; 0\) 分别为 \(x\) 支撑集的上限和下限的绝对值。引入 0 - 1 变量 \(\delta_i\)（类似于概率论中示性函数），对于任何区间，整合上述不等式，即为 3、4 式。注意到给定的 \(x\) 仅会落入一个区间，故 \(\sum \delta_i = 1\)（2 式）。对于 \(y_i\)，讨论类似。当然为简单起见，可将所有界限以它们的最大值代替。 乍看求解模型被复杂化，但把可能为非线性规划的问题转为了混合整数线性规划问题，加快求解收敛速度。 计划排序模型 完成某产品的装配过程需要 11 项任务（用 A ~ K 表示），每项任务所花费的时间如下： 任务 A B C D E F 时间 45 11 9 50 15 12 任务 G H I J K 时间 12 12 12 8 9 各项任务之间存在先后顺序如下图所示。装配流水线有四个顺序工作站，对于有先后次序的任务，只能在流水线上向后传（如任务 B 和 C 的次序为先 B 后 C，如果安排 B 给第 3 站做，则 C 要么由 B 自己完成，要么传给第 4 站来做，而不能交往 1 或 2 号站），每项任务必须只能分配至一个工作站来做。合理分配生产计划，使整个装配周期最短。 记 \(x_{ik}\) 表示将任务 \(i\ (i=A,B,\ldots,K)\) 分配给工作站 \(k\ (k=1,2,3,4)\) 的情况，1 表示分配，0 表示不分配，\(t_i\) 表示完成各项任务所需时间。则目标函数为 \(\min\ T = \max\limits_{1\leqslant k \leqslant 4} \sum\limits_{i=1}^{11} t_ix_{ik}\)。由每项任务只能分配给一个工作站来做，故对所有任务 \(i\) 有：\(\sum\limits_{k=1}^4 x_{ik}=1\)。对于任务间的优先级，考虑任务 \(i\) 先于任务 \(j\)，则可行的任务安排表 (11 × 4) 有： \[\begin{array}{ccccc} \begin{array}{ccccc} \hline &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ \hline i &amp; 1 &amp; &amp; &amp; \\ j &amp; 1 &amp; &amp; &amp; \\ \Delta &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ \hline \end{array} &amp; \begin{array}{ccccc} \hline &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ \hline i &amp; 1 &amp; &amp; &amp; \\ j &amp; &amp; 1 &amp; &amp; \\ \Delta &amp; -1 &amp; 1 &amp; 0 &amp; 0 \\ \hline \end{array} &amp; \begin{array}{ccccc} \hline &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ \hline i &amp; 1 &amp; &amp; &amp; \\ j &amp; &amp; &amp; 1 &amp; \\ \Delta &amp; -1 &amp; 0 &amp; 1 &amp; 0 \\ \hline \end{array} &amp; \begin{array}{ccccc} \hline &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ \hline i &amp; 1 &amp; &amp; &amp; \\ j &amp; &amp; &amp; &amp; 1 \\ \Delta &amp; -1 &amp; 0 &amp; 0 &amp; 1 \\ \hline \end{array} &amp; \begin{array}{ccccc} \hline &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ \hline i &amp; &amp; 1 &amp; &amp; \\ j &amp; &amp; 1 &amp; &amp; \\ \Delta &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ \hline \end{array} \\[15pt] \begin{array}{ccccc} \hline &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ \hline i &amp; &amp; 1 &amp; &amp; \\ j &amp; &amp; &amp; 1 &amp; \\ \Delta &amp; 0 &amp; -1 &amp; 1 &amp; 0 \\ \hline \end{array} &amp; \begin{array}{ccccc} \hline &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ \hline i &amp; &amp; 1 &amp; &amp; \\ j &amp; &amp; &amp; &amp; 1 \\ \Delta &amp; 0 &amp; -1 &amp; 0 &amp; 1 \\ \hline \end{array} &amp; \begin{array}{ccccc} \hline &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ \hline i &amp; &amp; &amp; 1 &amp; \\ j &amp; &amp; &amp; 1 &amp; \\ \Delta &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ \hline \end{array} &amp; \begin{array}{ccccc} \hline &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ \hline i &amp; &amp; &amp; 1 &amp; \\ j &amp; &amp; &amp; &amp; 1 \\ \Delta &amp; 0 &amp; 0 &amp; -1 &amp; 1 \\ \hline \end{array} &amp; \begin{array}{ccccc} \hline &amp; 1 &amp; 2 &amp; 3 &amp; 4 \\ \hline i &amp; &amp; &amp; &amp; 1 \\ j &amp; &amp; &amp; &amp; 1 \\ \Delta &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\ \hline \end{array} \end{array}\] 其中最后一行为任务 \(j\) 的分配数与任务 \(i\) 的分配数之差。对每个工作站引入权重 \(f_k = k\)，可发现上述所有情况均满足 \(\sum\limits_{i=k}^4 f_k\Delta_k \geqslant 0\)，通过进一步试验可归纳任何一种「任务 \(j\) 优先于任务 \(i\)」的分配方案均不满足上述等式。 于是对所有 \(i\) 优先于 \(j\)：\(\sum\limits_{k=1}^4 k(x_{jk}-x_{ik}) \geqslant 0\)。 至此，该模型是一个非线性规划，但可进一步转为线性规划。增加约束条件：\(\sum\limits_{i=1}^{11}t_ix_{ik} \leqslant Z\)，目标函数变为 \(\min \ Z\)。两种模型的迭代次数分别为 147 (MILP)、590 (PINLP)。 计划排序模型 Lingo 程序 1234567891011121314151617181920model: sets: task/A..K/:t; prio(task, task)/A,B B,C C,F C,G D,E E,H E,I F,J G,J H,J I,J J,K/; station/1..4/; txs(task, station):x; endsets data: t = 45 11 9 50 15 12 12 12 12 8 9; enddata ! 注释行为非线性规划方案; ! min=@max(station(k): @sum(task(i): t(i)*x(i, k))); ; min=Z; @for(station(k): @sum(task(i): t(i)*x(i, k))&lt;=Z); @for(task(i): @sum(station(j): x(i, j)) = 1); @for(prio(i, j): @sum(station(k): k*(x(j, k)-x(i, k)))&gt;=0); @for(txs: @bin(x));end 配对模型 将 8 个职员安排到 4 个办公室，每室两人。同事两两之间的相容程度如下（数字越小代表相容越好） \[ \begin{array}{c|cccccccc} \hline &amp; S_1 &amp; S_2 &amp; S_3 &amp; S_4 &amp; S_5 &amp; S_6 &amp; S_7 &amp; S_8 \\ \hline S_1 &amp; - &amp; 9 &amp; 3 &amp; 4 &amp; 2 &amp; 1 &amp; 5 &amp; 6 \\ S_2 &amp; - &amp; - &amp; 1 &amp; 7 &amp; 3 &amp; 5 &amp; 2 &amp; 1 \\ S_3 &amp; - &amp; - &amp; - &amp; 4 &amp; 4 &amp; 2 &amp; 9 &amp; 2 \\ S_4 &amp; - &amp; - &amp; - &amp; - &amp; 1 &amp; 5 &amp; 5 &amp; 2 \\ S_5 &amp; - &amp; - &amp; - &amp; - &amp; - &amp; 8 &amp; 7 &amp; 6 \\ S_6 &amp; - &amp; - &amp; - &amp; - &amp; - &amp; - &amp; 2 &amp; 3 \\ S_7 &amp; - &amp; - &amp; - &amp; - &amp; - &amp; - &amp; - &amp; 4 \\ S_8 &amp; - &amp; - &amp; - &amp; - &amp; - &amp; - &amp; - &amp; - \\ \hline \end{array} \] 安排配对方案，使组合的总相容程度最好。 引入决策矩阵 \(X\)，元素 \(X_{ij} \in \{0, 1\}\)，每人组合一次，说明对于每个职员 \(i\)，必有 \(\sum\limits_{j=i \ \text{or}\ k=i}X_{jk} = 1\)，所以模型为： \[ \begin{array}{cl} \min &amp; \sum\limits_{i&lt;j} C_{ij} X_{ij} \\ \text{s.t.} &amp; \begin{cases} \sum\limits_{j=i \ \text{or}\ k=i}X_{jk} = 1, &amp; i=1,2,\ldots,8 \\ X_{ij} = 0 \ \text{or} \ 1, &amp; i&lt;j \end{cases} \end{array} \] 配对模型 Lingo 程序 1234567891011121314151617181920model: sets: people/1..8/; links(people, people) | &amp;2 #gt# &amp;1: tol, x; endsets data: tol = 9 3 4 2 1 5 6 1 7 3 5 2 1 4 4 2 9 2 1 5 5 2 8 7 6 2 3 4; enddata @for(people(i): @sum(links(j, k) | j #eq# i #or# k #eq# i: x(j, k)) = 1); @for(links: @bin(x)); min = @sum(links: x*tol);end 下料问题 钢管原材料每根长 19m，现需要 A、B、C、D 四种钢管部件，长度分别为 4m、5m、6m、8m，数量分别为 50、10、20、15 根，不同的下料方式不超过 3 种，安排下料方式使得所需钢管原材料最少。 一般化问题，假设用到 \(k\) 种下料方式，用 \(x_i\ (i=1,2,\ldots,k)\) 表示第 \(i\) 种下料方式所切割的原料钢管数量，非负整数 \(n_{ij}\) 表示第 \(i\) 种下料方法得到部件 \(j\ (j=1,2,\ldots,m)\) 的数量，\(b_j\) 表示第 \(j\) 种部件的需求量。\(L\) 表示钢管材料的长度，\(l_j\) 表示部件长度，则下料方式应满足：1) 切割出的部件总长度不超过 \(L\)；2) 余料严格小于 \(\min \{l_j\}\)。故建立优化模型： \[ \begin{array}{cl} {\min} &amp; z = \sum\limits_{i=1}^k x_i \\ \text{s.t.} &amp; \begin{cases} \sum\limits_{i=1}^k n_{ij}x_i \geqslant b_j, &amp; j=1,2,\ldots,m \\ L - \min\{n_{ij}\} &lt; \sum\limits_{j=1}^m n_{ij}l_j \leqslant L, &amp; i=1,2,\ldots,k \\ x_{i}, n_{ij} \in \mathbb{N}, &amp; i=1,2,\ldots,k; \ j=1,2,\ldots,m \end{cases} \end{array} \] 在此问题中 \(k=3, m=4\)。 下料问题 Lingo 程序 1234567891011121314151617181920212223model: sets: ! craft(1~k): 工艺, 即切割方式 ; ! material(1~m): 不同部件数量 ; ! links: 每种切割方式下不同部件数量 ; craft/1..3/: x; material/1..4/: m, b; links(craft, material): n; endsets data: m = 4 5 6 8; b = 50 10 20 15; L = 19; enddata min = @sum(craft: x); @for(material(j): @sum(craft(i): n(i, j)*x(i))&gt;=b(j)); @for(craft(i): @sum(material(j): n(i, j)*m(j))&lt;=L); @for(craft(i): @sum(material(j): n(i, j)*m(j))&gt;=16); @for(craft: @gin(x)); @for(links: @gin(n));end 求解结果如下： 下料方式 部件长度 余料长度 切割根数 4m 5m 6m 8m 方式一 0 0 0 2 3 8 方式二 2 1 1 0 0 10 方式三 3 0 1 0 1 10 合计 50 10 20 16 34m 28 注意到上述切割方案余料总长 34m，且多出一根 8m 长的部件。]]></content>
      <categories>
        <category>Mathematical Modeling</category>
      </categories>
      <tags>
        <tag>Linear Algebra</tag>
        <tag>Lingo</tag>
        <tag>Programming</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Matlab 数值计算之函数插值]]></title>
    <url>%2Ffunction-interpolation-by-matlab%2F</url>
    <content type="text"><![CDATA[微积分中对于连续或可导函数的研究虽有各路方法各显神通，但对于一个实际问题，若仅给出离散的数据点，通常首先要做的工作是根据这些离散点拟合出便于研究的连续函数。这类问题通常称作「数据拟合」，而其中的特殊情形便是函数插值。 多项式拟合插值中最「直接」的算法，就是对于 \(n+1\) 个给定的数据点对 \((x_i, y_i), i=0,1,\ldots,n\)，假设 \(n\) 次多项式 \(p_n(x)=\sum\limits_{i=0}^n a_ix^i\) 过所有的数据点，即 \(p_n(x_i) = y_i\)，即： \[ \underbrace{ \begin{pmatrix} 1 &amp; x_0^1 &amp; x_0^2 &amp; \cdots &amp; x_0^{n-1} &amp; x_0^n \\ 1 &amp; x_1^1 &amp; x_1^2 &amp; \cdots &amp; x_1^{n-1} &amp; x_1^n \\ 1 &amp; x_2^1 &amp; x_2^2 &amp; \cdots &amp; x_2^{n-1} &amp; x_2^n \\ \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\ 1 &amp; x_{n-1}^1 &amp; x_{n-1}^2 &amp; \cdots &amp; x_{n-1}^{n-1} &amp; x_{n-1}^n \\ 1 &amp; x_n^1 &amp; x_n^2 &amp; \cdots &amp; x_n^{n-1} &amp; x_n^n \end{pmatrix} }_{\boldsymbol{V}} \underbrace{ \begin{pmatrix} a_0 \vphantom{x_0^{n-1}} \\ a_1 \vphantom{x_1^{n-1}} \\ a_2 \vphantom{x_2^{n-1}} \\ \vdots \vphantom{\ddots \vdots} \\ a_{n-1} \vphantom{x_{n-1}^{n-1}} \\ a_{n} \vphantom{x_n^{n-1}} \end{pmatrix} }_{\boldsymbol{a}} = \underbrace{ \begin{pmatrix} y_0 \vphantom{x_0^{n-1}} \\ y_1 \vphantom{x_1^{n-1}} \\ y_2 \vphantom{x_2^{n-1}} \\ \vdots \vphantom{\ddots \vdots} \\ y_{n-1} \vphantom{x_{n-1}^{n-1}} \\ y_{n} \vphantom{x_n^{n-1}} \end{pmatrix} }_{\boldsymbol{y}} \] 显然 \(\boldsymbol{V}\) 为 Vandermonde 矩阵。关于 Vandermonde 行列式的计算，这里列出两种计算方法。 Vandermonde 行列式计算方法 $n$ 阶 Vandermonde 行列式 $$ V_n = \begin{vmatrix} 1 & x_1 & x_1^2 & \cdots & x_1^{n-2} & x_1^{n-1} \\ 1 & x_2 & x_2^2 & \cdots & x_2^{n-2} & x_2^{n-1} \\ \vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\ 1 & x_n & x_n^2 & \cdots & x_n^{n-2} & x_n^{n-1} \end{vmatrix} $$ 的值为 $$ V_n = \prod_{1 \mathop \leqslant i \mathop < j \mathop \leqslant n} \left({x_j - x_i}\right) $$ 以下证明过程摘自 Vandermonde Determinant。 方法一 从 $V_n$ 第二行开始，以后每行减去第一行，由初等变换得到的行列式值不变： \begin{align*} V_n &= \begin{vmatrix} 1 & x_1 & x_1^2 & \cdots & x_1^{n-2} & x_1^{n-1} \\ 1 & x_2 & x_2^2 & \cdots & x_2^{n-2} & x_2^{n-1} \\ 1 & x_3 & x_3^2 & \cdots & x_3^{n-2} & x_3^{n-1} \\ \vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\ 1 & x_{n-1} & x_{n-1}^2 & \cdots & x_{n-1}^{n-2} & x_{n-1}^{n-1} \\ 1 & x_n & x_n^2 & \cdots & x_n^{n-2} & x_n^{n-1} \end{vmatrix} \\ &= \begin{vmatrix} 1 & x_1 & x_1^2 & \cdots & x_1^{n-2} & x_1^{n-1} \\ 0 & x_2 - x_1 & x_2^2 - x_1^2 & \cdots & x_2^{n-2} - x_1^{n-2} & x_2^{n-1} - x_1^{n-1} \\ 0 & x_3 - x_1 & x_3^2 - x_1^2 & \cdots & x_3^{n-2} - x_1^{n-2} & x_3^{n-1} - x_1^{n-1} \\ \vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\ 0 & x_{n-1} - x_1 & x_{n-1}^2 - x_1^2 & \cdots & x_{n-1}^{n-2} - x_1^{n-2} & x_{n-1}^{n-1} - x_1^{n-1} \\ 0 & x_n - x_1 & x_n^2 - x_1^2 & \cdots & x_n^{n-2} - x_1^{n-2} & x_n^{n-1} - x_1^{n-1} \end{vmatrix} \\ &= \begin{vmatrix} 1 & 0 & 0 & \cdots & 0 & 0 \\ 0 & x_2 - x_1 & \left({x_2 - x_1}\right) x_2 & \cdots & \left({x_2 - x_1}\right) x_2^{n-3} & \left({x_2 - x_1}\right) x_2^{n-2} \\ 0 & x_3 - x_1 & \left({x_3 - x_1}\right) x_3 & \cdots & \left({x_3 - x_1}\right) x_3^{n-3} & \left({x_3 - x_1}\right) x_3^{n-2} \\ \vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\ 0 & x_{n-1} - x_1 & \left({x_{n-1} - x_1}\right) x_{n-1} & \cdots & \left({x_{n-1} - x_1}\right) x_{n-1}^{n-3} & \left({x_{n-1} - x_1}\right) x_{n-1}^{n-2} \\ 0 & x_n - x_1 & \left({x_n - x_1}\right) x_n & \cdots & \left({x_n - x_1}\right) x_n^{n-3} & \left({x_n - x_1}\right) x_n^{n-2} \end{vmatrix} \\ &= \prod_{k \mathop = 2}^n \left({x_k - x_1}\right) \begin{vmatrix} 1 & 0 & 0 & \cdots & 0 & 0 \\ 0 & 1 & x_2 & \cdots & x_2^{n-3} & x_2^{n-2} \\ 0 & 1 & x_3 & \cdots & x_3^{n-3} & x_3^{n-2} \\ \vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\ 0 & 1 & x_{n-1} & \cdots & x_{n-1}^{n-3} & x_{n-1}^{n-2} \\ 0 & 1 & x_n & \cdots & x_n^{n-3} & x_n^{n-2} \end{vmatrix} \\ &= \prod_{k \mathop = 2}^n \left({x_k - x_1}\right) V_{n-1} \end{align*} 以此类推， $$ V_n = \prod_{k \mathop = 2}^n \left({x_k - x_1}\right) \prod_{k \mathop = 3}^n \left({x_k - x_2}\right) V_{n-2} = \cdots = \prod_{1 \mathop \leqslant i \mathop < j \mathop \leqslant n} \left({x_j - x_i}\right) = \prod_{1 \mathop \leqslant i \mathop < j \mathop \leqslant n} \left({x_j - x_i}\right) $$ 方法二 将行列式中 $V_n$ 中的所有 $x_n$ 替换为未知量 $x$，则 $V_n$ 可视为关于 $x$ 的 $n-1$ 次多项式，记为 $P(x)$，并按最后一行展开： \begin{align*} P \left({x}\right) &= \begin{vmatrix} 1 & x_1 & x_1^2 & \cdots & x_1^{n-2} & x_1^{n-1} \\ 1 & x_2 & x_2^2 & \cdots & x_2^{n-2} & x_2^{n-1} \\ 1 & x_3 & x_3^2 & \cdots & x_3^{n-2} & x_3^{n-1} \\ \vdots & \vdots & \vdots & \ddots & \vdots & \vdots \\ 1 & x_{n-1} & x_{n-1}^2 & \cdots & x_{n-1}^{n-2} & x_{n-1}^{n-1} \\ 1 & x & x^2 & \cdots & x^{n-2} & x^{n-1} \end{vmatrix} \\ &= \begin{vmatrix} x_1 & x_1^2 & \cdots & x_1^{n-2} & x_1^{n-1} \\ x_2 & x_2^2 & \cdots & x_2^{n-2} & x_2^{n-1} \\ x_3 & x_3^2 & \cdots & x_3^{n-2} & x_3^{n-1} \\ \vdots & \vdots & \vdots & \ddots & \vdots \\ x_{n-1} & x_{n-1}^2 & \cdots & x_{n-1}^{n-2} & x_{n-1}^{n-1} \end{vmatrix} \ \ + \ \ \begin{vmatrix} 1 & x_1^2 & \cdots & x_1^{n-2} & x_1^{n-1} \\ 1 & x_2^2 & \cdots & x_2^{n-2} & x_2^{n-1} \\ 1 & x_3^2 & \cdots & x_3^{n-2} & x_3^{n-1} \\ \vdots & \vdots & \vdots & \ddots & \vdots \\ 1 & x_{n-1}^2 & \cdots & x_{n-1}^{n-2} & x_{n-1}^{n-1} \end{vmatrix}x \\ & \mathrel{\phantom{=}} + \ \ \cdots \ \ + \ \ \begin{vmatrix} 1 & x_1 & x_1^2 & \cdots & x_1^{n-2} \\ 1 & x_2 & x_2^2 & \cdots & x_2^{n-2} \\ 1 & x_3 & x_3^2 & \cdots & x_3^{n-2} \\ \vdots & \vdots & \vdots & \ddots & \vdots \\ 1 & x_{n-1} & x_{n-1}^2 & \cdots & x_{n-1}^{n-2} \end{vmatrix}x^{n-1} \end{align*} 显然 $P(x_1) = P(x_2) = \cdots = P(x_{n-1}) = 0$，由多项式分解定理可知 $$ P(x) = V_{n-1} \prod_{i=1}^{n-1} (x-x_i) $$ 将 $x$ 替换成 $x_n$，由递推可得： $$ V_n = \prod_{1 \leqslant i < n} (x_n - x_i) V_{n-1} = \prod_{1 \leqslant i < n} (x_n - x_i) \prod_{1 \leqslant i < n-1} (x_{n-1} - x_i) V_{n-2} = \cdots = \prod_{1 \leqslant i < j \leqslant n} (x_j - x_i) $$ 但是解这个线性方程组是很不明智的，如果数据点较近，\(\boldsymbol{V}\) 会接近奇异矩阵。而拉格朗日插值法则不需要硬着头皮解方程。 拉格朗日插值 \(n\) 次 Lagrange 插值多项式系数 \(l_0(x), l_1(x), \ldots, l_n(x)\) 定义为 \(l_i(x_j)= \begin{cases} 1, &amp; i=j \\ 0, &amp; i\neq j \\ \end{cases}\)，则多项式可表示为 \[ P(x) = y_0 l_0(x) + y_1l_1(x) + \cdots + y_nl_n(x) = \sum_{i=0}^n y_il_i(x) \] 注意这里的每个 \(l_i(x)\) 均为 \(n\) 次多项式，且由定义可知 \(l_i(x)\) 有 \(n\) 个根 \[ x_0, x_1, x_2, \ldots, x_{i-1}, x_{i+1}, \ldots, x_n \] 所以 \(l_i(x)\) 可表示成 \(l_i(x) = C_i \prod\limits_{j\neq i} (x - x_j)\)，进一步由 \(l_i(x)\) 定义， \[ 1 = l_i(x_i) = C_i \prod_{j\neq i} (x_i - x_j) \ \Rightarrow \ C_i = \frac{1}{\prod\limits_{j\neq i} (x_i - x_j)} \ \Rightarrow \ l_i(x) = \frac{\prod\limits_{j\neq i}(x - x_j)} {\prod\limits_{j\neq i}(x_i - x_j)} \] 所以 Lagrange 插值多项式为 \[ p(x) = \sum_{i=0}^n y_i \frac{\prod\limits_{j\neq i}(x - x_j)} {\prod\limits_{j\neq i}(x_i - x_j)} = \sum_{i=0}^n y_i \frac{(x-x_0)(x-x_1)\cdots (x-x_{i-1})(x-x_{i+1})\cdots (x-x_n)} {(x_i-x_0)(x_i-x_1)\cdots (x_i-x_{i-1})(x_i-x_{i+1})\cdots (x_i-x_n)} \] 从形式上看，Lagrange 插值法是容易实现的，但如果加入新的数据点，则需要重新计算多项式系数，即算法随着数据点的增多不能复用以前的计算结果。 拉格朗日插值 Matlab 程序代码 123456789101112131415161718function [f, f0] = interp_lagrange(x, y, x0, prec) if nargin &lt;= 3, prec = 4; if length(x) == length(y), n = length(x) - 1; else error('Incompatible dimension of x and y !!'); end syms t; f = 0; for k = 1:n xs = [x(1:k-1) x(k+1:n)]; f = f + y(k) * prod((t-xs)./(x(k)-xs)); end f = vpa(f, prec); if nargin &gt; 2, f0 = vpa(subs(f, t, x0), prec); end;end 艾特肯插值 首先，由点 \((x_0, y_0)\) 到 \((x_j, y_j), j=1,2,\ldots,n\) 可以确定 \(n\) 组一次多项式，即穿过两点的直线；第二步，根据 $$，进一步生成 \(n-1\) 组二次多项式。次过程共重复 \(n\) 次，最终得到一个 \(n\) 次多项式。 具体而言，由点 \((x_0, y_0)\) 及 \((x_1, y_1)\) 得到的一次多项式为 \[ p_{01}(x) = \frac{x-x_1}{x_0-x_1}y_0 - \frac{x-x_0}{x_1-x_0}y_1 = \frac{1}{x_1-x_0} \begin{vmatrix} y_0 &amp; x_0 - x \\ y_1 &amp; x_1 - x \end{vmatrix} \] 类比之，由 \(x_0\) 及 \(x_j\) 确定的一次多项式表示为 \[ p_{0j}(x) = \frac{1}{x_j-x_0} \begin{vmatrix} y_0 &amp; x_0 - x \\ y_j &amp; x_j - x \end{vmatrix}, \quad j = 1,2,\ldots,n \] 进一步，由点 \((x_0, y_0), (x_1, y_1), (x_j, y_j)\) 确定的二次多项式为 \[ p_{01j}(x) = \frac{1}{x_j - x_1} \begin{vmatrix} p_{01}(x) &amp; x_1 - x \\ p_{0j}(x) &amp; x_j - x \end{vmatrix}, \quad j=2,3,\ldots,n \] 一般而言，对于 \(k+2\) 个数据点 \((x_0, y_0), (x_1, y_1), \ldots, (x_k, y_k)\) 及 \((x_j, y_j)\)，\(k+1\) 次插值多项式为 \[ p_{012\cdots kj}(x) = \frac{1}{x_j - x_k} \begin{vmatrix} p_{012\cdots k}(x) &amp; x_k - x \\ p_{012\cdots (k-1)}(x) &amp; x_j - x \end{vmatrix} \quad j=k+1,\ldots, n \] 整个计算过程如下表 \[ \begin{array}{cccccc|c} \hline x_j &amp; y_j &amp; p_{0j} &amp; p_{01j} &amp; p_{012j} &amp; p_{0123j} &amp; x_j-x \\ \hline x_0 &amp; y_0 &amp; &amp; &amp; &amp; &amp; x_0-x \\ x_1 &amp; y_1 &amp; p_{01} &amp; &amp; &amp; &amp; x_1-x \\ x_2 &amp; y_2 &amp; p_{02} &amp; p_{012} &amp; &amp; &amp; x_2-x \\ x_3 &amp; y_3 &amp; p_{03} &amp; p_{013} &amp; p_{0123} &amp; &amp; x_3-x \\ x_4 &amp; y_4 &amp; p_{04} &amp; p_{014} &amp; p_{0124} &amp; p_{01234} &amp; x_4-x \\ \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots &amp; \cdots \\ x_n &amp; y_n &amp; p_{0n} &amp; p_{01n} &amp; p_{012n} &amp; p_{0123n} &amp; x_n-x \\ \hline \end{array} \] 艾特肯插值 Matlab 程序代码 123456789101112131415161718192021function [f, f0] = interp_aitken(x, y, x0, prec) if nargin &lt;= 3, prec = 4; if length(x) == length(y), n = length(x) - 1; else error('Incompatible dimension of x and y !!'); end syms t; f = 0; lastp = y; xs = x - t; for k = 1:n for j = k+1:n+1 curp(j) = (lastp(k)*xs(j) - lastp(j)*xs(k)) / (xs(j)-xs(k)); end lastp = curp; end f = vpa(simplify(lastp(end)), prec); if nargin &gt; 2, f0 = vpa(subs(f, t, x0), prec); end;end]]></content>
      <categories>
        <category>Applied Mathematics</category>
      </categories>
      <tags>
        <tag>Matlab</tag>
        <tag>Interpolation</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java 关于栈的简单应用]]></title>
    <url>%2Fsimple-example-of-stack-in-java%2F</url>
    <content type="text"><![CDATA[此篇为「算法」一书 §1.3 中关于栈的应用部分的学习记录。 这本算法书在很多例子中使用作者开发的库 algs4.jar。目前以 Idea 作为 Java 开发环境，那么为什么不用 Eclipse？IDE 颜值 + Vim 插件 是王道。这里提下将 algs4.jar 加入 classpath 的操作：C-S-A-s 或选中工程目录按 F4，在弹出的项目结构 (Project Structure) 中依次定位：Modules -xxx（需要操作的项目）- Dependencies - - JARs or directories...，定位至 algs4.jar 即可。这样就可以直接在 Java 代码中引入 jar 包了，调试运行时的命令显示如下： 1234D:\Java\jdk-10\bin\java -javaagent:D:\Idea\lib\idea_rt.jar=xxxxx:D:\Idea\bin \-Dfile.encoding=UTF-8 \-classpath E:\WorkingDirectory\Projects\Java\Algorithms\out\production\Algorithms;\E:\WorkingDirectory\Projects\Java\Algorithms\lib\algs4.jar ch_01.Test Dijkstra 双栈算术表达式求值算法 这里的代码适用范围较窄，仅支持如下格式的算术表达式： 12( 1 + ( 2 + 3 ) * ( 4 * 5 ) ) )( ( 1 + sqrt ( 5.0 ) ) / 2.0 ) 即运算符、左右括号、操作数之间必须存在空格，且每个 +-*/ 需要一对括号，即类似 ( 2 + 5 ) / ( 4 * 7 ) 这种情况是会出错的，且不能有多余的括号。对于符合条件的算式，想法和采取的手段很简单：逐个读取字符，读到数字或运算符，则将其压入相应的操作数栈或运算符栈；读到右括号，则说明与其最近配对的左括号内的算式结果可以算出来，并将结果压入操作数栈，继续读取后面的字符。 由于符合条件的算式中的括号是成对出现的，于是右括号就相当于一个「弹栈」的标志；而 +-*/ 对应两个操作数，所以弹栈时若从运算符栈弹出一个运算符，则需从操作数栈弹出两个操作数，并将运算的结果压入操作数栈；遇到 sqrt 这种「单目」操作符（这里姑且称之为操作符），则两个栈各弹一个，运算结果压入操作数栈。下面为具体实现。（将原书中的 if-else 分支语句改为了 switch-case 语句以提高可读性） 123456789101112131415161718192021222324252627282930313233import edu.princeton.cs.algs4.*;public class DijkstraExpressionValue &#123; public static void main(String[] args) &#123; Stack&lt;String&gt; ops = new Stack&lt;&gt;(); Stack&lt;Double&gt; val = new Stack&lt;&gt;(); while (!StdIn.isEmpty()) &#123; String s = StdIn.readString(); switch (s) &#123; case "(": break; case "+": case "-": case "*": case "/": case "sqrt": ops.push(s); break; case ")": &#123; String op = ops.pop(); double v = val.pop(); switch (op) &#123; case "+": v = val.pop() + v; break; case "-": v = val.pop() - v; break; case "*": v = val.pop() * v; break; case "/": v = val.pop() / v; break; case "sqrt": v = Math.sqrt(v); break; &#125; val.push(v); break; &#125; default: val.push(Double.parseDouble(s)); break; &#125; &#125; System.out.printf("%.6f\n", val.pop()); &#125;&#125; 测试： 123( 1 + ( 2 + 3 ) * ( 4 * 5 ) ) ) : 101.000000( ( 1 + sqrt ( 5.0 ) ) / 2.0 ) : 1.618034sqrt ( ( 1 * ( 2 * ( 3 * ( 4 * ( 5 * 6 ) ) ) ) ) ) : 26.832816 如果这个例子高级了点，下这个手动实现栈的例子就比较简单而有趣了。 TODO]]></content>
      <categories>
        <category>Algorithms</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Stack</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[第 n 名用户]]></title>
    <url>%2Fnth-user%2F</url>
    <content type="text"><![CDATA[T.T.T.#6: nth user A product to do market research, n users to participate in the activities. They give each user a number. The first user number is 1, second users numbered 2, and so on... But no digits 4 and 9 in user's numbers, that is to say the number of 3rd users is 3, the number of 4th users is 5...the number of 8th users is 10... like this: 12user 1st 2nd 3rd 4th 5th 6th 7th 8th 9th 10th ........ nthnumber 1 2 3 5 6 7 8 10 11 12 ........ ?? Please calculate, how much is the number of the nth user? 简言之，从 \(1\) 开始，将不含 \(4\) 和 \(9\) 的正整数依次写下来，求第 \(n\) 个数。 简单的尝试 暴力穷举，从 \(1\) 开始逐个验证是否含有数码 \(4\) 和 \(9\) 即可。原题仅支持 Javascript 及 C# 代码提交，所以写段 C# ： 1234567891011121314151617181920using System;public class Kata &#123; private static Boolean CheckValidNumber(int n) &#123; for (; n != 0; n /= 10) if (n % 10 == 4 || n % 10 == 9) return false; return true; &#125; public static string UserNumber(int n) &#123; int t = 1, tmp = 1; while (t++ &lt;= n) &#123; while (true) if (CheckValidNumber(tmp++)) break; &#125; return (tmp - 1).ToString(); &#125;&#125; 不出所料超时：Process was terminated. It took longer than 12000ms to complete。 巧用进制 观察符合题意的数字： 列表 I12345678910 1 2 3 5 6 7 8 10 11 12 13 15 16 17 18 20 21 22 23 25 26 27 28 30 31 32 33 35 36 37 38 50 51 52 53 55 56 57 58 60 61 62 63 65 66 67 68 70 71 72 73 75 76 77 78 80 81 82 83 85 86 87 88100 101 102 103 105 106 107 108... 很容易发现每个数的个位顺序均为 \(0, 1, 2, 3, 5, 6, 7, 8\), 第一行除外。如果将这个序列映射到容易处理的序列如自然数序列、其它进制数序列，则可将问题化归至简单问题上，联想到八进制的逢八进一，把上述列表按照「八进制」的规则重排： 列表 II1234567891011 1 2 3 4 5 6 7 10 11 12 13 14 15 16 17 20 21 22 23 24 25 26 27 30 31 32 33 34 35 36 37 40 41 42 43 44 45 46 47 50 51 52 53 54 55 56 57 60 61 62 63 64 65 66 67 70 71 72 73 74 75 76 77 80 81 82 83 84 85 86 87 90 91 92 93 94 95 96 97... 建立了一个一一映射 \(\mathrm{II} \mapsto \mathrm{I}\)。于是对于题目中的第 \(n_{(10)}\) 个的数字，可先将其转为八进制后表示的数字 \(n_{(8)}\)，在列表 II 中定位这个数，再到列表 I 转换即可。西莎普代码实现： 1234567private static string UserNumber(int n) &#123; char[] tb = &#123;'0', '1', '2', '3', '5', '6', '7', '8'&#125;; var n8 = Convert.ToString(n, 8).ToCharArray(); for (int i = 0; i &lt; n8.Length; i++) n8[i] = tb[n8[i] - '0']; return String.Concat(n8);&#125; 测试： 1234567891 : 12 : 25 : 610 : 121000 : 18605000 : 1171099999 : 3032381000000 : 37511009999999 : 57113188 拓展 – 包含一系列数字 序列 \(\{c_n\}\) 由正整数中去除含有数字 \(a_1, a_2, \ldots, a_k \ (k &lt; 9, a_i \neq 0)\) 的数组成，确定其第 \(N\) 项。 由于去除了 \(k\) 个数码，所以这个序列中的数字由 \(10 - k\) 个数码组成，这些剩下的数码记为 $ b_1, b_2, , b_{10-k} $。同样的思路，将 \(0, 1, \ldots, 9-k\) 分别对应至 \(b_1, b_2, \ldots, b_{10-k}\)，之后将 \(N\) 转为 \(10 - k\) 进制数，利用这层映射关系得到原数。附上 Java 代码: 12345678910111213141516public static String generalUserNumber(int n, int[] a) &#123; int base = 10 - a.length; int[] tmp = new int[10]; char[] b = new char[base]; for (int t : a) tmp[t] = -1; for (int i = 0, j = 0; i &lt; 10; i++) &#123; if (tmp[i] != -1) &#123; b[j] = (char) (i + '0'); j++; &#125; &#125; char[] nb = Integer.toString(n, base).toCharArray(); for (int i = 0; i &lt; nb.length; i++) nb[i] = b[nb[i] - '0']; return String.valueOf(nb);&#125; 测试： 123410 [1, 3, 5, 7, 9] : 4020 [2, 4, 6, 8] : 5330 [8, 4, 6, 9, 2, 7] : 1532048 [9, 8, 7, 6, 5, 4, 3, 2] : 100000000000]]></content>
      <categories>
        <category>Algorithms</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>C-Sharp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Matlab 程序设计示例]]></title>
    <url>%2Fessentials-of-matlab-examples%2F</url>
    <content type="text"><![CDATA[记录 Matlab 经典、有趣的程序例子。 三位数 将 \(1\sim 9\) 这 \(9\) 个数字组成 \(3\) 个三位数，要求第 \(2\) 个三位数是第 \(1\) 个三位数的 \(2\) 倍，要求第 \(3\) 个三位数是第 \(1\) 个三位数的 \(3\) 倍，找出所有可行方案。 笔者的思路很简单，首先初始化一个 \(1 \times 10\) 数组代表数码 \(0 \sim 9\) 出现的次数，把试验的数组拼接成字符，再一个萝卜一个萝卜地填坑，如果坑 \(1\) 至坑 \(9\) 全部被填满则符合题意；比如 \(123123123\) 填坑的结果就是 \([0\ 1\ 1\ 1\ 0\ 0\ 0\ 0\ 0\ 0]\)，“坑”没有被填满，不符题意。 代码 123456789101112131415161718count = 0;for m = 123:329 digs = zeros(1, 10); nums = m * (1:3); allc = strrep(num2str(nums), ' ', ''); for k = 1:9 digs(allc(k)-'0'+1) = 1; end if sum(digs(2:end)) == 9 count = count + 1; fprintf('第 %d 组解: %s\n', count, mat2str(nums)); endend% 第 1 组解: [192 384 576]% 第 2 组解: [219 438 657]% 第 3 组解: [273 546 819]% 第 4 组解: [327 654 981] 当然《MATLAB 数值计算实战》作者的代码更加赏心悦目： 12345678count = 0;for m = 123:329 s = num2str(m * [1;2;3]) - '0'; if isequal(sort(s(:)).', 1:9) count = count + 1; fprintf('第 %d 组解: %s\n', count, mat2str(m * (1:3))); endend 首先其转化为字符的过程中使用了列向量而行向量，于是 s 为 \(3 \times 3\) 的数组，而笔者则需要把重心放在字符串的处理上，相当伤脑筋。后面直接将 s 拉直、转置为 \(1 \times 9\) 的字符数组进行排序，与 \(1:9\) 进行对比即可，一气呵成。 杨辉三角 对于给定行数，美观输出杨辉三角，需要事先确定好每个数字所占宽度，这里将宽度设定为所有数字中最大数的字符个数的两倍（\(2d\)）。其次需要控制好三角形左边的空格长度。 代码 12345678910111213function pasc_triangle(N) m = fix(log10(nchoosek(N-1, ceil((N-1)/2))))+1; d = ceil((m+3)/2); x = 1; fprintf([blanks(d*(N-1)), '%-', int2str(2*d), 'd\n'], x); for k=2:N fprintf(blanks(d*(N-k))); x = [0, x]+[x, 0]; fprintf(['%-', int2str(2*d), 'd'], x); % fprintf('%-*d', [repmat(2*d, 1, length(x)); x]); fprintf('\n'); endend 约瑟夫环 设有 \(n\) 个人围成一圈，从位置 \(s\ (1 \leqslant s \leqslant n)\) 上的人从 \(1\) 开始报数，数到 \(m\) 的人即出列。下一个人即原来第 \(m+1\) 位置上的人又从 \(1\) 报数，报到第 \(m\) 个人出列。重复此过程直至所有人全部出列位置。 首先需要理解一个简单的公式。 $n$ 个有序点围成的圆圈中第 $x$ 个元素按照序号增大的方向移动 $k$ 步后所在的位置为 $$ (x+k-1) \ \text{mod} \ n + 1 \tag{J} \label{J} $$ 于是以下两种方法均可实现算法。 1234567891011121314151617181920212223242526function seq = joseph1(n, s, m) seq = []; seat = ones(1, n); s = s - 1; while any(seat) for k = 1:m s = 1 + mod(s, n); while ~seat(s) s = 1 + mod(s, n); end end seat(s) = 0; seq = [seq, s]; endendfunction seq = joseph2(n, s, m) seq = zeros(1, n); seat = 1:n; s = s - 1; for k = n:-1:1 s = mod(s + m - 1, k); seq(n - k + 1) = seat(s + 1); seat(s + 1) = []; endend 第一种方法思路很简单：总体不变，因为每轮会有人出局，所以设置“落座”记号，有人为 \(1\) 无人为 \(0\)。每轮需要有 \(m\) 次“有效的”移动，即移动到下一个座位上必须有人，否则继续移动。 第二种代码就比较简洁了，程序中的 \(s\) 时始终表示下一轮第一个人前面的位置，所以公式 \(\eqref{J}\) 需要减去 \(1\)。每轮结束移除已出列的数字，直至数组为空为止。 连续数字出现次数 对于一个行向量 \([0\ 0\ 0\ 1\ 1\ 1\ 0\ 1\ 1\ 0\ 0\ 1\ 1\ 1\ 0\ 0\ 0\ 1]\)，统计连续 \(1\) 出现的位置以及次数。 考虑其一阶差分：\([0\ 0\ 1\ 0\ 0\ -1\ 1\ 0\ -1\ 0\ 1\ 0\ 0\ -1\ 0\ 0\ 1]\)，可观察到原向量中开始出现 \(1\) 的位置在差分后的向量中也为 \(1\)，并结束于 \(-1\) 之前。但考虑到首末问题，应该在原向量首尾各添加 \(0\) 以保证正确性。代码如下： 1234567x = [0 0 0 1 1 1 0 1 1 0 0 1 1 1 0 0 0 1];dx = diff([0 x 0]);res = [find(dx==1); find(dx==-1) - find(dx==1)]% res =% 4 8 12 18% 3 2 3 1]]></content>
      <categories>
        <category>Development and Deployment</category>
      </categories>
      <tags>
        <tag>Matlab</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Matlab 程序设计之编程技巧]]></title>
    <url>%2Fessentials-of-matlab-skills%2F</url>
    <content type="text"><![CDATA[记录学习 Matlab 中的技巧。 fprintf 技巧 Matlab 中的运算均基于向量，甚至连输出函数 fprintf 也不例外。 对于一个实际问题： $3$ 对情侣参加婚礼，$3$ 个新郎为 $A$、$B$、$C$，$3$ 个新娘为 $X$、$Y$、$Z$。有人不知道谁和谁结婚，于是询问 $6$ 位新人中的 $3$ 位，$3$ 人回答道：$A$ 和 $X$ 结婚；$X$ 和 $C$ 结婚；$C$ 和 $Z$ 结婚。但 $3$ 人说的全是假话。 为判明事实真相，穷举即可： 123456789for A='X':'Z' for B='X':'Z' for C='X':'Z' if A ~= 'X' &amp;&amp; C ~= 'X' &amp;&amp; C ~= 'Z' &amp;&amp; A ~= B &amp;&amp; B ~= C &amp;&amp; C ~= A fprintf('新郎 %c 将和新娘 %c 结婚\n', ['A', 'B', 'C'; A, B, C]); endend; end; end% 新郎 A 将和新娘 Z 结婚% 新郎 B 将和新娘 X 结婚% 新郎 C 将和新娘 Y 结婚 注意到一条语句便可产生 \(3\) 条输出，说明应以向量的角度思考看待问题。 灵活的输入输出 验证算术平均数 \(A_n=\frac 1n \sum a\)、几何平均数 \(G_n=\prod a^{1/n}\)、调和平均数 \(H_n=n/(\sum 1/a)\)、平方平均数 \(Q_n=\sqrt{1/n \sum a^2}\) 的大小关系为 \(H_n \leqslant G_n \leqslant A_n \leqslant Q_n\)。代码如下： 1234567891011121314151617181920212223242526272829303132333435363738[A, G, H, Q] = averages(1, 2, 3, 4, 5, 6, 7, 8);T = averages([1;2;3], [2;4;5], [6;4;7], [9;7;4], [8;3;5]);disp([A G H Q]);disp(T);function varargout = averages(varargin) n = nargin; [An, Gn, Hn, Qn] = deal(0, 1, 0, 0); for k=1:n ak = varargin&#123;k&#125;; if any(ak) &lt;= 0, error('输入参数必须为正数.'), end; An = An + ak; Gn = Gn .* ak; Hn = Hn + 1 ./ ak; Qn = Qn + ak .^ 2; end A = An / n; G = Gn .^ (1/n); H = n ./ Hn; Q = sqrt(Qn/n); if nargout == 1 varargout&#123;1&#125; = table(... A, G, H, Q, 'VariableNames', ... &#123;'Arithmetic', 'Geometric', 'Harmonic', 'Square'&#125; ... ); else [varargout&#123;1:4&#125;] = deal(A, G, H, Q); endend% 4.5000 3.7644 2.9435 5.0498% Arithmetic Geometric Harmonic Square% __________ _________ ________ ______% 5.2 3.8664 2.6277 6.0992% 4 3.6768 3.3871 4.3359% 4.8 4.6179 4.4397 4.98 这段代码有很多地方可圈可点。首先通过 varargin、varargout 说明函数 averages 是「变长度」输入输出函数，也就是说如果调用该函数的时候可以针对不同的输入、输出表现出不同的结果，如代码中的判断语句，针对 nargout 实现了分别赋值给四个输出参数、输出表格的不同表现形式；在初始化参数时运用 deal 实现了「多重赋值」；在处理每个 varargin(k) 时将其视为数组，并进行必要的判断。]]></content>
      <categories>
        <category>Tips and Tricks</category>
      </categories>
      <tags>
        <tag>Matlab</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Matlab 程序设计之作图]]></title>
    <url>%2Fessentials-of-matlab-plotting%2F</url>
    <content type="text"><![CDATA[Matlab 画图质量随着版本号迭代有着显著提升，而且入门较简单。 比如这个「奥运五环」： 12345678910111213a = 2;r = 1.2;hold on;theta = linspace(0, 2 * pi).';X = [-a, 0, a, a / 2, -a / 2];Y = [0, 0, 0, -sqrt(2) / 2 * a, -sqrt(2) / 2 * a];plot([X, X(1)], [Y, Y(1)], '.--', 'markersize', 20);circles = plot((X + Y * 1i) + r * exp(theta * 1i), 'linewidth', 5);% circles = plot(X+r*cos(theta), Y+r*sin(theta), 'linewidth', 5);set(circles, &#123;'color'&#125;, num2cell('bkrgy')');axis off equal;hold off;saveas(gcf, 'olympic-rings.svg'); 其中利用极坐标画圆有点意思，由于 plot 函数能直接对复数的实数 - 虚数对进行绘图，所以通过 \[ x+r\cos\theta + \mathrm{i}\, (y+r\sin\theta) = r e^{\mathrm i\, \theta} + (x + \mathrm i\, y) \] 也能绘制出圆形。另外批量对线条改变颜色的代码参考了 Explicitly specifying line colors when plotting a matrix。 交互图形的制作也十分方便。对于定积分 \(\displaystyle I = \int_0^{\frac 12} \frac{1}{1+x^3}\, \mathrm dx\) 考察其被积函数以及其 \(5\) 阶 Taylor 展开函数的图形。 12345678910111213141516syms x;f = 1 / (1 + x ^ 3);I1 = int(f, 0, 1/2);ft = taylor(f, 'order', 6);I2 = int(ft, 0, 1/2);fpl = fplot([f, ft], [0, 1/2]);set(gca, 'fontname', 'Euclid', 'fontweight', 'bold');set(fpl, 'linewidth', 1.2, &#123;'linestyle'&#125;, &#123;'-'; '--'&#125;, 'color', 'k');legend(&#123;['$$f=', latex(f), '$$'], ['$$f_&#123;\rm Taylor&#125;=', latex(ft), '$$']&#125;, ... 'interpreter', 'latex', 'fontsize', 11);gtext(&#123;['$$\int_0^&#123;\frac 12&#125;', latex(f), '\, \mathrm dx=', latex(I1), ... '\approx', latex(vpa(I1, 4)), '$$'], ... ['$$\int_0^&#123;\frac 12&#125;\left(', latex(ft), '\right)\, \mathrm dx=', ... latex(I2), '\approx', latex(vpa(I2, 4)), '$$']&#125;, ... 'interpreter', 'latex', 'fontsize', 11);box off;]]></content>
      <categories>
        <category>Memos</category>
      </categories>
      <tags>
        <tag>Matlab</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Matlab 程序设计之编程基础]]></title>
    <url>%2Fessentials-of-matlab-foundation-of-programming%2F</url>
    <content type="text"><![CDATA[本系列试图将笔者在研究过程中认为比较重要、容易遗忘以及富有创新性或启发性的程序代码及思想一一记录，一来节省遇见同类问题时耗费在检索资料上的时间，二来也能见证自己构建知识体系框架的历程。 新版本的马特来布添加了诸多与时俱进的特性和工具箱，一直为人诟病的画图也自带抗锯齿了，R2016b 后的版本也支持脚本中函数了。MathWorks 始终坚持半年一新地迭代着 Matlab 的版本，可见其非常地用心。花了三天时间分别在 Windows 10 及 Ubuntu 16.04 x64 下安装好 Matlab，因个人感觉 2017 以后的版本在 Windows 上卡顿明显，所以 Win 和 Linux 下的版本均为 R2017b。当然后者是面向终端的命令行版的： 1/usr/local/MATLAB/R2017b/bin/matlab -nodisplay 目前参考的书籍有： 《MATLAB 语言常用算法程序集》（电子版） 《MATLAB 之父：编程实践》（电子版） 《高等应用数学问题的 MATLAB 求解》（电子版） 《MATLAB 数值计算》（电子版） 《大学数学实验》（电子版） 《MATLAB 统计分析与应用：40 个案例分析》 《MATLAB 数学建模》 《MATLAB 数值计算实战》 说实话，有点贪心，但也是种挑战。若能在短时间内去其糟粕取其精华，相比也是种奇妙的学习体验。 一般社会哥人狠话不多，闲话至此，下面进入没有主题的正题。 Linux 下安装的时候出现了点小插曲，在其中一台 Ubuntu 16.04.4 的机器上安装完 Matlab 2017b 后，无法使用数学符号工具箱，出现如下错误： 12345678&gt;&gt; syms a b c;Error using mupadmexError in MuPAD command: .Error in symengineError in sym (line 189) symengine;Error in syms (line 197)toDefine = sym(zeros(1, 0)); 搜寻所有可能与该问题相关的途径后， 无论是更新、回滚 fontconfig，libfreetype 版本还是重新安装其他版本 Matlab for Linux 后均无效，说明 Linux 下操作系统状态对 Matlab 有一定影响，遂放弃此台服务器。 由于笔者的系统为英文系统，而 Windows 下区分系统 Locale 的方式在于「格式」而非「地区」（具体设置为 Control Panel - Clock, Language, and Region - Region - Formats），所以会出现两个显著问题：程序界面为英文、编辑器里中文乱码。界面为英文倒不能说是问题，但乱码就很令人头疼了。查阅资料后得到的比较一劳永逸的方法是改动「格式」为中国。其他方法如修改文件 lcdata.xml 经亲测并不考谱。另，若仍坚持在英文系统下使用 Matlab，并需输出中文，务必运行语句 1feature('DefaultCharacterSet', 'UTF-8'); Vim 插件 在 .vimrc 中添加： .vimrc123456789101112Plugin 'michaelHL/matlab-screen'Plugin 'tdehaeze/matlab-vim'map &lt;F8&gt; :call CompileRun()&lt;CR&gt;func! CompileRun() exec "w" if &amp;filetype == 'c' :!clear; gcc -std=c11 -Wall % -o %&lt;; time ./%&lt; elseif &amp;filetype == 'matlab' :call RunMatlabCurrentFile() endifendfunc 在 Vim 中打开 .m 文件，F8 即可运行。 基本命令及快捷键 命令 功能 命令 功能 clc 清屏（甚至清除了缓冲区） clear 清除工作空间所有变量 clear all 从工作空间清除所有变量和函数 clear &lt;变量名&gt; 清除指定变量 clf 清除图形窗口内容（注意该命令会弹出新的画布，相当于 figure ） delete &lt;文件名&gt; 从磁盘中删除文件 cla 清空当前坐标系 type 显示 m 文件的内容 help &lt;命令名&gt; 获取所列命令的帮助信息 which &lt;文件名&gt; 查找指定文件路径 who 显示当前工作空间所有变量的一个简单列表 whos 列出变量大小、数据格式等详细信息 what 列出当前目录下的 .m 文件和 .mat 文件 load name 下载 name 文件中的所有变量到工作空间 load name x y 下载 name 文件的变量 x, y 到工作空间 importdata name 将 name 文件中的数据以结构体方式导入工作空间 save name 保存工作空间变量到文件 name.mat 中 save name x y 保存工作空间变量 x, y 到文件 name.mat 中 ↑ 或 &lt;C-p&gt; 调用上一行命令 ↓ 或 &lt;C-n&gt; 调用下一行命令 ← 或 &lt;C-b&gt; 退后一格 → 或 &lt;C-f&gt; 前移一格 Home 或 &lt;C-a&gt; 光标移至行首 Home 或 &lt;C-e&gt; 光标移至行尾 Esc 或 &lt;C-u&gt; 清除一行 Del 或 &lt;C-d&gt; 清除光标后字符 Backspace 或 &lt;C-h&gt; 清除光标前一个字符 &lt;C-k&gt; 清除光标至行尾字符 &lt;C-0&gt; 激活命令窗口 &lt;C-S-0&gt; 激活编辑器窗口 &lt;C-1&gt; 激活命令历史窗口 &lt;C-2&gt; 激活「当前目录」窗口 &lt;C-3&gt; 激活工作空间窗口 如果以上键盘快捷键部分无效，说明是时候把键盘主题改为 Emacs-Style 了：Preference - MATLAB - Keyboard - Shortcuts - Active settings: Emacs Default Set。 常用的帮助命令 命令 功能 命令 功能 help matfun 矩阵函数 - 数值线性代数 help datafun 数据分析和傅立叶变换函数 help general 通用命令 help ops 操作符和特殊字符 help graphics 通用图形函数 help polyfun 多项式和内插函数 help elfun 基本的数学函数 help lang 语言结构和调试 help elmat 基本的矩阵和矩阵操作 help strfun 字符串函数 help control 控制系统工具和工具箱函数 部分预定义变量 变量或函数 说明 变量或函数 说明 ans 默认变量名，以应答最近一次操作运算结果 eps 浮点数的相对误差 i, j 虚数单数 pi 圆周率 intmax 本计算机能表示的 8 位、16 位、32 位、64 位的最大整数 intmin 本计算机能表示的 8 位、16 位、32 位、64 位的最小整数 realmax 本计算机能表达的最大浮点数 realmin 本计算机能表达的最小浮点数 Inf 或 inf 无穷大 NaN 或nan 非数 computer MATLAB 运行平台 version MATLAB 版本字符串 数据显示格式 摘自 MathWorks 文档 - 设置命令行窗口输出显示格式： 风格 结果 示例 short (default) 固定十进制短格式，小数点后包含 4 位数 3.1416 long 长固定小数格式，double 值的小数点后包含 15 位数，single 值的小数点后包含 7 位数 3.141592654 shortE 短科学记数法，小数点后包含 4 位数 3.14E+00 longE 长科学记数法，double 值的小数点后包含 15 位数，single 值的小数点后包含 7 位数 3.14E+00 shortG 短固定小数格式或科学记数法（取更紧凑的一个），总共 5 位 3.1416 longG 长固定小数格式或科学记数法（取更紧凑的一个），对于 double 值，总共 15 位；对于 single 值，总共 7 位 3.141592654 shortEng 短工程记数法，小数点后包含 4 位数，3 的倍数 3.14E+00 longEng 长工程记数法，包含 15 位有效位数，指数为 3 的倍数 3.14E+00 + 正/负格式，对正、负和零元素分别显示 +、- 和空白字符 + bank 货币格式，小数点后包含 2 位数 3.14 hex 二进制双精度数字的十六进制表示形式 400921fb54442d18 rat 小整数的比率 355/113 compact 隐藏过多的空白行以便在一个屏幕上显示更多输出 theta = pi/2 theta = 1.5708 loose 添加空白行以使输出更易于阅读 theta = pi/2 theta = 1.5708 数值型数据 关于整型数据相关的操作函数（操作数可以是浮点数，也就是默认的数值类型） 函数 说明 函数 说明 ceil 向正无穷大方向取整 fix 向 0 取整 floor 向负无穷大方向取整 round 四舍五入取整 isinteger 判断是否为整数 mod / rem 求模 / 余数 关于虚数的一些操作函数 函数 说明 函数 说明 isreal 检查是否为实数 abs 求复数幅值 real 返回复数实部 angle 求复数相位 imag 返回复数虚部 conj 返回复数的共轭复数 字符向量及字符串 类似于 C 语言里的「字符数组」， Matlab 中的字符向量也是以字符数组形式存在的。如 size('abc\nabc') 返回 8。字符向量可由 [...] 以及 char 来创建。常见的字符向量操作函数如下表： 函数 说明 函数 说明 ischar 检查是否为字符数组 isletter 检查数组元素是否为字母 isspace 检查数组元素是否为空格 isstrprop 判断字符串是否属于某种特定类型 strcat 横向连接字符数组 strvcat 纵向连接字符数组，建议用 char blanks 创建空字符串 strjust 调整字符串的对齐方式 strtrim 去掉字符串首尾的空格 deblank 去掉字符串尾部的空格 strfind 在长字符串中搜索短字符串 strtok 找出字符串中第一个分隔符前面的部分 strrep 字符串查找与替换 strmatch 查找匹配的字符串 lower 将字符串中所包含的字母转换为小写 upper 将字符串中所包含的字母转换为大写 strcmp strcmpi 字符串比较，后者忽略大小写 strncmp strncmpi 比较字符串前 n 个字符，后者忽略大小写 strjoin 将字符串元胞连接成一个字符串 strsplit 将字符串分割成字符串元胞数组 sprintf 格式化输出数据至字符串 sscanf 从字符串中读取格式化数据 regexp regexpi 匹配正则表达式，后者忽略大小写 regexprep 使用正则表达式替换文本 regexptranslate 将文本转换为正则表达式 令人吃驚的是，R2017a 以前的版本都不可用「双引号」括住字符以表示字符串。摘自 MathWorks 文档 - 字符串数组： 从 R2016b 开始，您可以使用字符串数组而不是字符数组来表示文本。字符串数组的每个元素存储一个字符序列。序列可以具有不同长度，无需填充，例如 “yes” 和 “no”。只有一个元素的字符串数组也称为字符串标量。 您可以通过用双引号括起一段文本来创建字符串。从 R2017a 开始引入双引号。 针对字符数组 / 向量和字符串，有必要做一系列探究。 最基本的 char(A) 或 char(A1, ... , An) 将数组 A 转为字符数组，相当于 Perl / Python 中的 chr，当然这里是向量版： 12345678char(65:90, 97:122)strcat(65:90, 97:122)% 2x26 char array% 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'% 'abcdefghijklmnopqrstuvwxyz'%% 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz' 字符向量可由 disp 直接输出： 12disp(['Euler''s Formula: ', latex(sym('exp(i*pi)+1=0'))]);% Euler's Formula: &#123;\mathrm&#123;e&#125;&#125;^&#123;\pi \,i&#125;+1=0 当然上面这个例子会跳出将来会弃用字符向量的警告，这里仅说明 char 的功效，无视即可。更多关于 char 的说明： 如果 A 是数值数组，则 char 将数值转换为字符。有效数值范围从 0 到 65535，并且对应于 Unicode® 代码单元。值 0 到 127 还对应于 7 位 ASCII 字符。char 函数： 将非整数值向零舍入。 将小于 0 的值视为 0。 将大于 65535 的值视为 65535。 如果 A 是字符数组，则 char 返回未改变的 A。 如果 A 是字符数组元胞数组，则 char 将该元胞数组转换为字符数组。元胞数组中每个字符数组的每一行将变成 C 中的一行，并根据需要自动用空格填充。 如果 A 是分类数组，则 char 按列顺序将 A 的每个元素转换为字符数组的一行。 如果 A 是字符串数组，则 char 会将字符串数组转换为字符数组。char 会将 A 中的每个字符串元素转换为字符向量，然后将这些字符向量串联成字符数组，并根据需要自动用空格填充。 除此之外，char 还可以格式化时间： 12char(datetime, 'yyyy-M-d hh:mm')% '2018-7-7 11:44' 而 string 函数显得更为「高阶」一些，下面的例子可以明显看出区别： 123456matlabcode = [109 97 116 108 97 98];disp(char(matlabcode));disp(string(matlabcode));% matlab% "109" "97" "116" "108" "97" "98" string 将数据看成一个整体进行操作（利用 size 可以看出），而不像 char 一样需要对齐数据以纳入矩阵。 另外，对于 strsplit 和 split，大体可认为互为转置的关系： 123456carray = 'm a t l a b';str = string(carray);strsplit(carray) % &#123;'m'&#125; &#123;'a'&#125; &#123;'t'&#125; &#123;'l'&#125; &#123;'a'&#125; &#123;'b'&#125;split(carray) % strsplit(carray)'strsplit(str) % "m" "a" "t" "l" "a" "b"split(str) % strsplit(str)' 元胞数组、结构体以及表数组 对于元胞数组，注意索引 C(m, n) 返回 C 在 (m, n) 位置上的元胞，而花括号 C{m, n} 返回数据。 对于结构体的创建，一般有两种方法： 使用 . 创建： sync.sh123patient1.name = 'John Doe';patient1.billing = 127;patient1.test = magic(3); 当然多维数组也是类似：patient2(1, 1).name = 'John Doe; ... 使用 struct 函数创建： sync.sh1patient1 = struct('name', 'John Doe', 'billing', 127, 'test', magic(3)); 对于 Matlab R2013b 开始引入的表数组类型，一般有两种创建方式： 1234567891011121314151617181920212223Gender = &#123;'M'; 'F'; 'M'; 'M'; 'F'&#125;;Age = [23; 24; 24; 22; 23];Grades = [78 86 80; 67 90 81; 66 70 76; 82 95 85; 64 78 75];Leader = logical([0; 1; 0; 0; 1]);ID = strcat('2017SC', ['003'; '006'; '024'; '005'; '056']);T1 = table(ID, Gender, Age, Grades, Leader, 'RowNames', ... &#123;'Smith', 'Jones', 'Brown', 'Jim', 'Lily'&#125;);T2 = table;T2.ID = ID;T2.Gender = Gender;T2.Age = Age;T2.Grades = Grades;T2.Leader = Leader;T2.Properties.RowNames = &#123;'Smith', 'Jones', 'Brown', 'Jim', 'Lily'&#125;;% 5x5 table% ID Gender Age Grades Leader% _________ ______ ___ ______________ ______% Smith 2017SC003 'M' 23 78 86 80 false% Jones 2017SC006 'F' 24 67 90 81 true% Brown 2017SC024 'M' 24 66 70 76 false% Jim 2017SC005 'M' 22 82 95 85 false% Lily 2017SC056 'F' 23 64 78 75 true 当然了，笔者不偏好后面这种方法，而是尽量从其他格式转换过来。 表数组索引方式比较丰富： 索引类型 语法格式 结果类型 备注 小括号 T(rows, vars) 表格型数据类型 rows / vars 可以是数值向量、逻辑向量以及行/列名组成的元胞数组 大括号 T{rows, vars} 提取的数据 点号索引 T.varT.(varindex) 提取的数据 可以提取表格的一列，还可以进一步对其提取的数据进行索引，如 T.var(index) 或 T.var{index} 下面罗列元胞数组、结构体以及表数组的常用操作： 函数 说明 函数 说明 iscell 判断数组是否为元胞数组 iscellstr 判断数组是否为字符串元胞数组 cellstr 创建字符串元胞数组 cellfun 将函数应用于元胞数组的每一个元素 celldisp 显示元胞的内容 cellplot 显示元胞的图形描述 isstruct 判断是否为结构数组 isfield 判断某字段是否为结构数组中的字段 getfield 获取结构数组中指定字段的值 setfield 设置结构数组中指定字段的值 rmfield 移除结构数据中的指定字段 orderfields 对结构数组中的字段按指定顺序排序 fieldnames 获得结构数组的字段名或对象的属性值 strcfun 将函数应用于结构数组的每一个字段 istable 判断输入是否为表格型类型 summary 打印表格型数据的综述 readtable 从文件中创建表格型数据 writetable 将表格型数据写入文件中 height 表格型数据的行数 width 表格型数据的列数 join 使用关键变量合并两个表格型数据 innerjoin 以交集的形式合并两个表格型数据 outerjoin 以并集的形式合并两个表格型数据 ismissing 查找表格型数据中的非正常量，如 NaN, NaT, &lt;undefined&gt;, 空字符向量以及空格向量 varfun 将函数应用于表格型数据的每一个变量中 rowfun 将函数应用于表格型数据的每一行 Matlab 提供丰富的类型转换函数，眼花缭乱，摘录如下： 转换形式 转换函数 说明 数值 ➠ 字符数组 num2str 数值转换为字符数组 mat2str 矩阵转换为字符数组 int2str 整数转换为字符数组 字符数组 ➠ 数值 str2num 将字符数组转为数值，使用 eval 函数进行转换 str2double 将字符数组或字符串元胞数组转换为数值 数值 ➠ 元胞数组 num2cell 将数值转换为元胞数组 mat2cell 将矩阵转换为元胞数组 元胞数组 ➠ 数值 cell2mat 将元胞数组转换为矩阵 字符串/数组 ➠ 元胞数组 cellstr 将字符串转换为字符串元胞数组 元胞数组 ➠ 字符串 char 将元胞数组转换为字符串，替换以前版本的 str2mat 函数 字符串 ➠ 函数句柄 str2func 由函数名或字符串表达式构造函数句柄 函数句柄 ➠ 字符串 func2str 由函数句柄构造函数名或字符串表达式，也可用 char 函数 元胞数组 ➠ 结构数组 cell2struct 将元胞数组转换为结构数组 结构数组 ➠ 元胞数组 struct2cell 将结构数组转换为元胞数组 数组 ➠ 表格 array2table 将同类二维数组转换为表格 表格 ➠ 数组 table2array 将表格转换为同类数组 元胞数组 ➠ 表格 cell2table 将元胞数组转换为表格 表格 ➠ 元胞数组 table2cell 将表格转换为元胞数组 结构数组 ➠ 表格 struct2table 将结构数组转换为表格 表格 ➠ 结构数组 table2struct 将表格转换为结构数组 关于基本的算术运算符，有几处备忘： / 表示矩阵右除，\(C=A/B\) 表示 \(C\) 是方程 \(XB=A\) 的解 \(C=AB^{-1}\) \ 表示矩阵左除，\(C=A\backslash B\) 表示 \(C\) 是方程 \(AX=B\) 的解 \(C=A^{-1}B\) 关于转置，' 或者函数 ctranspose 表 Hermit 转置或共轭转置，.' 或 transpose 为非共轭转置 Matlab 数组元素的索引主要有 \(3\) 种方式，即全下标方式、单下标方式和逻辑 \(1\) 方式。在单下标方式中，存在这样的换算： 对于 \(m\times n\) 的矩阵 \(A\)，元素 \(A(i, j)\) 对应的单下标为 \(s = m(j-1) + i\) 对于 \(m \times n \times t\) 的数组 \(B\)，元素 \(B(i, j, k)\) 对应的单下标为 \(s=mn(k-1) + m(j-1) + i\) 对于维度为 \(n_1 \times n_2 \times \cdots \times n_k\) 的多维数组 \(C\)，元素 \(C(i_1, i_2, \cdots, i_k)\) 对应的单下标为 \(s = \sum\limits_{i=1}^{k-1} (i_{k+1} - 1)\prod\limits_{j=1}^i n_j + i_1\) Matlab 自带函数 sub2ind 可对上述第三条结论进行验证： 12345678910111213A = randi([1 10], 2, 7, 17, 3, 101);disp(my_sub2ind(size(A), 1, 4, 2, 2, 20));disp(sub2ind(size(A), 1, 4, 2, 2, 20));disp(my_sub2ind(size(A), 2, 7, 13, 3, 52));disp(sub2ind(size(A), 2, 7, 13, 3, 52));function ind = my_sub2ind(dims, varargin) indx = cell2mat(varargin); ind = indx(1) + dot(indx(2:end)-1, cumprod(dims(1:end-1)));end% 13825% 37072]]></content>
      <categories>
        <category>Memos</category>
      </categories>
      <tags>
        <tag>Matlab</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[数学建模笔记 —— 对变化进行建模]]></title>
    <url>%2Fnotes-on-learning-mathematical-modeling-based-on-variation%2F</url>
    <content type="text"><![CDATA[离散流行病模型 考虑这样一个社区，有三类人群：易感者、已感者和移出者。我们对流行病模型作出如下假设： 没有人进出该社区，且社区不和外界接触，即社区内的总人数保持不变 每个人都是易感者 \(S\)、已感者 \(I\)、移出者 \(R\)。也就是说每个人都能感染这种流感，当前已经染上这种流感的人能够传播流感，已经得过这种流感的人不会再得此病 一开始，每人要么是已感者，要么是易感者 这种流感的平均持续时间为 \(1/c\) 周，在此期间此人被认为是已感者且能传播流感 模型时间周期按周计 用差分方程描述这个动力系统模型，首先假设定义如下： \(S(n)\)：\(n\) 个周期后易感者人数 \(I(n)\)：\(n\) 个周期后已感者人数 \(R(n)\)：\(n\) 个周期后移出者人数 从模型假设出发，既然流感平均持续 \(1/c\) 周，也就是说每 \(1/c\) 周的时间就有 \(1\) 人成为移出者，从该系统移出。因计量周期为周，所以也可理解成每周移出 \(c \times 100 \%\) 的已感者。所以建立关于移出者的方程 \[ R(n+1) = R(n) + c I(n) \tag{R} \label{R} \] 对于已感者人数 \(I(n)\) 的变化，显然来自两个方面：其一来自新的一批被传染的易感者，其二由前所述，每周都会从系统移出已感者。细化这个过程，易感者由于接触已感者而患病，若引入传播系数 \(a\)，则新的一批被感染得病的人数为 \(a S(n) I(n)\)，二者乘积的形式表明了其之间的相互作用。得到已感者差分方程 \[ I(n+1) = I(n) - c I(n) + a S(n) I(n) \tag{I} \label{I} \] 最后关于易感者的关系就很容易了，由于系统人数保持不变，已感者被移出后不会再患病，即不会转化为易感者；移出者的变化仅来源于已感者，故和易感者无直接联系。所以仅建立易感者与已感者之间的关系即可。 \[ S(n+1) = S(n) - a S(n) I(n) \tag{S} \label{S} \] 给定初始条件，假设社区共有 \(1000\) 人，移出率 \(c=0.60\)，一开始（第 \(0\) 周）便有 \(5\) 人患病，第 \(1\) 周有 \(9\) 人患病，即 \(I(0) = 5\)，\(S(0) = 995\)，\(R(0) = 0\)，\(I(1) = 9\)，由式 \(\eqref{I}\) 即可解得 \(a \approx 0.001407\)。 故由以上方程组及初值构成的动力系统（SIR 模型）可进行迭代求解，并通过图形观察趋势。Matlab 代码如下： epidemic_model.m123456789101112131415161718192021222324252627282930313233343536373839404142434445N = 1000;I0 = 5;I1 = 9;shiftout = 0.6;iters = 25;res = epidemic(N, I0, I1, shiftout, iters);tbl = cell2table(num2cell(res), 'VariableNames', &#123;'Rn', 'In', 'Sn'&#125;);writetable(tbl, 'epidemic.csv');p = plot(0:iters-1, res, 'LineWidth', 1.1, 'MarkerSize', 4.5);p(1).Marker = '*';p(2).Marker = 'x';p(3).Marker = '^';set(gca, ... 'FontName', 'Euclid', ... 'FontWeight', 'Bold', ... 'FontSize', 9, ... 'box', 'off', ... 'color', 'none');title('\bf Dynamic System of SIR Model', ... 'FontSize', 11, ... 'Interpreter', 'latex');legend(gca, ... &#123;'$R(n)$', '$I(n)$', '$S(n)$'&#125;, ... 'FontSize', 8, ... 'Interpreter', 'latex', 'Location', 'best');set(gcf, ... 'units', 'points', ... 'position', [350, 200, 320, 180]);saveas(gcf, 'epidemic.svg');function res = epidemic(N, I0, I1, shiftout, iters) % 返回由 R(n), I(n), S(n) 构成的数组 res = zeros(iters, 3); a = (I1 - (1-shiftout) * I0) / (I0 * (N - I0)); res(1, :) = [0 I0 N-I0]; for k = 2:iters res(k, 1) = res(k-1, 1) + shiftout * res(k-1, 2); res(k, 2) = (1-shiftout) * res(k-1, 2) + a * res(k-1, 2) * res(k-1, 3); res(k, 3) = res(k-1, 3) - a * res(k-1, 2) * res(k-1, 3); endend 生成的 \(R(n), I(n), S(n)\) 表格如下： \[\begin{array}{cccc|cccc} \hline \text{week} &amp; R(n) &amp; I(n) &amp; S(n) &amp; \text{week} &amp; R(n) &amp; I(n) &amp; S(n) \\ \hline {0} &amp; {0} &amp; {5} &amp; {995} &amp; {12} &amp; {812.3671} &amp; {78.9598} &amp; {108.6731} \\ {1} &amp; {3} &amp; {9} &amp; {988} &amp; {13} &amp; {859.7430} &amp; {43.6574} &amp; {96.5996} \\ {2} &amp; {8.4000} &amp; {16.1114} &amp; {975.4886} &amp; {14} &amp; {885.9374} &amp; {23.3968} &amp; {90.6657} \\ {3} &amp; {18.0668} &amp; {28.5581} &amp; {953.3751} &amp; {15} &amp; {899.9755} &amp; {12.3435} &amp; {87.6810} \\ {4} &amp; {35.2017} &amp; {49.7321} &amp; {915.0662} &amp; {16} &amp; {907.3816} &amp; {6.4602} &amp; {86.1582} \\ {5} &amp; {65.0409} &amp; {83.9244} &amp; {851.0347} &amp; {17} &amp; {911.2577} &amp; {3.3672} &amp; {85.3750} \\ {6} &amp; {115.3955} &amp; {134.0638} &amp; {750.5407} &amp; {18} &amp; {913.2781} &amp; {1.7514} &amp; {84.9705} \\ {7} &amp; {195.8338} &amp; {195.2018} &amp; {608.9644} &amp; {19} &amp; {914.3289} &amp; {0.9099} &amp; {84.7612} \\ {8} &amp; {312.9549} &amp; {245.3364} &amp; {441.7087} &amp; {20} &amp; {914.8749} &amp; {0.4725} &amp; {84.6526} \\ {9} &amp; {460.1567} &amp; {250.6110} &amp; {289.2323} &amp; {21} &amp; {915.1584} &amp; {0.2453} &amp; {84.5964} \\ {10} &amp; {610.5233} &amp; {202.2331} &amp; {187.2436} &amp; {22} &amp; {915.3055} &amp; {0.1273} &amp; {84.5672} \\ {11} &amp; {731.8632} &amp; {134.1732} &amp; {133.9636} &amp; {23} &amp; {915.3819} &amp; {0.0661} &amp; {84.5520} \\ \hline \end{array}\] SIR 模型动力系统曲线如下： 注：尽管设置了 set(gca, 'color', 'none')，但 Matlab (R2016b) 导出的 SVG 格式图形仍然会有背景色，且图形标题位置不易调整。故干脆用 Inkscape 对图形进行细加工。 从图形可以看出，给定移出率（\(60\%\)）以及模型初值下，这种流感流行的高峰处于第 \(9\) 周左右，已感人数为 \(250.6\)，在第 \(17\) 周后略小于 \(85\) 人未染上这种流感。 敏感性分析 下面考察模型对于参数及初始条件的敏感性。分别基于以下初值条件进行实验： \[\begin{array}{c|cccc} &amp; N &amp; c &amp; I(0) &amp; I(1) \\ \hline \text{I} &amp; 1000 &amp; 3/5 &amp; 5 &amp; 15 \\ \text{II} &amp; 1000 &amp; 1 &amp; 5 &amp; 15 \\ \text{III} &amp; 1000 &amp; 1/4 &amp; 5 &amp; 15 \\ \text{IV} &amp; 4000 &amp; 1/4 &amp; 5 &amp; 35 \end{array}\] 实验过程中发现会某些时间周期会出现人数为负或者超过总社区人数的情况，故在函数 epidemic 中对其加以限定，使其在正常范围内变化。注意这里不能简单地处理为 \(\max\{\min\{x, N\}, 0\}\)，否则可能导致三者加和不为 \(N\) 的情况出现。 12345res(k, 1) = min(res(k-1, 1) + shiftout * res(k-1, 2), N);res(k, 3) = max(min(res(k-1, 3) - a * res(k-1, 2) * res(k-1, 3), N), 0);res(k, 2) = max(min((1-shiftout) * res(k-1, 2) + ... a * res(k-1, 2) * res(k-1, 3), ... N - res(k, 1) - res(k, 2)), 0); 对比结果如下： 四种情形最终的收敛情况相同，即易感者逐渐降至为 \(0\)，即全军覆没无一幸免；已感者呈现先增后降的趋势；移出者逐渐累积，直至流行病完全治愈。具体来看，移出率越高，说明该流行病越容易被治愈，所以感染人数峰值越低，流行病退潮时间越早；\(I(1) - I(0)\) 越大，即传播系数越高，流感传播速度更快，短时期内感染人数上升速率更大，退潮时间也越长。 考察社区总人数是否对模型敏感性有影响，针对 \(c=1\), \(I(0)=5\), \(I(1)=10\), \(N=500\), \(1000\), \(5000\), \(10000\) 四种情况作出变化曲线： 显然，在其他因素相同的情况下，随社区总人数增加，SIR 模型曲线整体“向右移动”，也就是说感染人数到达峰值所需时间增长，且相应的退潮时间也越长。由于当 \(I(1) - I(0)\) 不变的情况下，随总人数增加，可以看成传播系数 \(a\) 降低，所以整个模型的变化会放缓。]]></content>
      <categories>
        <category>Mathematical Modeling</category>
      </categories>
      <tags>
        <tag>Matlab</tag>
        <tag>Difference</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[《统计学习方法》笔记一]]></title>
    <url>%2Fnotes-on-statistical-learning-methods-01%2F</url>
    <content type="text"><![CDATA[李航《统计学习方法》一书第 12 页关于简单的多项式曲线拟合有如下结论： 具体地，求以下经验风险最小化： $$ L(\omega) = \frac 12 \sum_{i=1}^N \left(f(x_i, \omega) - y_i\right)^2 \tag{1.18} \label{1.18} $$ ... 这是一个简单的最优化问题。将模型与训练数据代入式 $\eqref{1.18}$ 中，有 $$ L(\omega) = \frac 12 \sum_{i=1}^N \left(\sum_{j=0}^M \omega_j x_i^j-y_i\right)^2 $$ 对 $\omega_j$ 求偏导数并令其为 $0$，可得 $$ \omega_j = \frac{\sum\limits_{i=1}^N x_i^j y_i}{\sum\limits_{i=1}^N x_i^{j+1}}, \quad j = 0,1,2,\ldots M \tag{*} \label{*} $$ 但通过简单求导，似乎事实并不那么简单。这里为计算 \(\partial L/\partial \omega_j\)，将原求和式下标换作 \(k\)，以免混淆出错。 \[ \frac{\partial L}{\partial \omega_j} = \sum_{i=1}^N \left(\sum_{j=0}^M \omega_j x_i^j - y_i\right) x_i^j = \sum_{k=0}^M \left(\sum_{i=1}^N x_i^{k+j}\right)\omega_k - \sum_{i=1}^N y_i x_i^j \tag{1} \label{1} \] 故对于 \(j = 0, 1, 2\ldots M\)，令 \(\partial L/\partial \omega_j = 0\)，可得如下 \(M\) 元方程组： \[ \begin{cases} \omega_0 \sum\limits_{i=1}^N x_i^0 + \omega_1 \sum\limits_{i=1}^N x_i^1 + \cdots + \omega_M \sum\limits_{i=1}^N x_i^M = \sum\limits_{i=1}^N y_i &amp; \\ \omega_0 \sum\limits_{i=1}^N x_i^1 + \omega_1 \sum\limits_{i=1}^N x_i^2 + \cdots + \omega_M \sum\limits_{i=1}^N x_i^{M+1} = \sum\limits_{i=1}^N x_i y_i &amp; \\ \hfil \vdots \hfil &amp; \\ \omega_0 \sum\limits_{i=1}^N x_i^M + \omega_1 \sum\limits_{i=1}^N x_i^{M+1} + \cdots + \omega_M \sum\limits_{i=1}^N x_i^{2M} = \sum\limits_{i=1}^N x_i^M y_i &amp; \end{cases} \] 写为矩阵形式： \[ \underbrace{ \begin{pmatrix} \sum\limits_{i=1}^N x_i^0 &amp; \cdots &amp; \sum\limits_{i=1}^N x_i^1 &amp; \sum\limits_{i=1}^N x_i^M \\ \sum\limits_{i=1}^N x_i^1 &amp; \cdots &amp; \sum\limits_{i=1}^N x_i^2 &amp; \sum\limits_{i=1}^N x_i^{M+1} \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ \sum\limits_{i=1}^N x_i^M &amp; \cdots &amp; \sum\limits_{i=1}^N x_i^{M+1} &amp; \sum\limits_{i=1}^N x_i^{2M} \end{pmatrix} }_{\boldsymbol{A}} \underbrace{ \begin{pmatrix} \omega_0 \vphantom{\sum\limits_{i=1}^{N}x_i^{M+1}} \\ \omega_1 \vphantom{\sum\limits_{i=1}^{N}x_i^{M+1}} \\ \vdots \vphantom{\ddots}\\ \omega_M \vphantom{\sum\limits_{i=1}^{N}x_i^{M+1}} \end{pmatrix} }_{\boldsymbol{\omega}} = \underbrace{ \begin{pmatrix} \sum\limits_{i=1}^N y_i \vphantom{\sum\limits_{i=1}^{N}x_i^{M+1}}\\ \sum\limits_{i=1}^N x_i y_i \vphantom{\sum\limits_{i=1}^{N}x_i^{M+1}}\\ \vdots \vphantom{\ddots}\\ \sum\limits_{i=1}^N x_i^M y_i \vphantom{\sum\limits_{i=1}^{N}x_i^{M+1}}\\ \end{pmatrix} }_{\boldsymbol{B}} \] 注意到 \(\boldsymbol{A}, \boldsymbol{B}\) 均可写为两个矩阵相乘的形式： \[ \boldsymbol{A}= \begin{pmatrix} 1 &amp; 1 &amp; 1 &amp; \cdots &amp; 1 \vphantom{x_1^M} \\ x_1 &amp; x_2 &amp; x_3 &amp; \cdots &amp; x_M \vphantom{x_2^M} \\ x_1^2 &amp; x_2^2 &amp; x_3^2 &amp; \cdots &amp; x_M^2 \vphantom{x_3^M} \\ \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ x_1^M &amp; x_2^M &amp; x_3^M &amp; \cdots &amp; x_M^M \vphantom{x_M^M} \end{pmatrix} \begin{pmatrix} 1 &amp; x_1 &amp; x_1^2 &amp; \cdots &amp; x_1^M \\ 1 &amp; x_2 &amp; x_2^2 &amp; \cdots &amp; x_2^M \\ 1 &amp; x_3 &amp; x_3^2 &amp; \cdots &amp; x_3^M \\ \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 1 &amp; x_M &amp; x_M^2 &amp; \cdots &amp; x_M^M \\ \end{pmatrix} \triangleq \boldsymbol{V} \boldsymbol{V}&#39;, \quad \boldsymbol{B} = \boldsymbol{V} \boldsymbol{Y} \] 其中 \(\boldsymbol{Y}\) 为输出向量。于是多项式参数矩阵应由下式给出： \[ \boldsymbol{\omega} = (\boldsymbol{V}\boldsymbol{V&#39;})^{-1}\boldsymbol{V}\boldsymbol{Y} \tag{**} \label{**} \] 该式与 \(\eqref{*}\) 有一定出入，且不易进一步化简，其中涉及 Vandermonde 矩阵逆，可参考 Proof Wiki - Inverse of Vandermonde Matrix Proof of Vandermonde Matrix Inverse Formula Inverse of the Vandermonde and Vandermonde confluent matrices 于是针对原书中结论 \(\eqref{*}\) 以及逐步推导的结果 \(\eqref{**}\) 进行数值试验。 给定 \(\boldsymbol{X}, \boldsymbol{Y}\)，分别利用两种方法得到 \(\boldsymbol{\omega}\) 的结果，并代回 \(\eqref{1}\) 中，这里利用 Python 的科学计算包进行试验。 polyfit.py123456789101112131415161718192021222324252627282930313233343536373839404142import numpy as npimport numpy.random as nrnp.set_printoptions(precision=4, suppress=True)def equj(xs, ys, omegas, j): n = len(xs) m = len(omegas) return np.sum([np.sum(omegas[k] * xs[i-1] ** (k+j) for k in range(m)) - xs[i-1] ** j * ys[i-1] for i in range(1, n+1)])def omegaj1(xs, ys, j): # 方法一 return np.sum(xs ** j * ys) / np.sum(xs ** (j+1))def omegaj2(xs, ys, m): # 方法二 v = np.matrix(np.column_stack([xs ** i for i in range(m)]).T) y = np.matrix(v) * np.matrix(ys).T return np.linalg.solve(v * v.T, y)ns = [4, 4, 6, 8, 10, 10, 10]ms = [3, 4, 5, 7, 6, 7, 8]for n0, m0 in zip(ns, ms): xs0 = np.linspace(.1, 1, n0) ys0 = nr.uniform(1, 10, size=n0) omegas_sol1 = [omegaj1(xs0, ys0, j) for j in range(m0+1)] omegas_sol2 = omegaj2(xs0, ys0, m0) res1 = np.array([equj(xs0, ys0, omegas_sol1, j) for j in range(m0+1)]) res2 = np.array([equj(xs0, ys0, omegas_sol2, j) for j in range(m0+1)]) print(f'x: &#123;xs0&#125;') print(f'y: &#123;ys0&#125;') print(f'N: &#123;n0&#125;, M: &#123;m0&#125;') print('res1:', res1) print('res2:', res2) print() 结论整合如下： \[ \begin{array}{c|l} \hline {(N, M)} &amp; {(4, 3)} \\ {\boldsymbol{X}} &amp; {\begin{array}{llll} {0.1} &amp; {0.4} &amp; {0.7} &amp; {1.0} \end{array}} \\ {\boldsymbol{Y}} &amp; {\begin{array}{llll} {6.4086} &amp; {2.5888} &amp; {1.1871} &amp; {3.0044} \end{array}} \\ {\text{res}_1} &amp; {\begin{array}{llll} {26.8738} &amp; {20.8370} &amp; {17.5522} &amp; {15.6374} \end{array}} \\ {\text{res}_2} &amp; {\begin{array}{llll} 0 &amp; 0 &amp; 0 &amp; {-0.0065} \end{array}} \\ \hline {(N, M)} &amp; {(4, 4)} \\ {\boldsymbol{X}} &amp; {\begin{array}{llll} 0.1 &amp; 0.4 &amp; 0.7 &amp; 1.0 \end{array}} \\ {\boldsymbol{Y}} &amp; {\begin{array}{llll} {6.0025} &amp; {7.9131} &amp; {4.7549} &amp; {4.6187} \end{array}} \\ {\text{res}_1} &amp; {\begin{array}{lllll} {58.2611} &amp; {44.2894} &amp; {38.6435} &amp; {35.4777} &amp; {33.4895} \end{array}} \\ {\text{res}_2} &amp; {\begin{array}{lllll} 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \end{array}} \\ \hline {(N, M)} &amp; {(6, 5)} \\ {\boldsymbol{X}} &amp; {\begin{array}{llllll} {0.10} &amp; {0.28} &amp; {0.46} &amp; {0.64} &amp; {0.82} &amp; {1.00} \end{array}} \\ {\boldsymbol{Y}} &amp; {\begin{array}{llllll} {4.0511} &amp; {7.6577} &amp; {2.0744} &amp; {4.0110} &amp; {3.2187} &amp; {7.4847} \end{array}} \\ {\text{res}_1} &amp; {\begin{array}{llllll} {94.1633} &amp; {70.4719} &amp; {59.2198} &amp; {52.4345} &amp; {47.9117} &amp; {44.7218} \end{array}} \\ {\text{res}_2} &amp; {\begin{array}{llllll} 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; {-0.0040}\end{array}} \\ \hline {(N, M)} &amp; {(8, 7)} \\ {\boldsymbol{X}} &amp; {\begin{array}{llllllll} {0.1000} &amp; {0.2286} &amp; {0.3571} &amp; {0.4857} &amp; {0.6143} &amp; {0.7429} &amp; {0.8714} &amp; {1.0000} \end{array}} \\ {\boldsymbol{Y}} &amp; {\begin{array}{llllllll} {7.5006} &amp; {8.4878} &amp; {6.9965} &amp; {8.8697} &amp; {3.8661} &amp; {3.0010} &amp; {6.0474} &amp; {9.7587} \end{array}} \\ {\text{res}_1} &amp; {\begin{array}{llll} {193.4017} &amp; {148.1521} &amp; {125.1272} &amp; {110.7083} \\ {100.7469} &amp; {93.4678} &amp; {87.9480} &amp; {83.6494} \end{array}} \\ {\text{res}_2} &amp; {\begin{array}{llllllll} 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; {-0.0001} \end{array}} \\ \hline {(N, M)} &amp; {(10, 6)} \\ {\boldsymbol{X}} &amp; {\begin{array}{llllllllll} {0.1} &amp; {0.2} &amp; {0.3} &amp; {0.4} &amp; {0.5} &amp; {0.6} &amp; {0.7} &amp; {0.8} &amp; {0.9} &amp; {1.0} \end{array}} \\ {\boldsymbol{Y}} &amp; {\begin{array}{lllll} {8.4519} &amp; {2.8615} &amp; {8.2275} &amp; {5.5887} &amp; {6.4139} \\ {4.8329} &amp; {2.3945} &amp; {9.5324} &amp; {1.5159} &amp; {4.8203} \end{array}} \\ {\text{res}_1} &amp; {\begin{array}{lllllll} {158.5266} &amp; {117.4165} &amp; {96.8007} &amp; {84.1716} &amp; {75.5419} &amp; {69.2490} &amp; {64.4573} \end{array}} \\ {\text{res}_2} &amp; {\begin{array}{llllllllll} 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; {-0.0001} \end{array}} \\ \hline {(N, M)} &amp; {(10, 7)} \\ {\boldsymbol{X}} &amp; {\begin{array}{llllllllll} {0.1} &amp; {0.2} &amp; {0.3} &amp; {0.4} &amp; {0.5} &amp; {0.6} &amp; {0.7} &amp; {0.8} &amp; {0.9} &amp; {1.0} \end{array}} \\ {\boldsymbol{Y}} &amp; {\begin{array}{lllll} {2.9699} &amp; {8.8436} &amp; {6.0365} &amp; {8.7695} &amp; {4.6556} \\ {8.6279} &amp; {1.5868} &amp; {7.5356} &amp; {2.1053} &amp; {5.5741} \end{array}} \\ {\text{res}_1} &amp; {\begin{array}{llll} {176.0512} &amp; {131.4928} &amp; {109.7501} &amp; {96.1845} \\ {86.7478} &amp; {79.7768} &amp; {74.4193} &amp; {70.1824} \end{array}} \\ {\text{res}_2} &amp; {\begin{array}{llllllllll} 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; {-0.0001} \end{array}} \\ \hline {(N, M)} &amp; {(10, 8)} \\ {\boldsymbol{X}} &amp; {\begin{array}{llllllllll} {0.1} &amp; {0.2} &amp; {0.3} &amp; {0.4} &amp; {0.5} &amp; {0.6} &amp; {0.7} &amp; {0.8} &amp; {0.9} &amp; {1.0} \end{array}} \\ {\boldsymbol{Y}} &amp; {\begin{array}{lllll} {1.9506} &amp; {5.4975} &amp; {7.7366} &amp; {3.4942} &amp; {4.6710} \\ {9.2793} &amp; {9.7969} &amp; {2.0273} &amp; {3.1859} &amp; {3.0251} \end{array}} \\ {\text{res}_1} &amp; {\begin{array}{lllll} {158.7535} &amp; {117.7695} &amp; {98.8822} &amp; {87.3893} &amp; {79.4357} \\ {73.5334} &amp; {68.9573} &amp; {65.3023} &amp; {62.3207} &amp; \end{array}} \\ {\text{res}_2} &amp; {\begin{array}{llllllll} 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \end{array}} \\ \hline \end{array} \] 方法一得出的 \(\boldsymbol{\omega}\) 代回方程的结果不为零，说明原书结论有误。]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Statistics</tag>
        <tag>Matrix</tag>
        <tag>Linear Algebra</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSR 服务器搭建]]></title>
    <url>%2Fssr-on-server%2F</url>
    <content type="text"><![CDATA[原文链接: 『原创』CentOS/Debian/Ubuntu ShadowsocksR 单/多端口 一键管理脚本 CentOS/Debian/Ubuntu系统 TCP-BBR 一键安装脚本 安装、配置 SSR 系统要求 ** CentOS 6+ / Debian 6+ / Ubuntu 14.04+ ** 脚本特点 支持 限制 端口限速 支持 限制 端口设备数 支持 显示 当前连接IP 支持 显示 SS/SSR连接+二维码 支持 切换管理 单/多端口 支持 一键安装 BBR 支持 一键安装 锐速 支持 一键安装 LotServer 支持 一键封禁 垃圾邮件(SMAP)/BT/PT 安装步骤 1wget -N --no-check-certificate https://raw.githubusercontent.com/michaelHL/Notes/master/2017/11/src/ssr.sh &amp;&amp; chmod +x ssr.sh &amp;&amp; bash ssr.sh 文件位置 安装目录: /usr/local/shadowsocksr 配置文件: /etc/shadowsocksr/user-config.json 其他说明 ShadowsocksR 安装后，自动设置为系统服务，所以支持使用服务来启动 / 停止等操作，同时支持开机启动。 启动 ShadowsocksR: /etc/init.d/ssr start 停止 ShadowsocksR: /etc/init.d/ssr stop 重启 ShadowsocksR: /etc/init.d/ssr restart 查看 ShadowsocksR 状态: /etc/init.d/ssr status ShadowsocksR 默认支持 UDP 转发，服务端无需任何设置 注意事项 如果协议是 origin，那么混淆也必须是 plain 若使用了 chacha20 系列加密方式，运行脚本选择选项 4 安装 libsodium 支持库即可 安装 TCP-BBR 1wget -N --no-check-certificate https://raw.githubusercontent.com/michaelHL/Notes/master/2017/11/src/bbr.sh &amp;&amp; chmod +x bbr.sh &amp;&amp; bash bbr.sh 重启后，验证一下是否成功安装最新内核并开启 TCP-BBR，输入以下命令: 123456789101112131415uname -rsysctl net.ipv4.tcp_available_congestion_control# 返回值一般为# net.ipv4.tcp_available_congestion_control = bbr cubic reno# ————————————sysctl net.ipv4.tcp_congestion_control# 返回值一般为# net.ipv4.tcp_congestion_control = bbr# ————————————sysctl net.core.default_qdisc# 返回值一般为# net.core.default_qdisc = fq# ————————————lsmod | grep bbr# 返回值有 tcp_bbr 模块即说明bbr已启动]]></content>
      <categories>
        <category>Development and Deployment</category>
      </categories>
      <tags>
        <tag>SSR</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ubuntu 中安装最新版本 Clang]]></title>
    <url>%2Finstalling-latest-clang-on-ubuntu%2F</url>
    <content type="text"><![CDATA[Ubuntu 16.04 中利用 sudo apt-get install clang 安装 Clang 的版本为 3.8，这个版本对现在来说确实已经很久远了，有必要升级成比较新的版本。这里几乎照搬此篇文章：How to install latest clang (5.0) on Ubuntu 16.04 (xenial) / WSL。 首先添加仓库： 12wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add -sudo apt-add-repository "deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-5.0 main" 具体地址参考 LLVM Debian/Ubuntu nightly packages。 直接通过 apt-get 安装即可： 12sudo apt-get updatesudo apt-get install -y clang-5.0 多版本共存问题 1234567update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-3.8 100update-alternatives --install /usr/bin/clang++ clang++ /usr/bin/clang++-5.0 1000update-alternatives --install /usr/bin/clang++ clang /usr/bin/clang-3.8 100update-alternatives --install /usr/bin/clang clang /usr/bin/clang-3.8 100update-alternatives --install /usr/bin/clang clang /usr/bin/clang-5.0 1000update-alternatives --config clangupdate-alternatives --config clang++ 代码格式化工具 clang-format 同理。 Vim C / C++ 代码格式化插件 vim-clang-format Vim plugin for clang-format, a formatter for C, C++, Obj-C, Java, JavaScript, TypeScript and ProtoBuf. 该插件可以直接在 .vimrc 中设置代码风格，示例如下： .vimrc123Plugin 'rhysd/vim-clang-format'autocmd FileType c,cpp,java nnoremap &lt;silent&gt; == :ClangFormat&lt;CR&gt;let g:clang_format#detect_style_file = 1]]></content>
      <categories>
        <category>Operation and Maintenance</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Ubuntu</tag>
        <tag>Clang</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[部署 RStudio Server]]></title>
    <url>%2Fdeployment-of-rstudio-server%2F</url>
    <content type="text"><![CDATA[在 Ubuntu 16.04.3 下部署 RStudio Server 。 RStudio 是一款优秀的 R 语言集成开发软件，官方免费提供社区版 RStudio Server，默认支持多用户登录。 首先安装 R 的最新版本（参考 UBUNTU PACKAGES FOR R）: 12345sudo apt-get remove r-base-coreecho 'deb https://mirrors.ustc.edu.cn/CRAN/bin/linux/ubuntu xenial/' | sudo tee -a /etc/apt/sources.listsudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E084DAB9sudo apt-get updatesudo apt-get install r-base r-base-dev 下载安装 RStudio Server（参考官方下载页面）： 123sudo apt-get install gdebi-corewget https://download2.rstudio.org/rstudio-server-1.1.419-amd64.debsudo gdebi rstudio-server-1.1.419-amd64.deb 完成之后可进行 rstudio-server {status|start|stop|restart|} 等操作。 进一步，可对 RStudio Server 进行深度配置： /etc/rstudio/rserver.conf12www-port=9999server-app-armor-enabled=0 Nginx 配置： nginx.conf1234567891011121314151617181920http &#123; map $http_upgrade $connection_upgrade &#123; default upgrade; '' close; &#125; server &#123; listen 80; location / &#123; proxy_pass http://localhost:9999; proxy_redirect http://localhost:9999/ $scheme://$host/; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_read_timeout 20d; &#125; &#125;&#125;]]></content>
      <categories>
        <category>Development and Deployment</category>
      </categories>
      <tags>
        <tag>Server</tag>
        <tag>R</tag>
        <tag>RStudio</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows 挂载 Linux 文件系统]]></title>
    <url>%2Fmouting-linux-file-systems-on-windows%2F</url>
    <content type="text"><![CDATA[推荐在 Windows 下利用 SSH 挂载远程 Linux 文件系统及目录的工具：WinSshFS。 虽然可以利用各类 SFTP 软件与服务器间互传文件，但操作感始终没有直接双击打开「我的电脑」里面的盘符来的方便。那么基于 Dokany 开发的 WinSshFS 就能完美满足这个需求。配置比较简单： 安装 Dokany 库 下载 / 安装 WinSshFS 配置完后远程目录的操作基本与本地磁盘相同了，下为 MSYS2 中 df 显示的结果： 12345678$ df -hFilesystem Size Used Avail Use% Mounted onD:/MSYS2 391G 48G 344G 13% /C: 100G 25G 75G 25% /cE: 441G 198G 244G 45% /eM: 40G 23G 19G 55% /mN: 976G 815G 212G 80% /nO: 3.6T 413G 3.4T 11% /o 仅需注意的是这二者并不是同一作者开发，后者的更新相比于前者有一定迟滞性，所以 Dokany 库不宜下载最新版，具体推荐版本见 WinSshFS 的发行界面。当前稳定运行的版本为： Dokany: 1.0.5.1000 WinSshFS: 1.6.0.14]]></content>
      <categories>
        <category>Handy Utilities</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Windows</tag>
        <tag>SSH</tag>
        <tag>FileSystem</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[编译 YouCompleteMe]]></title>
    <url>%2Fcompilation-of-you-complete-me%2F</url>
    <content type="text"><![CDATA[由 Valloric 开发的 Vim 插件 YouCompleteMe 可以算上是最难安装的 Vim 插件了，折腾记录如下。 CentOS 7.3 更新 GCC CentOS 7.3 自带的 GCC 版本仅为 4.8.5，Ubuntu 16.04 的 GCC 版本已经到了 5.4.0。所以如果是 CentOS 系统，第一步一定要更新 GCC 版本，否则后续过程寸步难行。具体过程从略。 编译 YCM 根据官方的 安装指南，有如下操作步骤： 1234567891011121314151617cd ~/.vim/bundle/git clone https://github.com/Valloric/YouCompleteMe.gitcd YouCompleteMegit submodule update --init --recursivemkdir -p ~/ycm_temp/cd ~/ycm_temp/wget http://releases.llvm.org/4.0.1/clang+llvm-4.0.1-x86_64-linux-gnu-debian8.tar.xztar -xvf clang+llvm-4.0.1-x86_64-linux-gnu-debian8.tar.xzmkdir -p ~/ycm_buildcd ~/ycm_buildcmake -G "Unix Makefiles" \ -DPATH_TO_LLVM_ROOT=~/ycm_temp/clang+llvm-4.0.1-x86_64-linux-gnu-debian8 \ -DPYTHON_INCLUDE_DIR=/usr/include/python3.4m \ -DPYTHON_LIBRARY=/usr/lib64/libpython3.so \ -DUSE_PYTHON2=OFF \. ~/.vim/bundle/YouCompleteMe/third_party/ycmd/cppcmake --build . --target ycm_core 这里仅用 Python 3.x 版本，所以使用 -DUSE_PYTHON2=OFF 选项。 C 语言家族支持 在家目录中新建文件 .ycm_extra_conf.py。 vimrc 配置 .vimrc123456789101112131415Plugin 'Valloric/YouCompleteMe'let g:ycm_global_ycm_extra_conf = '~/.ycm_extra_conf.py'let g:ycm_confirm_extra_conf = 0let g:ycm_seed_identifiers_with_syntax = 1let g:ycm_server_python_interpreter = '/usr/bin/python3'set completeopt=longest,menulet g:ycm_semantic_triggers = &#123;\ 'c' : ['-&gt;', '.', ' ', '(', '[', '&amp;'],\ 'cpp,objcpp' : ['-&gt;', '.', ' ', '(', '[', '&amp;', '::'],\ 'perl' : ['-&gt;', '::', ' '],\ 'php' : ['-&gt;', '::', '.'],\ 'cs,java,javascript,d,vim,python,perl6,scala,vb,elixir,go' : ['.'],\ 'ruby' : ['.', '::'],\ 'lua' : ['.', ':']\ &#125; Ubuntu 16.04 由于 Python 库路径与 CentOS 系统有所不同，cmake 部分有少许变动。 1234567891011121314151617cd ~/.vim/bundle/git clone https://github.com/Valloric/YouCompleteMe.gitcd YouCompleteMegit submodule update --init --recursivemkdir -p ~/ycm_temp/cd ~/ycm_temp/wget http://releases.llvm.org/5.0.1/clang+llvm-5.0.1-x86_64-linux-gnu-ubuntu-16.04.tar.xztar -xvf clang+llvm-5.0.1-x86_64-linux-gnu-ubuntu-16.04.tar.xzmkdir -p ~/ycm_buildcd ~/ycm_buildcmake -G "Unix Makefiles" \ -DPATH_TO_LLVM_ROOT=~/ycm_temp/clang+llvm-5.0.1-x86_64-linux-gnu-ubuntu-16.04 \ -DPYTHON_INCLUDE_DIR=/usr/include/python3.5m \ -DPYTHON_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.5m.so \ -DUSE_PYTHON2=OFF \ . ~/.vim/bundle/YouCompleteMe/third_party/ycmd/cppcmake --build . --target ycm_core Windows Windows 下编译比较烦琐，各工具需单独下载。 原料 Clang for Windows (64-bit) Python CMake Visual Studio MinGW GCC（测试用 MSYS2 系统里面的 MinGW64 替代） 测试时各版本如下： Entries Version Clang 4.0.1 x64 Python 2.7.10 x64 CMake 3.9.0 x64 Visual Studio 2017 MinGW GCC 7.1.0 Git - 编译 为防止环境变量 PATH 干扰，暂时删除在 PATH 中 MSYS2 的两个路径（/mingw64/bin，/usr/bin 包含 clang，cmake 和 python），加入刚才安装的 Cmake 路径（Python，Clang 的路径并不需要）。下面一套动作即可完成编译： 1234567891011git clone http://github.com/Valloric/YouCompleteMe.gitcd YouCompleteMegit submodule update --init --recursivemkdir buildcd buildcmake -G "Visual Studio 15 Win64" ^ -DPATH_TO_LLVM_ROOT=D:/LLVM ^ -DPYTHON_INCLUDE_DIR=D:/Python/Python27/include ^ -DPYTHON_LIBRARY=D:/Python/Python27/libs/python27.lib ^ . ../third_party/ycmd/cppcmake --build . --target ycm_core --config Release 这里明确指明了 LLVM 的目录以及 Python 的库，当然如果要在 Python 3.x 下编译，需将 cmake 部分改为： 12345cmake -G "Visual Studio 15 Win64" ^ -DPATH_TO_LLVM_ROOT=D:/LLVM ^ -DPYTHON_INCLUDE_DIR=D:/Python/Python36/include ^ -DPYTHON_LIBRARY=D:/Python/Python36/libs/python36.lib ^ -DUSE_PYTHON2=OFF . ../third_party/ycmd/cpp 上述的 Python，LLVM，Visual Studio，CMake 的版本会直接影响编译结果，从多次编译的结果上看，LLVM 的版本宜 3.9+，且 Python 和 LLVM 的位数需匹配，而且 Python 2.7.11，Python 2.7.13 版本即便编译成功，在后续的使用中仍会出问题。 测试 编译好之后，在 VSCode 中使用 you-complete-me 插件尝试，有少许小问题（不提示系统库函数，但按下 . 之后才有提示。对引入的系统头文件警告等），总体不影响使用，而且支持跳转、peek。 附上 VSCode 中的配置： 1234"ycmd.path": "E:\\YouCompleteMe\\third_party\\ycmd","ycmd.confirm_extra_conf": true,"ycmd.global_extra_config": "F:\\WorkingDirectory\\Configuration\\common\\_ycm_extra_conf.py","ycmd.python": "D:\\Python\\Python27\\python.exe", 以及 YCM 所需的 _ycm_extra_conf.py。 原料里面的各工具的版本试了又试，Python 2.7.10 + LLVM Clang 4.0.1 是最佳组合。 致谢 YouCompleteMe LLVM GCC centos6.5升级gcc到4.9 CentOS 6.5 升级 GCC 4.9.3 Linux下GLIBCXX和GLIBC版本低造成的编译错误的解决方案 Centos7安装vim8.0 + YouCompleteMe 该博主利用 devtoolset 来更新 GCC 版本，不过在测试中无效 打造VIM利器 问题 不能对 Anaconda 中的包进行补全。应重新编译 YCM，编译时与 Anaconda 相关的路径不应出现在 PATH 中，且 .vimrc 中应注释掉关于 g:ycm_server_python_interpreter 的行。参考 YouCompleteMe does not work with Anaconda Python。]]></content>
      <categories>
        <category>Operation and Maintenance</category>
      </categories>
      <tags>
        <tag>Vim</tag>
        <tag>YCM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows 问题与技巧]]></title>
    <url>%2Fproblems-tricks-and-memo-on-windows%2F</url>
    <content type="text"><![CDATA[记录 Windows 下遇到的问题、技巧与备忘。 JetBrains 的 Vim 插件配置文件放在 ~/.ideavimrc MS Access 自动切换输入法修复方法： Options -&gt; Client Settings -&gt; Datasheet IME control 关闭恼人的 Connected User Experiences and Telemetry 服务： 打开计划任务程序，定位到 Microsoft - Windows - Application Experience，禁用 Microsoft Compatibility Appraiser 打开服务，禁用 Connected User Experiences and Telemetry 打开组策略，依次定位 Computer Configuration - Administrative Templates - Windows Components - Data Collection and Preview Builds - Allow Telemetry，设为 Disabled 卸载 OneDrive： 不让 OneDrive 弹出： Win-X-A - taskkill /f /im OneDrive.exe %SystemRoot%\SysWOW64\OneDriveSetup.exe /uninstall（注意系统位） Mobaxterm 中设置 Cygwin 的源： apt-cyg -m http://mirrors.neusoft.edu.cn/cygwin/ install/remove. ... apt-cyg -m http://mirrors.ustc.edu.cn/cygwin/ install/remove ... apt-cyg -m http://mirrors.aliyun.com/cygwin/ install/remove ... apt-cyg -m http://mirrors.163.com/cygwin/ install/remove ... MobaXterm 中的 Cygwin 如有命令出错，有可能是版本过低 MobaXterm 中如果无法安装包（一般出现校验值错误的情况），可手动下载 setup.ini，注意版本为 x86 Sublime Text 插件 SFTP 注册码：（在 Settings-User 中加入） 1234&#123; "email":"Rimke@163.com", "product_key":"e83eda-38644b-43c828-e3669b-cd8a85",&#125; Sublime Text 插件 AStyleFormatter 报错：安装 Microsoft Visual C++ 2010 SP1 Redistributable Package (x64) Sublime Text 主题插件 Boxy 深度定制： Boxy 侧边栏背景色：Sidebar Tree Defaults - "sidebar_tree" Boxy 侧边栏分隔："class": sidebar_container"，"layer0.tint" Potplayer 遇到「单声道」的情况，将声音 - 环绕置 0 即可 任务栏透明: StartIsBack win 7 下一些控件、动态链接库无法注册问题的终极解决办法（不推荐）: 激活并登陆 Administrator 账户（一定必须为该名称， 即使为管理员账户也不能行使此账户的一些职权） 清除各种显卡右键菜单： Nvidia： 清除：regsvr32 /u nvcpl.dll 显示：regsvr32 nvcpl.dll Intel： 清除：regsvr32 /u igfxsrvc.dll 显示：regsvr32 igfxsrvc.dll Ati： 清除：regsvr32 /u atiacmxx.dll 显示：regsvr32 atiacmxx.dll Intel集成： 清除：regsvr32 /u igfxpph.dll 显示：regsvr32 igfxpph.dll 修复 vbs 默认打开方式：cmd /c cscript/h:wscript 无法附着到任务栏： 123cmd /k reg add "HKEY_CLASSES_ROOT\lnkfile" /v IsShortcut /fcmd /k reg add "HKEY_CLASSES_ROOT\piffile" /v IsShortcut /fcmd /k taskkill /f /im explorer.exe &amp; explorer.exe 启动项文件夹：shell:Startup Cygwin 中 Mintty 快捷方式：mintty.exe -i /Cygwin-Terminal.ico - npm 路径：C:\Users\xxx\AppData\Roaming\npm tlmgr 更换 repository： 12tlmgr option repository http://mirrors.aliyun.com/CTAN/systems/texlive/tlnettlmgr option repository http://mirrors.ustc.edu.cn/CTAN/systems/texlive/tlnet CLI 下更新： 12tlmgr update --self --repository http://mirrors.aliyun.com/CTAN/systems/texlive/tlnet/tlmgr update --all --repository http://mirrors.aliyun.com/CTAN/systems/texlive/tlnet/ Sublime Text 插件 SublimeREPL 出现 OSError: [WinError 6] The handle is invalid 解决方案： Data/Packages/SublimeREPL/repls/subprocess_repl.py12def is_alive(self): return True Sublime Text 开启 Debug 模式：sublime.log_commands(True) 华丽的提示符：添加环境变量 PROMPT，比如 [ $e[35;40mNasty-Newbie$e[0m $b $e[1;33;40m$d $t$e[0m $b $e[1;31m$p$e[0m ]$_$e[1;33mλ$e[0m，显示成： 12[ Nasty-Newbie | Sun 09/09/2018 21:52:58.55 | C:\Users\Heller ]λ MSYS2 中自动挂载文件：/etc/fstab，比如： 12345678# For a description of the file format, see the Users Guide# http://cygwin.com/cygwin-ug-net/using.html#mount-table# DO NOT REMOVE NEXT LINE. It remove cygdrive prefix from pathnone / cygdrive binary,posix=0,noacl,user 0 0C:\Users\Michael\Desktop /desktopD:\MSYS2\home\Michael\Notes /notesF:\WorkingDirectory\Work\__current /current Chrome 浏览器在高分屏幕下的快捷方式： 1&quot;\chrome.exe&quot; /high-dpi-support=1 /force-device-scale-factor=1 为 SourceForge 加速： http://sourceforge.mirrorservice.org Sublime Text 插件 LaTeXTools 关于 PDF 阅读器 SumaptraPDF 反向搜索的设置： 1sumatrapdf.exe -inverse-search "\"C:\Program Files\Sublime Text 3\sublime_text.exe\" \"%f:%l\"" 关于公式不能预览的问题：手动从 Ghostscript 官网 安装，并将环境路径添加至 TexLive 路径前面; 添加 ImageMagick 的环境路径 Mathtype 的官方安装包名为 InstallMTW6.9b.exe Avast 杀毒软件的安装需要取消勾选 Real Site（中文名可能为 DNS 相关），否则网速奇慢！顺便，防火墙也别装了，简直神坑！ Avast 添加排除目录（添加信任）：Settings - Components - File Shield &amp;&amp; Behavior Shield - Customize - Exclusions，否则某些程序会无端卡死（比如赖以生存的 ConEmu） 用 UltraISO 刻录的 Windows 10 系统 U 盘无法创建分区（提示为 MBR / GPT 分区）解决方案：删除 U 盘中文件夹 efi/ 以及文件 bootmgr.efi TeamViewer(TV) 提示 The screen cannot be captured at the moment. This is probably due to fast user switching or a disconnected/minimized Remote Desktop session. 且场景为：被连接的机器为笔记本，盒上盖子，已打开 tv 服务。 解决方案： 打开笔记本盖子 或将一根 HDMI 线连接至显示器 Sublime Text 插件 Anaconda 显示类似如下错误且伴有切换至 python 文件卡顿： 1234&lt;Anaconda.anaconda_lib.workers.local_worker.LocalWorker object at 0x000001EA4B464FD0&gt; initial check failed because:connection to localhost:51568 timed out after 0.2s. tried to connect 7 times during 2 secondscheck that there is Python process executing the anaconda jsonserver.py script running in your system. If there is, check that you can connect to your localhost writing the following script in your Sublime Text 3 console:import socket; socket.socket(socket.AF_INET, socket.SOCK_STREAM).connect((&quot;localhost&quot;, 51568)) 场景：MSYS2 环境变量 /usr/bin，/mingw64/bin；Anaconda 没有加入环境变量。 解决方案：将 "python_interpreter": "/path/to/python_exe" 加入用户配置文件 Preferences.sublime-settings Xshell 5 中 Shift-Tab 效果却为切换标签处理办法：设置一次针对 Shift-Tab 的快捷键，再取消设置这个快捷键 Word 里面用 Mathtype 编辑的公式用默认的方法导出 PDF 文件时出现各类显示问题：改用 doPDF Sublime Text 插件 Clang Format 令其对全文件格式化： Format whole file if nothing selected Sublime Text 插件 LaTeXTools 中公式渲染/预览不全解决方案： 配置文件中为 preview_math_template_preamble 添加 \usepackage[margin=2cm]{geometry} Windows 批处理在后台运行程序：start /b xxx，输出会在当前窗口（当然可以通过 &gt;nul 2&gt;&amp;1 抑制输出），但是可以进行其他操作（有点类似于 *nix 中的 &amp;）。或者 start /min "" program params，会在最小化的新窗口中运行程序，同时控制权交给当前终端 Potplayer 关闭左上角的进度显示：基本 -&gt; 消息 -&gt; 取消勾选「在屏幕上显示播放信息」 自动锁屏可在屏幕保护程序中进行设置，即便是空的锁屏样式 MSYS2 中安装 watch：pacman -S procps-ng GNU 工具源码镜像：http://mirrors.ustc.edu.cn/gnu Ghost 系统桌面出现顽固图标注册表： 1HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Desktop\NameSpace 列出所有 Windows 服务状态: sc queryex type= service state= all | find /i "NATION" 删除 Outlook 所有账户。Outlook 删除到最后一个账户不给删除了，解决方案如下： Close Outlook. Run Windows Control Panel. Open the “Mail（Microsoft Outlook 2016）” applet and click the “Show Profiles…” button. Remove the existing “Outlook” profile. Add a new profile, name it “Outlook” and create a new account as needed. Clion 中遇到输入时结果显现两次处理方案：C-S-a，输入 registry，取消勾选 run.processes.with.pty （参考 User input appears twice in output window in CLion under MinGW） Windows 10 彻底禁用自动更新方案： services.msc 中设置 Windows Update 服务为禁用，并在 Recovery 中设置为不恢复 gpedit.msc 中: Computer Configuration - Administrative Templates - Windows Components - Windows Update - Specify intranet ...，启用此策略，并将 3 个服务器地址设为 127.0.0.1 解决 Microsoft Word 打开时自动切换输入法问题: 选项 - 高级 - 编辑选项 - 取消勾选「输入法控制处于活动状态」 Word 2016 中设置正文分栏而脚注不分栏：脚注区右键菜单 - 便笺选项 - 列 - 1 列。 注： Word 2003 及之前版本如此设置无效 安装完 Mathtype 后 PowerPoint 2016 打开报错「无法加载 …ppam 加载项」，所以干脆不用，在 Windows 10 (1709) 注册表中的位置为 1Computer\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Office\16.0\PowerPoint\AddIns\MathType AddIn (PowerPoint 2016) 删除即可 右键打开方式中程序列表所在注册表路径： 1HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\FileExts Microsoft Word 中设置边框时要记得重新应用边框，否则应用无效 往 Microsoft Word 里面插入矢量图时建议使用 .wmf 类型文件，.emf 文件在另存为 PDF 文件时可能导致图片严重失真 Windows 下给快捷方式指派的快捷键有明显延迟解决方案：slow windows desktop keyboard shortcuts 修改 Windows 用户名： 以其它管理员用户 B 身份登录系统，并注销需要改名的用户 A（如果这个用户已经登录的话）。如仅有一个用户，可考虑新建管理员账户，或开启默认被禁止的 Administrator 账户（计算机管理 - 系统工具 - 本地用户和组 - 用户 - Administrator - 取消勾选账户已禁用） 直接修改用户 A 的用户目录名（「运行」输入 ..，将文件夹 A 改名为 C） 找到注册表项 1HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\&lt;User SID&gt;\ 并将其改为 C:\Users\C。 「注」如何定位到 &lt;User SID&gt;：每个 &lt;User SID&gt; 的子键 ProfileImagePath 即为此用户的 Profile 目录，找到用户目录为 A 的键即可 「运行」中键入 netplwiz，双击用户 A 将用户名修改为 C，重启 NVIDIA 显卡搭载部分显示器屏幕发白 / 虚，可通过自定义 NVIDIA 色彩设定： Desktop Color Depth: Highest (32-bit) Output Color Depth: 8 bpc Output Color format: YCbCr444 Output dynamic range: Limited 更改右键菜单相对于鼠标点击处的位置：运行中键入 1shell:::&#123;80F3F1D5-FECA-45F3-BC32-752C152E456E&#125; 在弹出对话框 Tablet PC Settings 中切换用手习惯 Handedness Chrome 浏览器默认支持 Flash 需更改注册表项： chrome_flash.reg123456789Windows Registry Editor Version 5.00[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Google\Chrome]&quot;AllowOutdatedPlugins&quot;=dword:00000001&quot;RunAllFlashInAllowMode&quot;=dword:00000001&quot;DefaultPluginsSetting&quot;=dword:00000001&quot;HardwareAccelerationModeEnabled&quot;=dword:00000001[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Google\Chrome\PluginsAllowedForUrls]&quot;1&quot;=&quot;https://*&quot;&quot;2&quot;=&quot;http://*&quot;]]></content>
      <categories>
        <category>Tips and Tricks</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Python 3 拾零]]></title>
    <url>%2Fnotes-on-python-3%2F</url>
    <content type="text"><![CDATA[Python 3.x 笔记。 编码声明。python 文件前两行的注释若能被正则匹配到 coding[=:]\s*([-\w.]+)，则括号中的内容即被认为是文档编码声明。一般花哨的形式有（GNU Emacs）： 1# -*- coding: &lt;encoding-name&gt; -*- 或 (Bram Moolenaar’s VIM): 1# vim:fileencoding=&lt;encoding-name&gt; 文档搜索关键字：Encoding declarations 正则模块函数 re.match 仅从字符串开头开始匹配 Jupyter Notebook 分享代码 http://nbviewer.ipython.org 上述网站可渲染 Github 仓库 / Gist 的 .ipynb 文件，但如果文件改动，需在网址后加 ?flush_cache=true 强制刷新 推荐 Python 安装包国内镜像网站: http://mirrors.sohu.com/python Jupyter Notebook 更改 MathJax 字体方法： https://stackoverflow.com/a/44290246/4154610 计算 datatime 加上特定月数后的日期： 123456from datetime import datetimefrom dateutil.relativedelta import relativedeltadate_after_month = datetime.today()+ relativedelta(months=1)print('Today: ',datetime.today().strftime('%d/%m/%Y'))print('After Month:', date_after_month.strftime('%d/%m/%Y')) 代码语法高亮显示工具 Pygments： pip install pygments，命令为 pygmentize Pycharm 自带的代码格式工具风格不同于 autopep8，yapf 等，在遇到单行长代码（如公式）时，在运算符前面回行，可保证一定的美观度（# 表示第 79 列）： 123456789101112# Before:eq1 = (n0 * (1 / alpha + ln(beta)) - summation(ln(t[i]), (i, 0, n0 - 1)) + beta ** alpha * (summation(t[i] ** (-alpha) * ln(t[i]), (i, 0, n0 - 1)) - ln(alpha) * summation(t[i] ** (-alpha), (i, 0, n0 - 1)))).replace(t, ts)eq2 = (n0 - beta ** alpha * summation(t[i] ** (-alpha), (i, 0, n0 - 1))).replace(t, ts)# After:eq1 = (n0 * (1 / alpha + ln(beta)) # - summation(ln(t[i]), (i, 0, n0 - 1)) + beta ** alpha # * (summation(t[i] ** (-alpha) * ln(t[i]), (i, 0, n0 - 1)) # - ln(alpha) * summation(t[i] ** (-alpha), # (i, 0, n0 - 1)))).replace(t, ts) #eq2 = (n0 - beta ** alpha # * summation(t[i] ** (-alpha), (i, 0, n0 - 1))).replace(t, ts) # Python 时光机 — Python-Future 利用 json 库将 Python 对象转为 Json 对象时，所有键都会被转化为字符串，所以如果对字典对象进行转换，可能出现 x != loads(dump(x)) 的情形 如利用 Conda 作为包管理器，当包越来越多时可能出现同时用 Pip 和 Conda 装过的同名包，而这种情况处理起来也比较棘手（如果随意删除安装其中的包可能导致各种依赖关系问题）。所以建议用 Conda 新建环境时候先用 Conda 安装大部分包，再用 Pip 安装没有被 Conda 仓库收录的包。如科学计算方面，可先利用 Conda 安装 nb-conda-kernels，此操作会自动安装 Jupyter、IPython 等科学计算环境，再利用 Pip 安装其它包即可 Python 二进制包合集（Windows，Wheel） Unofficial Windows Binaries for Python Extension Packages Visual Studio Code（VSCode）中新建 Jupyter 文档显示 No Kernel 时，如果 Python 环境为 Anaconda / Miniconda，通常由于 Sqlite3 问题，可以在 SQLite Download Page 下载 sqlite3.dll 复制到 Python 环境中的 DLLs 目录下，如 D:\Miniconda\envs\py37\DLLs 利用 xlrd 库的 open_workbook 函数打开 Excel 文件后，如需关闭此文件，需显式调用 &lt;opened_workbook&gt;.release_resources() 进行释放]]></content>
      <categories>
        <category>Memos</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows 以及 CentOS 下的 MySQL 安装]]></title>
    <url>%2Finstall-mysql-on-windows-and-centos%2F</url>
    <content type="text"><![CDATA[在不同系统下安装配置 MySQL 的过程中遇到不少问题，特此记录。 Windows 下配置免安装版 MySQL 5.7 于 MySQL Community Server 下载页面下载 zip 版本并解压，比如解压到 D:\\MySQL 目录下 于 MySQL 根目录添加配置文件 my.ini： my.ini12345678910111213141516171819[mysqld]port = 3677basedir = "D:\\MySQL"datadir = "D:\\MySQL\\data"sql_mode = NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLESmax_connections = 200character-set-server = utf8default-storage-engine = INNODBexplicit_defaults_for_timestamp = true# innodb_buffer_pool_size = 128M# join_buffer_size = 128M# sort_buffer_size = 2M# read_rnd_buffer_size = 2M[mysqladmin]user = "root"port = 3677 初始化 MySQL 数据库： 1"D:\MySQL\bin\mysqld.exe" --defaults-file="D:\\MySQL\\my.ini" --initialize-insecure --console 此时已有无密码账户 root，更改密码： 1"D:\MySQL\bin\mysqld.exe" --defaults-file="D:\\MySQL\\my.ini" --console 另开终端，输入 mysql -uroot -P 3677 -p 直接回车， 并键入（&lt;password&gt; 为密码）： 123update mysql.user set authentication_string=password('&lt;password&gt;') where user='root';flush privileges;quit; 在 MySQL 8 版本中更加便捷： 1ALTER USER 'root'@'localhost' IDENTIFIED BY 'MyNewPass'; 安装 MySQL 服务。在 D:\MySQL\bin 目录下以管理员身份键入 mysqld --install 参考 如何修改MySQL5.7.18的密码 解决Windows安装解压版MySQL出现服务正在启动-服务无法启动的问题 Running/Starting MySQL without installation on Windows 5.7 Upgrade and Resolving ERROR 1130 Host ‘localhost’ is Not Allowed to Connect CentOS 系统部署 MySQL 5.7 添加 MySQL 的 Yum 仓库：Download MySQL Yum Repository。 123wget https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpmrpm -ivh mysql57-community-release-el7-11.noarch.rpmyum install mysql-server 启动 MySQL 服务： 12systemctl start mysqldsystemctl status mysqld 更改 root 用户密码： 12mysqladmin -uroot password -p&lt;password&gt; 允许远程访问： 123% mysql -uroot -pgrant all privileges on *.* to 'root'@'%' identified by '&lt;password&gt;';flush privileges; 配置文件 /etc/my.cnf12345678910111213[mysqld]port = 3677basedir = "D:\\MySQL"datadir = "D:\\MySQL\\data"max_connections = 200character-set-server = UTF8MB4default-storage-engine = INNODBexplicit_defaults_for_timestamp = true[mysqladmin]user = "root"port = 3677 问题 rpm 无法添加仓库 如果不是全新安装，需要手动删除之前用 rpm 安装的 mysql 相关的包 服务无法启动 重设 MySQL 数据目录的权限： 1chmod -R 777 /var/lib/mysql 参考 centos7 mysql数据库安装和配置 CentOS 7 下开启Mysql-5.7.19远程访问 CentOS7 64位下MySQL5.7安装与配置（YUM） RPM命令详解（安装、升级、卸载） Configuring A Fresh Install Of MySQL On CentOS: Start Service, Set Password, Set Runlevels]]></content>
      <categories>
        <category>Development and Deployment</category>
      </categories>
      <tags>
        <tag>SQL</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[从源码编译 Vim 8]]></title>
    <url>%2Fbuilding-vim-from-source%2F</url>
    <content type="text"><![CDATA[作为 Vim 重度依赖者，是时候记录下 *nix 系统从源码编译 Vim 的过程了。 CentOS 一路遇到了不少坑，遇到奇奇怪怪的错误，没有一一记录，直接写下成功的编译过程。（系统版本 CentOS 7.3 x64） 系统用U盘进行安装的，自带了个 python2.7。首先安装必要包（可能不全） 1yum install mercurial ncurses-devel ruby ruby-devel lua lua-devel luajit python-devel python34 python34-devel 克隆 Vim 的仓库 1git clone https://github.com/vim/vim.git 或同步在码云的仓库： 1git clone https://gitee.com/shinemic/vim.git 开始各种配置： 123456789101112131415./configure --with-features=huge \ --enable-rubyinterp=yes \ --enable-luainterp=yes \ --enable-perlinterp=yes \ --enable-pythoninterp=yes \ --enable-python3interp=yes \ --with-python-config-dir=/usr/lib64/python2.7/config \ --with-python3-config-dir=/usr/lib64/python3.4/config-3.4m \ --enable-fontset=yes \ --enable-cscope=yes \ --enable-multibyte \ --disable-gui \ --enable-fail-if-missing \ --prefix=/usr/local \ --with-compiledby='Professional operations' 对其中的参数稍作解释： --enable-fail-if-missing 表示一旦出现配置错误，则报错并停下来， 这时候可以看到什么方面没有配置好，方便排错，否则还要往回翻看一大串的信息 ...interp=yes 表示加入某某支持 在加入对 python 的支持中，出现了各种问题，最终发现是没有安装 python-dev 以及 python34-devel。同样 lua 也要安装 lua-devel。 另外 ...-config-dir 也是很重要的，默认情况下 Vim 是找不到他们的配置路径的 编译。 12makemake install 开耍。vim --version 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748VIM - Vi IMproved 8.0 (2016 Sep 12, compiled Aug 3 2017 06:43:08)Included patches: 1-844Compiled by root@Dorawk-workstationHuge version without GUI. Features included (+) or not (-):+acl +file_in_path +mouse_sgr +tag_old_static+arabic +find_in_path -mouse_sysmouse -tag_any_white+autocmd +float +mouse_urxvt -tcl-balloon_eval +folding +mouse_xterm +termguicolors-browse -footer +multi_byte -terminal++builtin_terms +fork() +multi_lang +terminfo+byte_offset +gettext -mzscheme +termresponse+channel -hangul_input +netbeans_intg +textobjects+cindent +iconv +num64 +timers-clientserver +insert_expand +packages +title-clipboard +job +path_extra -toolbar+cmdline_compl +jumplist +perl +user_commands+cmdline_hist +keymap +persistent_undo +vertsplit+cmdline_info +lambda +postscript +virtualedit+comments +langmap +printer +visual+conceal +libcall +profile +visualextra+cryptv +linebreak +python/dyn +viminfo+cscope +lispindent +python3/dyn +vreplace+cursorbind +listcmds +quickfix +wildignore+cursorshape +localmap +reltime +wildmenu+dialog_con +lua +rightleft +windows+diff +menu +ruby +writebackup+digraphs +mksession +scrollbind -X11-dnd +modify_fname +signs -xfontset-ebcdic +mouse +smartindent -xim+emacs_tags -mouseshape +startuptime -xpm+eval +mouse_dec +statusline -xsmp+ex_extra -mouse_gpm -sun_workshop -xterm_clipboard+extra_search -mouse_jsbterm +syntax -xterm_save+farsi +mouse_netterm +tag_binary system vimrc file: "$VIM/vimrc" user vimrc file: "$HOME/.vimrc" 2nd user vimrc file: "~/.vim/vimrc" user exrc file: "$HOME/.exrc" defaults file: "$VIMRUNTIME/defaults.vim" fall-back for $VIM: "/usr/share/vim"Compilation: gcc -c -I. -Iproto -DHAVE_CONFIG_H-g -O2 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=1Linking: gcc -L. -Wl,-z,relro -fstack-protector -rdynamic -Wl,-export-dynamic-Wl,--enable-new-dtags -Wl,-rpath,/usr/lib64/perl5/CORE -L/usr/local/lib -Wl,--as-needed -o vim -lm -ltinfo -lnsl -lselinux -ldl -L/usr/lib -llua-Wl,--enable-new-dtags -Wl,-rpath,/usr/lib64/perl5/CORE -fstack-protector-L/usr/lib64/perl5/CORE -lperl -lresolv -lnsl -ldl -lm -lcrypt -lutil -lpthread-lc -lruby -lpthread -lrt -ldl -lcrypt -lm Ubuntu 系统版本 Ubuntu 16.04+。 12345678910111213141516171819sudo apt-get install libncurses5-dev libgnome2-dev \ libgnomeui-dev libgtk2.0-dev libatk1.0-dev libbonoboui2-dev \ libcairo2-dev libx11-dev libxpm-dev libxt-dev python-dev \ python3-dev ruby-dev lua5.1 lua5.1-dev liblua5.1-dev libperl-dev git./configure --with-features=huge \ --enable-luainterp=yes \ --enable-rubyinterp=yes \ --enable-perlinterp=yes \ --enable-pythoninterp=yes \ --with-python-config-dir=/usr/lib/python2.7/config-x86_64-linux-gnu \ --enable-python3interp=yes \ --with-python3-config-dir=/usr/lib/python3.5/config-3.5m-x86_64-linux-gnu \ --enable-fontset=yes \ --enable-cscope=yes \ --enable-multibyte \ --enable-fail-if-missing \ --enable-gui=gtk2 \ --prefix=/usr/local \ --with-compiledby='Professional operations' MSYS2 首先编译 lua： 12345curl -R -O http://www.lua.org/ftp/lua-5.3.4.tar.gztar zxf lua-5.3.4.tar.gzcd lua-5.3.4pacman -S ncurses-devel libcrypt-devel gettext-develmake mingw &amp;&amp; make install 配置： 12345678910111213./configure --with-features=huge \ --enable-luainterp=yes \ --enable-perlinterp=yes \ --enable-pythoninterp=yes \ --enable-python3interp=yes \ --with-lua-prefix=/usr/local \ --enable-fontset=yes \ --enable-cscope=yes \ --enable-multibyte \ --disable-gui \ --enable-fail-if-missing \ --prefix=/usr/local \ --with-compiledby='Professional operations' 其它 插件管理器 1git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim 个人 vimrc Linux: .vimrc MSYS2: _vimrc 注意事项 在 CentOS 机器上若安装其它版本的 Python，可能导致各种与 Python 相关的问题（比如 Vim: Caught deadly signal ABRT）。在编译的时候灵活取舍 python 与 python3 选项即可 若不能 configure，执行 make distclean]]></content>
      <categories>
        <category>Operation and Maintenance</category>
      </categories>
      <tags>
        <tag>Vim</tag>
        <tag>Linux</tag>
        <tag>MSYS2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[「转」The top 10 tricks of Perl one-liners]]></title>
    <url>%2Fthe-top-10-tricks-of-perl-one-liners%2F</url>
    <content type="text"><![CDATA[作者: Guest Author 链接: The top 10 tricks of Perl one-liners 来源: Oracle Blogs I’m a recovering perl hacker. Perl used to be far and away my language of choice, but these days I’m more likely to write new code in Python, largely because far more of my friends and coworkers are comfortable with it. I’ll never give up perl for quick one-liners on the command-line or in one-off scripts for munging text, though. Anything that lasts long enough to make it into git somewhere usually gets rewritten in Python, but nothing beats perl for interactive messing with text. Perl, never afraid of obscure shorthands, has accrued an impressive number of features that help with this use case. I’d like to share some of my favorites that you might not have heard of. One-liners primer We’ll start with a brief refresher on the basics of perl one-liners before we begin. The core of any perl one-liner is the -e switch, which lets you pass a snippet of code on the command-line: perl -e 'print "hi\n"' prints "hi" to the console. The second standard trick to perl one-liners are the -n and -p flags. Both of these make perl put an implicit loop around your program, running it once for each line of input, with the line in the $_ variable. -p also adds an implicit print at the end of each iteration. Both of these use perl’s special ARGV magic file handle internally. What this means is that if there are any files listed on the command-line after your -e, perl will loop over the contents of the files, one at a time. If there aren’t any, it will fall back to looping over standard input. perl -ne 'print if /foo/' acts a lot like grep foo, and perl -pe 's/foo/bar/' replaces foo with bar. Most of the rest of these tricks assume you’re using either -n or -p, so I won’t mention it every time. The top 10 one-liner tricks Trick #1: -l Smart newline processing. Normally, perl hands you entire lines, including a trailing newline. With -l, it will strip the trailing newline off of any lines read, and automatically add a newline to anything you print (including via -p). Suppose I wanted to strip trailing whitespace from a file. I might naïvely try something like 1perl -pe 's/\s*$//' The problem, however, is that the line ends with \n, which is whitespace, and so that snippet will also remove all newlines from my file! -l solves the problem, by pulling off the newline before handing my script the line, and then tacking a new one on afterwards: 1perl -lpe 's/\s*$//' Trick #2: -0 Occasionally, it’s useful to run a script over an entire file, or over larger chunks at once. -0 makes -n and -p feed you chunks split on NULL bytes instead of newlines. This is often useful for, e.g. processing the output of find -print0. Furthermore, perl -0777 makes perl not do any splitting, and pass entire files to your script in $_. 1find . -name '*~' -print0 | perl -0ne unlink Could be used to delete all ~-files in a directory tree, without having to remember how xargs works. Trick #3: -i -i tells perl to operate on files in-place. If you use -n or -p with -i, and you pass perl filenames on the command-line, perl will run your script on those files, and then replace their contents with the output. -i optionally accepts an backup suffix as argument; Perl will write backup copies of edited files to names with that suffix added. 1perl -i.bak -ne 'print unless /^#/' script.sh Would strip all whole-line commands from script.sh, but leave a copy of the original in script.sh.bak. Trick #4: The .. operator Perl’s .. operator is a stateful operator – it remembers state between evaluations. As long as its left operand is false, it returns false; Once the left hand returns true, it starts evaluating the right-hand operand until that becomes true, at which point, on the next iteration it resets to false and starts testing the other operand again. What does that mean in practice? It’s a range operator: It can be easily used to act on a range of lines in a file. For instance, I can extract all GPG public keys from a file using: 1perl -ne 'print if /-----BEGIN PGP PUBLIC KEY BLOCK-----/../-----END PGP PUBLIC KEY BLOCK-----/' FILE Trick #5: -a -a turns on autosplit mode – perl will automatically split input lines on whitespace into the @F array. If you ever run into any advice that accidentally escaped from 1980 telling you to use awk because it automatically splits lines into fields, this is how you use perl to do the same thing without learning another, even worse, language. As an example, you could print a list of files along with their link counts using 1ls -l | perl -lane 'print "$F[7] $F[1]"' Trick #6: -F -F is used in conjunction with -a, to choose the delimiter on which to split lines. To print every user in /etc/passwd (which is colon-separated with the user in the first column), we could do: 1perl -F: -lane &apos;print $F[0]&apos; /etc/passwd Trick #7: \K \K is undoubtedly my favorite little-known-feature of Perl regular expressions. If \K appears in a regex, it causes the regex matcher to drop everything before that point from the internal record of “Which string did this regex match?”. This is most useful in conjunction with s///, where it gives you a simple way to match a long expression, but only replace a suffix of it. Suppose I want to replace the From: field in an email. We could write something like 1perl -lape &apos;s/(^From:).*/$1 Nelson Elhage &lt;nelhage\@ksplice.com&gt;/&apos; But having to parenthesize the right bit and include the $1 is annoying and error-prone. We can simplify the regex by using \K to tell perl we won’t want to replace the start of the match: 1perl -lape 's/^From:\K.*/ Nelson Elhage &lt;nelhage\@ksplice.com&gt;/' Trick #8: $ENV{} When you’re writing a one-liner using -e in the shell, you generally want to quote it with ', so that dollar signs inside the one-liner aren’t expanded by the shell. But that makes it annoying to use a ' inside your one-liner, since you can’t escape a single quote inside of single quotes, in the shell. Let’s suppose we wanted to print the username of anyone in /etc/passwd whose name included an apostrophe. One option would be to use a standard shell-quoting trick to include the ': 1perl -F: -lane 'print $F[0] if $F[4] =~ /'"'"'/' /etc/passwd But counting apostrophes and backslashes gets old fast. A better option, in my opinion, is to use the environment to pass the regex into perl, which lets you dodge a layer of parsing entirely: 1env re=&quot;&apos;&quot; perl -F: -lane &apos;print $F[0] if $F[4] =~ /$ENV&#123;re&#125;/&apos; /etc/passwd We use the env command to place the regex in a variable called re, which we can then refer to from the perl script through the %ENV hash. This way is slightly longer, but I find the savings in counting backslashes or quotes to be worth it, especially if you need to end up embedding strings with more than a single metacharacter. Trick #9: BEGIN and END BEGIN { ... } and END { ... } let you put code that gets run entirely before or after the loop over the lines. For example, I could sum the values in the second column of a CSV file using: 1perl -F, -lane '$t += $F[1]; END &#123; print $t &#125;' Trick #10: -MRegexp::Common Using -M on the command line tells perl to load the given module before running your code. There are thousands of modules available on CPAN, numerous of them potentially useful in one-liners, but one of my favorite for one-liner use is Regexp::Common, which, as its name suggests, contains regular expressions to match numerous commonly-used pieces of data. The full set of regexes available in Regexp::Common is available in its documentation, but here’s an example of where I might use it: Neither the ifconfig nor the ip tool that is supposed to replace it provide, as far as I know, an easy way of extracting information for use by scripts. The ifdata program provides such an interface, but isn’t installed everywhere. Using perl and Regexp::Common, however, we can do a pretty decent job of extracing an IP from ips output: 12ip address list eth0 | \ perl -MRegexp::Common -lne 'print $1 if /($RE&#123;net&#125;&#123;IPv4&#125;)/' So, those are my favorite tricks, but I always love learning more. What tricks have you found or invented for messing with perl on the command-line? What’s the most egregious perl “one-liner” you’ve wielded, continuing to tack on statements well after the point where you should have dropped your code into a real script?]]></content>
      <categories>
        <category>Tips and Tricks</category>
      </categories>
      <tags>
        <tag>Perl</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[「转」高级程序员装逼指南]]></title>
    <url>%2Fhow-to-behave-like-master-for-advanced-coder%2F</url>
    <content type="text"><![CDATA[作者: rollenholt 链接: 高级程序员装逼指南, 是高级哦！ 来源: 云栖社区 前言 最近网上出了一个「程序员装逼指南」，觉得这个东西其实图样图森破，然后在下跟微博上的一些程序大牛讨论了一下如何装逼，深有感触。程序员嘛，外行人看起来已经是不可理解的奇怪生物了，自然也没必要跟他们… 编程语言 千万千万千万千万不要说自己是 Java/C#/C++ 程序员，尽量学一些奇怪的语言，python 已经有烂大街的趋势了，写写还是可以，装逼是用不上了。Lisp 和 Erlang 都是装逼的好语言。当然你要是号称会 Haskell 就更牛逼了，实在不会也没关系，发发跟 Haskell 有关的状态别人也很装了。没事儿还可以在论坛里喷喷 Java/C++ 有哪些缺点，可是，如果对方先发制人说他出了一种奇怪的语言名字怎么办？你可以微笑地说，你可知道天下语言皆出自 Lisp 和 Smalltalk？保准对方愣住 3 秒钟。 操作系统 首先，妥妥儿的不能用 Win，麻瓜才用 Win 呢。Linux 嘛，ubuntu 也差了点儿，现在不少人已经用 Arch 了，懂行儿的人都知道，gentoo 和 LFS 才是真正的装逼利器啊。自己编译神马的，这逼还真不是人人都能装的。再深入的话，你要是用 Lisp Machine 工作，就近乎神了。 编辑器 作为一个 IDE 去死团成员，我承认很大程度上我只是在装逼，纯文本编辑器才是你最终的归宿。Vim是标配，但是只有 Emacs 才能称得上是神器，「伪装成操作系统的编辑器」并非浪得虚名。当然，想要装逼装得好的话，你还需要学习它的配置语言 Emacs Lisp。 博客 在 CSDN/ITeye/cnblogs 这种地方写技术博客确实比在人人上写技术博客好多了，但是你要知道，大牛们都是有自己的个人网站的，而且，一个共同点是，他们的网站都是自己写的 html（没有 css）并且界面十分难看。整个网站散发着一种「我这的文章都很牛所以界面什么的都不重要」的气质。例如这个: http://xahlee.org/index.html。 其它 我习惯称不会写代码的人为「麻瓜」，你也可以有你自己的称呼。不要写 Linux/Unix，正确而专业的写法是 *nix。手边不要放技术书籍，即使要摆一两本书也要那种自己打印的全英文的手册，或者用铅笔在纸上写代码也是个不错的选择。还可以养成某种奇特的习惯，例如号称自己是 Lisper 然后各种（括号）。 装逼进阶 老是装逼也不成，所以我一直在寻找一种秒杀一切程序员的装逼之法。说实话，程序员的世界里有三种人。大部分是不会写代码的麻瓜，然后是程序员这个群体本身，他们认为唯一比程序员牛逼的，就是搞数学的人了。所以嘛，你要真想装个牛逼，就去学好傅立叶变换吧。另，发明 Lisp 和 Python 的人都是数学家，高得纳大神也是数学教授。 大家都出来各自上车了这叫切断电源 你们这桌交错敬酒，敬我一杯，敬你一杯，叫全相连。 你们这桌有人提议咱们男士敬女士们一杯，叫组相连。 BOSS 自己提了一瓶过来说兄弟们再把这个解决了这叫 alpha 测试。 BOSS 让服务生端了二瓶过来，隔着桌子喊，你们这桌再把这个解决了，这叫 beta 测试。 经理过来要敬大家，你们都说不行了，经理指着酒量最大的人说 ××× 你代表大家把这杯干了，这叫白盒测试。 经理过来要敬大家，你们都说不行了，经理说我不管，出个人把这杯干了，这叫黑盒测试。 又有人醉醺醺地过来要敬大家，一看不认识不是你们公司的这叫地址错误。 你拍拍这人肩膀说兄弟你是对面厅的吧这叫重定向。 你一人自斟自饮喝闷酒这叫 PC 你们这桌相互敬酒这叫 LAN 你们和别桌流动敬酒这叫 WAN 你们一哥们醉了上二楼别的公司的庆祝宴上去敬酒这叫 INTERNET 你一人到领导那桌说张总我敬你一个王总我敬你一个。….这叫 PPP 你们一群人到领导那桌说张总我们敬你一个王总我们敬你一个……这叫 ADSL BOSS 举起一杯说我代表公司向你们项目组的成功表示祝贺这叫 B2B 项目经理举起一杯说我代表项目组向张工的付出表示感谢这叫 B2C 你也举杯说张哥我对你的景仰如指令流水滔滔不绝这叫 C2C 你一哥们不行了喝点水也吐这叫插入异常 你也觉得不行了上洗手间想解决一下可怎么也吐不出来这叫删除异常 你们这桌子萧是头儿他一喝大家跟着喝这叫 Primary Key 你们这桌坐了俩头儿，别桌的都过来敬酒这叫 Foreign Key 叶子菊说不行我不喝酒的，经理说不行今天都得喝点这叫 NOT NULL 经理从别桌转回来了问小李喝了吗喝了多少，这叫 Check Boss 说在座的各位今儿个都得尽兴这叫 Assertion全局约束 乔大饼是海量偏不多喝这叫资源闲置 阿甘不行了还要喝这叫超频 小牛过来跟你碰杯这叫过程 小吴过来跟你碰杯完了还要谈感受这叫函数 你们这桌喝没了，这叫缺页中断 让小姐拿两瓶过来这叫请求分页 让她把酒放下把空瓶收拾收拾这叫页面置换 一群人来给你敬酒你说等一下慢慢来这叫 P 操作 你喝得豪气冲天放下杯说下一个我喝谁的这叫 V 操作 你正在喝着有人来跟你碰杯你说等一下这叫阻塞 那人看你放下杯给你满上这叫就绪 稍歇了一下那人说该咱俩喝了这叫运行 你刚喝了半口手机响了这叫中断 你说不好意思哥们等一下这叫挂起 你接完电话挂机了那人说咱俩继续这叫激活 你来这杯终于喝完了那人回他们桌子上去了这叫终止 又一哥们过来说你喝我就喝这叫同步 一激动他把自个儿杯子打了这成了互斥 你把这杯推给他说你先喝他又推回来说你先喝这叫死锁 你说那咱们都不喝了这叫撤销 贝贝喝了 1.44ml 就醉了退出来了这叫软盘 达兰木坐那儿不动光猛喝这叫硬盘 曹无名光看不喝这叫光盘 anetople 上这桌喝又上那桌喝这叫 U 盘 大家你一杯我一杯地喝这叫聊天室 一个人猛喝其他人跟着喝这叫论坛 你站起来猛灌别人都看你喝这叫博客 曹无名暗恋何有名拉她上沙发那边喝这叫 QQ 要敬你的人太多了他们一人一杯都放在你面前这叫 SPOOLING 你实在不行了钻桌子底下去了这叫作业中止 来不及上洗手间就吐了这叫 ERROR 脸色煞白起不来了这叫 FATE ERROR 经理紧张了说你没事吧这叫询问 你说不出话了这叫丢失应答 一哥们开始拨 120 了这叫紧急修复 Boss 也急了说你们先撤大家也都散了吧这叫解除 120 来了这叫 GAME OVER 120 先走了这叫关机 这个是原版 一. 准备工作 工欲善其事必先利其器。 电脑不一定要配置高，但是双屏是必须的，越大越好，能一个横屏一个竖屏更好。 一个用来查资料，一个用来写代码。总之要显得信息量很大，效率很高。 椅子不一定要舒服，但是一定要可以半躺着。 大量的便签，各种的颜色的，用来记录每天要完成的事务，多多益善。 沿着电脑屏幕的边框，尽量贴满，显出有很多事情的样子。 工具书，orelly 的，机械工业，电子工业什么的都可以，能英文就英文， 不行影印版的也可以，反正越厚越好，而且千万不要放在书架上，一定要堆在桌上，半打开状。 二. 从进门开始 着装！着装！不管你是去实验室，或者去公司的大楼，在或者是小公司的民宅，或是自己创业的黑作坊；无论是春夏秋冬白天晚上刮风下雨电闪雷鸣台风龙卷风，一个装 B 的程序员都要十分在意自己着装！ 这里只提出参考建议。 初级装：衬衣+牛仔裤+休闲鞋。 中级装：T 恤+宽松短裤+拖鞋。 高级装：背心+宽松大花裤衩+人字拖。 得体的举止。在走廊以及任何形式的过道里，一定要双手插兜，走得像个痞子， 至少要看起来有点反社会，如若不行，可走文弱天才型 geek 路线。 如果有女性在你背后指指点点，小声嘀咕说这一定是一个技术男的时候，应该先低头， 然后保持低头状态，缓缓回头，坏坏地蔑笑但是不要出声，然后快步前行。 进门后，一定不要跟任何人打招呼，笔直走向自己的位置，最多路过打一杯咖啡，千万不要有多余的动作，显示出自己的专注与心无旁骛。 三. 坐下就不要再动了 坐下以后。姿势需要略微后仰。能翘着二郎腿最好了。然后在后仰的情况下低着头。 以便看到屏幕。然后千万就不要再动了。 粗暴地把电脑前的大堆书推开一个口。然后摘下电脑上的一个便签。看一眼。不过3秒。可以开始 coding 了。 能不用 IDE 就不要用。实在装不了。无论 IDE 是什么。一定要调成 DOS 那种黑色背景的。 如果写前台界面。就不停地调试后台代码；如果写 java。就在里面混编 C；如果写 C。 就在里面混编汇编。不光要 coding。还要时不时的翻出一本什么英文的书翻一翻。看不懂就看看插图。然后扔到面前假装懂了继续 coding。 什么看起来高端就用什么。不要管实用不实用。例如对 C++：switch 统统重构成多态；如果有指针。统统改成智能的；C++ 一定要自己写 template；数字是全部要替换成宏的名字能起多长就起多长；struct就不要出现了。如果出现。也一定要用 __attriburte__修饰一下；运算都是位操作的；操作符都是重载的；网络都是并发缓冲线程池的；int 只用 int32_t 声明的；继承不用普通的。什么多继承虚继承啊；helloworld 也要写捕获异常的； 后人一看代码。中间一堆关键字 extern，asm，auto，XXXXX_cast，volatile，explicit，register，template。让一般总在敲 int，if，else，for 的小程序员顿时心生崇拜。 注释？算了吧。只有两个路线可以选： 一. 变量名起得巨长无比。看代码就和读英文文章一样顺畅，根本不需要加注释。 二. 代码无比晦涩，加不加注释根本无影响。 千万不要用 IM 工具交流。千万不要问同事问题。显得自己没有水平。都是自己上网或者查书。 无论是同事间开玩笑或者发生任何群体性时间。不要抬头。更不要东张西望。 即使地震火灾。也一定要先提交代码再行离开。 四. 潇洒地离开 人走，主机是千万千万不能关的，至少要跑个 daily build，实在不行正在 svn 提交也勉强算过关。 书应该已经又堆到屏幕前了，千万不要整理，明天再来推开。 不强求最后一个走，但一定要所有的非程序员，什么市场啊前台啊 pm 啊都走光了，才可以走。 走得时候一定要率性，千万不要收拾任何东西，站起来，出门，好的，就这样。 如果今天一定要说句话的话，找到那个最苦逼的程序员，跟他说，你进度太慢了啊，不要老让我等你。 在那山的这边海的那边有一群程序员，他们老实又胹腆，他们聪明又没钱。他们一天到晚坐在那里熬夜写软件，饿了就咬一口方便面 ~~ 哦苦命的程序员，哦苦逼的程序员，只要一改需求他们就要重新搞一遍，但是期限只剩下两天。]]></content>
      <categories>
        <category>Memos</category>
      </categories>
      <tags>
        <tag>Programmer</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Perl 5 拾零]]></title>
    <url>%2Fnotes-on-perl-5%2F</url>
    <content type="text"><![CDATA[Perl 5 笔记. use 5.016 表示程序只能在 Perl 5.16 以上的版本运行，另外版本号一定要写成三位数，包括前导零 整数直接量可以用 _ 分隔以提高阅读体验，比如 0x50_65_72_7c 字符串用点号 . 拼接 字符串重复操作符 x 可以让左边的操作数重复右边的操作数进行连接 语句末尾的 ; 除了在块中末尾行，都是必须的 单引号内能转义的字符仅有 ' 及 \ 双引号内字符串的转义字符有(特殊): \e – Esc (ASCII 编码的转义字符) \007 – 八进制 \x7f – 十六进制 \x{2744} – 十六进制的 Unicode 代码点 \cC – Control 键的代码 \l / \L – 将下个/后面所有字母转为小写 \u / \U – 将下个/后面所有字母转为大写 \Q – 把它到 \E 之间的非单词字符加上反斜线转义 \E – 结束 \L，\U，\Q 开始的作用范围 获取用户输入并去除末尾的换行符(标量 / 数组)： 12chomp(my $text = &lt;STDIN&gt;);chomp(my @texts = &lt;STDIN&gt;); 判断是否为 undef：defined 函数 $#foo 返回 @foo 的最大索引值 数组内插到双引号串中时自动添加分隔用的空格，空格这个分隔符的变量为 $" each 操作符与 Python 中的 enumerate 相似，会返回数组中的元素索引以及值 强制指定标量上下文，比如 1234my @rocks = qw ! talc quartz jade obsidian !;print "How many rocks do you have?\n";print "I have ", @rocks, " rocks!\n";print "I have ", scalar @rocks, " rocks!\n"; 避免子程序名称与内置函数重名，应使用 &amp;，或者打开警告开关 use warnings 不能在 qw 函数中运用字符串插值 如果 print 或者其它函数名后面接着一个左括号，务必保证这个括号是成对的 赋值语句返回实际的变量作为左值 在同一个正则表达式中，反向引用为 \1，否则使用 $1 Perl 提供两种类型的名字空间，符号表 (symbol table) 和词法作用域 (lexical scope) $str =~ tr/x// 仅统计 $str 中 x 的数量，而 tr/x//d 删除所有的 x Windows 用 StrawBerry Perl 安装 CPAN 包时，注意将包含 StrawBerry 的 GCC 工具链优先级提前或者删除其它可能影响编译的路径，部分包需要强制安装：cpan -fi Tk Windows 下 cpan 安装包遇到网络环境差如何设置代理： 12% set http_proxy=http://127.0.0.1:1234% cpan -fi xx::xx Windows 下 Strawberry Perl 的 portable 版本中， \Strawberry\perl\vendor\lib\Portable 会覆盖掉模块 File::Homedir，导致结果可能与预期不同，应改用 File::HomeDir::Windows 更新 上述的问题可能与 File::HomeDir 的版本过低有关，重新通过 cpan 安装貌似可以解决 在标量上下文中，each 仅返回 hash 的键，或者列表的索引 从源码编译 Perl：http://www.cpan.org/src。文章：How to build perl from source on Linux. 示例： 12345678wget http://www.cpan.org/src/5.0/perl-5.26.1.tar.gztar -xzf perl-5.26.1.tar.gzcd perl-5.26.1./Configure -des -Dprefix=$HOME/localperl -Dusethreads -Duselargefiles \ -Duse64bitint -Duselongdouble -Dusemorebits -Duseshrplibmake -j4TEST_JOBS=4 make test_harnessmake install 关于 Perl 命令行参数 -0： -0：相当于 $/ = "\0" -00：相当于 $/ = ""，段落模式 -0777：相当于 $/ = undef，啜食模式 由 按时间排序字符串 而来的 施瓦茨变换(Schwartzian transform) 安装 cpanm：cpan App::cpanminus。设置下载镜像： 1alias cpanm='cpanm --mirror http://mirrors.ustc.edu.cn/CPAN --mirror http://www.cpan.org' \(\LaTeX\) 中展示目录树。 [参考：(Semi-)automatic directory-tree in LaTeX] tree.pl12345\usepackage&#123;dirtree&#125;...\dirtree&#123;...&#125; \dirtree 中的部分可由 tree.pl 来生成 如果子程序的定义在其被调用之前，调用时可略去括号；如果定义在被调用之后，则不能省略括号。（后者也为 Perl Maven 的这篇 文章 所推荐）]]></content>
      <categories>
        <category>Memos</category>
      </categories>
      <tags>
        <tag>Perl</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux 中日期 date 命令格式控制符]]></title>
    <url>%2Flinux-date-format%2F</url>
    <content type="text"><![CDATA[Linux 中的 date 命令格式控制符实在令人眼花缭乱，整理如下。 格式控制符 说明 举例 %% 百分号 % %a 短星期（区域相关） Sat %A 长星期（区域相关） Saturday %b 短月份 Dec %B 长月份 December %c 日期时间 Sat 09 Dec 2017 08:45:40 PM CST %C 年份前两位 20 %d 天数（前置补零） 09 %D 日期，格式为：%m/%d/%y 12/09/17 %e 天数（前置空格） 9 %F 日期，格式为：%Y-%m-%d 2017-12-09 %g 17 %G 2017 %h 同 %b Dec %H 24 小时制小时（前置补零） 20 %I 12 小时制小时（前置补零） 08 %j 一年中第几天（前置补零） 343 %k 24 小时制小时（前置空格） 20 %l 12 小时制小时（前置空格） 8 %m 数字月份（前置补零） 12 %M 分钟（前置补零） 45 %n 换行 %N 纳秒 893369643 %p PM 或 AM PM %P 小写的 pm 或 am pm %r 08:45:40 PM %R 24 小时制小时分钟: %H:%M 20:45 %s 从 1970-01-01 00:00:00 UTC 开始计算的秒数 1512823540 %S 秒数（00..60，前置补零） 40 %t 制表符号 %T 时间：%H:%M:%S 20:45:40 %u 数字星期（1-7，1 表示周一） 6 %U 周数（周日为星期第一天，前置补零） 49 %V 49 %w 数字星期（0-6，0 表示周日） 6 %W 周数（周一为星期第一天，前置补零） 49 %x 区域日期 12/09/2017 %X 区域时间 08:45:40 PM %y 年份后两位（短年份） 17 %Y 长年份 2017 %z +0800 %:z +08:00 %:: +08:00:00 %:: +08 %Z 字母时区简写 CST]]></content>
      <categories>
        <category>Operation and Maintenance</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Date</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux 中的密码管理器 -- pass]]></title>
    <url>%2Fpassword-manager-on-linux%2F</url>
    <content type="text"><![CDATA[Linux 中很方便的密码管理小工具 – pass 。 一般源都包含 pass，直接 apt / yum / pacman 安装即可。 首先创建 gpg 密钥对：gpg --gen-key 依次选择 (1) RSA and RSA (default)，0 = key does not expire，自定义 Real name，Email address 即可 初始化密码仓库：pass init &lt;gpg-id&gt;，其中的 &lt;gpg-id&gt; 便为上面的 Real name 使用方法 pass insert &lt;password-name&gt; [-m]：（是否细致化）增加密码项，其中 &lt;password-name&gt; 可以通过 / 来建立层级，放映在目录上就是父子目录 pass：查看所有密码 pass &lt;password-name&gt;：取回密码信息 pass generate &lt;password-name&gt; n：生成 10 个字符的密码 pass rm &lt;password-name&gt;：删除密码项 其它 gpg 列出密钥：gpg --list-keys。第一行是公钥文件路径，第二行是公钥信息，第三行是用户 ID，第四行是私钥信息 参考 pass - the standard unix password manager 如何在Linux上使用命令行管理密码 GPG入门]]></content>
      <categories>
        <category>Handy Utilities</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Pass</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Conda 使用小结]]></title>
    <url>%2Fnotes-on-conda%2F</url>
    <content type="text"><![CDATA[Conda 既可以管理包，还是个「环境」管理器。包管理器可以帮助查找以及安装包，但是如果需要使用不同版本的 Python，那就需要有不同的环境。 设置国内镜像 没的说，这步十分重要。 12conda config --add channels https://mirrors.ustc.edu.cn/anaconda/pkgs/free/conda config --set show_channel_urls yes 或者直接编辑 ~/.condarc： .condarc12345678910channels: - https://mirrors.ustc.edu.cn/anaconda/pkgs/main/ - https://mirrors.ustc.edu.cn/anaconda/pkgs/free/ - https://mirrors.ustc.edu.cn/anaconda/cloud/conda-forge/ - defaultsproxy_servers: http: http://localhost:1888 https: https://localhost:1888show_channel_urls: truessl_verify: true 更新 Conda 可以更新自身：conda update conda；可以更新 Anaconda：conda update anacond；可以更新 Python，这里会更新到当前环境下 Python 对应的最新版本。 环境管理 创建环境 snowflakes（目录为 anaconda/envs/snowflakes ），并安装包 Biopython。（ --name 可简写为 -n，--envs 可简写为 -e ） 1conda create --name snowflakes biopython 创建一个名为 bunnies 的环境，使用 python3.5 作为 Python 环境，并安装包 Astroid，Babel 1conda create --name bunnies python=3.5 astroid babel 激活某个环境 / 取消激活 (返回默认的 root 环境)，Windows 下无需 source 12source activate snowflakessource deactivate 列出所有环境，其中 * 表示当前激活环境 1conda info --envs 克隆环境。基于 snowflakes 克隆出新的 flowers 环境 1conda create --name flowers --clone snowflakes 删除环境 1conda remove --name flowers --all Python 管理 检查可用 Python 版本，其中 --full-name 为全字匹配，去掉即为包含查询 1conda search --full-name python 包管理 将 Beautiful Soup 安装至环境 bunnies 1conda install --name bunnies beautifulsoup4 删除包 1conda remove --name bunnies iopro 补充 从 Anaconda 4.1.0 开始，一个特别的包 nb_conda_kernels 能够自动检测 Conda 的所有环境并注册这些核到 Jupyter Notebook 里面 Windows 中的 Anaconda 新建的新环境安装完 anaconda 包之后才会在开始程序中出现快捷方式 conda list 可能出现两个 pip 解决方案： 123pip uninstall pipconda install pip -fconda update pip]]></content>
      <categories>
        <category>Development and Deployment</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Anaconda</tag>
        <tag>Conda</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[「摘」自定义 zip 和 map 函数]]></title>
    <url>%2Fuser-defined-zip-and-map%2F</url>
    <content type="text"><![CDATA[作者: Mark Lutz 著，李军 刘红伟译 来源: 「Python 学习手册」 章节: 第 20 章 – 迭代和解析，第二部分 在 Python 2.x 中，map 函数会将 None 补充至返回结果中，也就是说，最后返回列表的长度为其参数中长度最长的一个，这与 Python 3.x 中 map 的行为是不同的（Python 3.x 中会将其截断，结果返回参数中长度为最短的一个） 可以用如下代码进行模拟： 12345678910111213def myzip(*deqs): seqs = [list(S) for S in seqs] res = [] while all(seqs): res.append(tuple(S.pop(0) for S in seqs)) return resdef mymapPad(*seqs, pad=None): seqs = [list(S) for S in seqs] res = [] while any(seqs): res.append(tuple((S.pop(0) if S else pad) for S in seqs)) return res 其中，myzip 函数将参数全部显式转化为列表，根据所有参数的最小长度进入循环。因为该函数的目的是「截断」，所以是「短板效应」。而且 mymapPad 函数中，应该试图一直「取下去」，遇到没有元素的参数时，用 pad 进行填充 (默认是 None)。同样，上面的版本直接返回列表，用 yield 版本返回生成器： 123456789def myzip(*seqs): seqs = [list(S) for S in seqs] while all(seqs): yield tuple(S.pop(0) for S in seqs)def mymapPad(*seq, pad=None): seqs = [list(S) for S in seqs] while any(seqs): yield tuple((S.pop(0) if S else pad) for S in seqs) 因为循环次数可以事先被确定，所以有如下不使用循环的版本： 12345678def myzip(*seqs): minlen = min(len(S) for S in seqs) return [tuple(S[i] for S in seqs) for i in range(minlen)]def mymapPad(*seqs, pad=None): maxlen = max(len(S) for S in seqs) return [tuple(S[i] if len(S) &gt; i else pad for S in seqs) for i in range(maxlen)] 最后一个版本是完全的生成器版本： 123def myzip(*seqs): minlen = min(len(S) for S in seqs) return (tuple(S[i] for S in seqs) for i in range(minlen))]]></content>
      <categories>
        <category>Development and Deployment</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Iterator</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows 下利用 MSYS2 搭建 sshd 服务器]]></title>
    <url>%2Fdeployment-of-sshd-on-windows-via-msys%2F</url>
    <content type="text"><![CDATA[若能在远程中非图形界面下访问到自己的 Windows 服务器，比如像 Linux 那样通过 SSH 连接便能进行日常操作，那确实是很方便的。然而 Windows 鸡肋的 cmd 足以毁坏每天的心情，所以 Windows 下装配一个 *nix 系统也是必要的。下面记录 Windows 中利用 MSYS2 清真 搭建 sshd 服务的全过程。 配置 sshd 服务 脚本：sshd_msys.sh，注意其中的 tmp_pass 可作为登录密码。 64 位的 MSYS2 下，以管理员身份登录 MinGW64 可能需要手动创建一些文件 12# mkpasswd &gt; /etc/passwdtouch /var/log/lastlog 为灵活切换 MSYS / MINGW64 / MINGW32 环境，将 /etc/ssh/sshd_config 文件中的 PermitUserEnvironment 置为 yes，并新建文件 ~/.ssh/environment 并在其中添加 MSYSTEM=MINGW64 net start/stop sshd 可启用 / 停止 sshd 服务 （此服务在系统的 Services 中的服务名为 sshd，登录账号应为 .\sshd_server） 如此一来就可以进行本地 SSH 登录了，如要进行远程 SSH 访问本机，需作反向代理。 配置反向代理 ssh 服务 MSYS2 默认的源中没有 autossh，所以需自行编译: repo。在 MSYS 中一通操作： 1234git clone https://github.com/mati865/MSYS2-additional-packages.gitcd MSYS2-additional-packages/autosshmakepkgpacman -U autossh*.pkg.tar.xz 如安装顺利，则二进制文件为 /usr/bin/autossh。安装系统服务： 12345678910# ssh-keygen -t 'rsa'ssh-copy-id user@domaincygrunsrv -R autossh_12345cygrunsrv -I autossh_12345 -d "MSYS2 Reverse Tunnel - xxxx" -p \ /usr/bin/autossh.exe -a "-M 0 -o ExitOnForwardFailure=yes -o \ ServerAliveInterval=30 -o ServerAliveCountMax=3 \ -o ExitOnForwardFailure=yes \ -NR 12345:localhost:22 user@domain -i ~/.ssh/id_rsa" \ -y tcpip -u ".\$&#123;USER&#125;" -w "$&#123;PASSWD&#125;"cygrunsrv -S autossh_12345 那么就在系统中注册了名为 autossh_xxxx 的服务，其中 ${USER}，${PASSWD} 分别为系统用户名和密码，启动 / 停止服务同上述 sshd 服务。 cygrunsrv 参数解释： -I 或 --install：安装服务 -d：显示名 -p：程序路径 -a：参数 -y：服务依赖，服务名可直接在 services.msc查询 -t：服务启动类型（auto | manual） 另外，Windows 下查询已开启服务可用 net start。 笔记本无法开机启动解决方案 在笔记本执行上述操作可能仍无法开机启动 sshd 服务，这时可以利用任务计划曲线救国： 上述操作执行到 cygrunsrv -I xxx 为止，即完成创建系统服务 新建文件 reverse-tunnel.sh： reverse-tunnel.sh12#!/usr/bin/bashcygrunsrv -S autossh_12345 在任务计划中添加新任务，触发器设为「成功联网后」，示例。 注意 开始试验时经常出现重启后无法连接的情况，就上述例子而言，开机后打开日志 /var/log/autossh_12345.log 会显示： 1Error: remote port forwarding failed for listen port 12345 详情见 SSH remote port forwarding failed。经过几十次的重启，处理方案如下： 一旦计算机休眠或待机，服务将不可用，所以应关闭「自动待机」 autossh 服务中的启动需加上 -o ExitOnForwardFailure=yes 如果重启时间过短，而且重启之前没有关闭 autossh 服务，那么开机的时候很可能无法启动这个服务，虽具体原因不是很懂， 但猜测是远程那端在本地计算机重启的时候，二者之前建立的隧道是被占用状态。所以为根除此问题，关机前务必停止 autossh 服务，这里可以对关机、重启命令进行包装： 12alias poweroff='(shutdown -s -t 0 &amp;); (net stop autossh_xxxx &amp;);'alias reboot='(shutdown -r -t 0 &amp;); (net stop autossh_xxxx &amp;);' 而且该命令需要在管理员权限下执行，或者在远程执行 不要试图更改服务中的登录选项，仅本机账密才能行的通 可能需要设置失败后重启服务 参考 Configure sshd on MSYS2 and run it as a Windows service Autossh Windows Windows Task Scheduler: Trigger an Event When Internet Connects/Disconnects]]></content>
      <categories>
        <category>Development and Deployment</category>
      </categories>
      <tags>
        <tag>MSYS2</tag>
        <tag>Windows</tag>
        <tag>SSH</tag>
        <tag>Server</tag>
        <tag>Autossh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows 系统内置环境变量]]></title>
    <url>%2Fbuilt-in-environment-variables-on-windows%2F</url>
    <content type="text"><![CDATA[在 Windows 操作系统下工作，免不了用上几次 cmd，收集一些必要的系统内置环境变量。 Variable Volatile (Read-Only) Default value in Windows (system drive is C: ) ALLUSERSPROFILE C:\ProgramData APPDATA C:\Users\{username}\AppData\Roaming CD Y The current directory (string). ClientName Y Terminal servers only - the ComputerName of a remote host. CMDEXTVERSION Y The current Command Processor Extensions version number. (NT = “1”, Win2000+ = “2”.) CMDCMDLINE Y The original command line that invoked the Command Processor. CommonProgramFiles C:\Program Files\Common Files COMMONPROGRAMFILES(x86) C:\Program Files (x86)\Common Files COMPUTERNAME {computername} COMSPEC C:\Windows\System32\cmd.exe or if running a 32 bit WOW - C:\Windows\SysWOW64\cmd.exe DATE Y The current date using same region specific format as DATE. ERRORLEVEL Y The current ERRORLEVEL value, automatically set when a program exits. FPS_BROWSER_APP_PROFILE_STRING FPS_BROWSER_USER_PROFILE_STRING Internet Explorer Default These are undocumented variables for the Edge browser in Windows 10. HighestNumaNodeNumber Y (hidden) The highest NUMA node number on this computer. HOMEDRIVE Y C: HOMEPATH Y \Users\{username} LOCALAPPDATA C:\Users\{username}\AppData\Local LOGONSERVER \\{domain_logon_server} NUMBER_OF_PROCESSORS Y The Number of processors running on the machine. OS Y Operating system on the user’s workstation. PATH User and System C:\Windows\System32\;C:\Windows\;C:\Windows\System32\Wbem;{plus program paths} PATHEXT .COM; .EXE; .BAT; .CMD; .VBS; .VBE; .JS ; .WSF; .WSH; .MSC The syntax is like the PATH variable - semicolon separators. PROCESSOR_ARCHITECTURE Y AMD64/IA64/x86 This doesn’t tell you the architecture of the processor but only of the current process, so it returns “x86” for a 32 bit WOW process running on 64 bit Windows. See detecting OS 32/64 bit PROCESSOR_ARCHITEW6432 =%ProgramFiles% (only available on 64 bit systems) PROCESSOR_IDENTIFIER Y Processor ID of the user’s workstation. PROCESSOR_LEVEL Y Processor level of the user’s workstation. PROCESSOR_REVISION Y Processor version of the user’s workstation. ProgramW6432 =%PROCESSOR_ARCHITECTURE% (only available on 64 bit systems) ProgramData C:\ProgramData ProgramFiles C:\Program Files or C:\Program Files (x86) ProgramFiles(x86) C:\Program Files (x86) PROMPT Code for current command prompt format,usually $P$G C:&gt; PSModulePath %SystemRoot%\system32\WindowsPowerShell\v1.0\Modules\ Public C:\Users\Public RANDOM Y A random integer number, anything from 0 to 32,767 (inclusive). %SessionName% Terminal servers only - for a terminal server session, SessionName is a combination of the connection name, followed by #SessionNumber. For a console session, SessionName returns “Console”. SYSTEMDRIVE C: By default, Windows is installed to C:\Windows but there’s no guarantee of that, Windows can be installed to a different folder, or a different drive letter. systemroot is a read-only system variable that will resolve to the correct location. NT 4.0, Windows 2000 and Windows NT 3.1 default to C:\WINNT TEMP and TMP User Variable C:\Users\{Username}\AppData\Local\Temp Under XP this was \{username}\Local Settings\Temp TIME Y The current time using same format as TIME. UserDnsDomain Y User Variable Set if a user is a logged on to a domain and returns the fully qualified DNS domain that the currently logged on user’s account belongs to. USERDOMAIN {userdomain} USERDOMAIN_roamingprofile The user domain for RDS or standard roaming profile paths. Windows 8/10/2012 (or Windows 7/2008 with Q2664408) USERNAME {username} USERPROFILE %SystemDrive%\Users\{username} This is equivalent to the $HOME environment variable in Unix/Linux WINDIR %WinDir% pre-dates Windows NT and seems to be superseded by %SystemRoot% Set by default as windir=%SystemRoot% %windir% is a regular variable and can be changed, which makes it less robust than %systemroot%]]></content>
      <categories>
        <category>Memos</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[「转」Perl 语言学习书籍]]></title>
    <url>%2Freading-list-of-perl%2F</url>
    <content type="text"><![CDATA[作者: 衡杰Jay 链接: Perl语言学习书籍（持续整理） 来源: CSDN 博客 建议最佳阅读顺序：小骆驼 -&gt; 羊驼 -&gt; 大骆驼 -&gt; 小羊驼母亲和孩子 -&gt; 高效黑客 -&gt; 猎鹿犬 -&gt; 黑豹。 「小骆驼」 英：「Learning Perl」，Randal L.Schwartz，brian d foy，Tom Phoenix 著 中：「Perl语言入门」，盛春 译 简介：O’Reilly 出版社联合 3 位 Perl 社区极负盛名的人出品的 Perl 系列教程的第一本书，初学者入门首选书籍，主要介绍 Perl 基础语法，书中内容包括 Perl 程序员必须知道的，写单文件脚本程序所需要的，适合 Perl 大量应用的知识。 「大骆驼」 英：「Programming Perl」，Larry Wall，Tom Christiansen 等 著 中：「Perl语言编程」，何伟平 译 简介：这不仅仅是一本 Perl 书籍，更是一本独一无二的开发者自己介绍 Perl 语言及其文化的书籍。此书作者 Larry Wall 是Perl最初设计者， Tom Christiansen 是最早的几个拥护者之一，也是少数几个在错综复杂的中游刃有余的人之一。Jon Orwant 是「Perl Journal」的主编，该杂志把 Perl 社区组合成了一个共同的论坛，以进行 Perl 新的开发。 「草泥马」 英：「Intermediate Perl」，Randal L.Schwartz，Tom Phoenix，brian d foy 著 简介：O’Reilly 出版社联合 3 位 Perl 社区极负盛名的人出品的 Perl 系列教程的第二本书，主要介绍如何构造 Perl 复杂数据结构和对象的知识，以及如何组织团队工作（模块、测试和发布），编写可重用的 Perl 程序。 「小羊驼母亲和她的孩子」 英：「Mastering Perl」，brian d foy 著 中：「精通Perl」，韩殿飞 译 简介：O’Reilly 出版社联合 3 位 Perl 社区极负盛名的人出品的 Perl 系列教程的第三本书，该书综合运用了该系列前二本书中的知识， 给出了很多有趣的话题并围绕它们列举了大量例子，通过这些话题和例子教会你 Perl 编程的思维方式. 「美洲猎鹿犬」 英：「Perl Best Practices」，Damian Conway 著 中：「Perl最佳实践」，O’Reilly Taiwan公司 译 简介：该书为 Perl 编程人员提供了关于编程艺术的 256 条规则，这些规则能帮助你编写出更好的 Perl 代码。这些规则涵盖了代码布局和命名规则，数据和控制结构的选择，程序解构和模块化，接口的设计和实现，面向对象设计，错误处理，程序测试和调试。所有的规则都是为了写出清晰，健壮，高效， 可维护和简洁的程序而设计。 「高效黑客」 英：「Effective Perl Programming」，Joseph N.Hall，Joshua A.McAdams，brian d foy 著 中：「Perl高效编程」，盛春，王晖 等 译 简介：Perl 语言作为最成功的模块化编程语言，具有「软件芯片」的美誉，该书深入挖掘了 Perl 语言高效简洁的特点，为 Perl 爱好者提供了面向高效应用的指南。书中内容包括对各种测试提出的建议。 最新的正则表达式以及各种实用模块的习惯用法并逐一展现 120 个实用而精炼的案例。 「黑豹」 英：「Advanced Perl Programming」，Simon Cozens 著 中：「高级Perl编程」，Perlisb 译 简介：该书作为 O’Reilly 出版社 Perl 系列图书中的最高级教程，清晰地解释了许多 Perl 的概念，譬如内省、重载内建函数、基于面向对象模型的 Perl 扩展和如何对 Perl 程序的稳定性进行测试等诸多方面，此书汇集了 Perl 社区最优秀的成员辛苦积累的许多经验。]]></content>
      <categories>
        <category>Book List</category>
      </categories>
      <tags>
        <tag>Perl</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MSYS2 的日常操作]]></title>
    <url>%2Fdaily-operations-of-msys2%2F</url>
    <content type="text"><![CDATA[在自己的 Windows 10 系统上使用 MSYS2 已经有段时间了，Windows 上的类 *nix 工作环境简直不要太完美，办事效率杠杠的（如果没事少折腾的话）。为啥不用 Cygwin？因为很卡很慢，连 DUANG 的特效也拯救不了它，而且它的 POSIX 权限问题会把文件系统弄的一团糟。下面开始记录从刚开始的小白逐渐成为现在熟练使用的 大牛 大白的辛酸历程… MSYS2 安装与配置 这里主要参考 MSYS2开发环境搭建。 下载 MSYS2 installer，建议安装路径不要包含空格（个人装在了 D:\MSYS2 下） 安装完毕后，开始菜单中生成的三个快捷方式为： 123MSYS2 MinGW 32-bit - D:\MSYS2\msys2_shell.cmd -mingw32MSYS2 MinGW 64-bit - D:\MSYS2\msys2_shell.cmd -mingw64MSYS2 MSYS - D:\MSYS2\msys2_shell.cmd -msys 修改软件源，修改 /etc/pacman.d/ 目录下的三个文件，换上清华的 repo，.msys，.mingw32，.mingw64 分别对应 MSYS2 里的三套系统，分别在三个文件最上方填写（注意对应）： 123Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/msys/$archServer = https://mirrors.tuna.tsinghua.edu.cn/msys2/mingw/i686Server = https://mirrors.tuna.tsinghua.edu.cn/msys2/mingw/x86_64 任选一个（mingw32.exe，mingw64.exe，msys2.exe）进入 MSYS2 的终端，更新系统： 1pacman -Syu 提示需退出后更新, 强行关闭后重进, 再重复上述命令即可。 更新其他包: 1pacman -Su 安装开发工具链： 123456pacman -S base-develpacman -S gccpacman -S mingw-w64-x86_64-toolchainpacman -S mingw-w64-i686-toolchainpacman -S mingw64/mingw-w64-x86_64-clangpacman -S mingw32/mingw-w64-i686-clang 添加环境变量 PATH。由于个人 PATH 中存有 Perl 的开发工具路径，所以考虑将 MSYS2 的路径置于其后： 1234567...\Strawberry\perl\bin\Strawberry\perl\site\bin\MSYS2\usr\bin\MSYS2\mingw64\bin\Strawberry\c\bin... 个性化设置 自动挂载文件 /etc/fstab1234567# For a description of the file format, see the Users Guide# http://cygwin.com/cygwin-ug-net/using.html#mount-table# DO NOT REMOVE NEXT LINE. It remove cygdrive prefix from pathnone / cygdrive binary,posix=0,noacl,user 0 0C:\Users\xxx\Desktop /desktopD:\MSYS2\home\xxx\Notes /notesF:\WorkingDirectory\Work\__current /current 配置文件 于个人 home 目录中，个性化各种配置： 比如与 mintty 相关的配置： .minttyrc .minttyrc12345678910111213141516171819202122BoldAsFont=noBoldAsColour=yesBoldColour=255,255,128Font=SauceCodePro NFFontIsBold=noFontHeight=10RowSpacing=1ShowHiddenFonts=yesCursorColour=255,255,0Transparency=highLocale=en_USCharset=UTF-8BellType=0CursorType=blockCursorBlinks=noTerm=xtermColumns=135Rows=35CtrlShiftShortcuts=noScrollbar=noneClicksTargetApp=yesForegroundColour=223,223,223 比如常用的 .bashrc： .bashrc .bashrc123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245# To the extent possible under law, the author(s) have dedicated all# copyright and related and neighboring rights to this software to the# public domain worldwide. This software is distributed without any warranty.# You should have received a copy of the CC0 Public Domain Dedication along# with this software.# If not, see &lt;http://creativecommons.org/publicdomain/zero/1.0/&gt;.# ~/.bashrc: executed by bash(1) for interactive shells.# The copy in your home directory (~/.bashrc) is yours, please# feel free to customise it to create a shell# environment to your liking. If you feel a change# would be benifitial to all, please feel free to send# a patch to the msys2 mailing list.# User dependent .bashrc file# If not running interactively, don't do anything[[ "$-" != *i* ]] &amp;&amp; return# Shell Options## See man bash for more options...## Don't wait for job termination notification# set -o notify## Don't use ^D to exit# set -o ignoreeof## Use case-insensitive filename globbing# shopt -s nocaseglob## Make bash append rather than overwrite the history on disk# shopt -s histappend## When changing directory small typos can be ignored by bash# for example, cd /vr/lgo/apaache would find /var/log/apache# shopt -s cdspell# Completion options## These completion tuning parameters change the default behavior of bash_completion:## Define to access remotely checked-out files over passwordless ssh for CVS# COMP_CVS_REMOTE=1## Define to avoid stripping description in --option=description of './configure --help'# COMP_CONFIGURE_HINTS=1## Define to avoid flattening internal contents of tar files# COMP_TAR_INTERNAL_PATHS=1## Uncomment to turn on programmable completion enhancements.# Any completions you add in ~/.bash_completion are sourced last.# [[ -f /etc/bash_completion ]] &amp;&amp; . /etc/bash_completion# History Options## Don't put duplicate lines in the history.# export HISTCONTROL=$HISTCONTROL$&#123;HISTCONTROL+,&#125;ignoredups## Ignore some controlling instructions# HISTIGNORE is a colon-delimited list of patterns which should be excluded.# The '&amp;' is a special pattern which suppresses duplicate entries.# export HISTIGNORE=$'[ \t]*:&amp;:[fb]g:exit'# export HISTIGNORE=$'[ \t]*:&amp;:[fb]g:exit:ls' # Ignore the ls command as well## Whenever displaying the prompt, write the previous line to disk# export PROMPT_COMMAND="history -a"# Aliases## Some people use a different file for aliases# if [ -f "$&#123;HOME&#125;/.bash_aliases" ]; then# source "$&#123;HOME&#125;/.bash_aliases"# fi## Some example alias instructions# If these are enabled they will be used instead of any instructions# they may mask. For example, alias rm='rm -i' will mask the rm# application. To override the alias instruction use a \ before, ie# \rm will call the real rm not the alias.## Interactive operation...# alias rm='rm -i'# alias cp='cp -i'# alias mv='mv -i'## Default to human readable figuresalias df='df -h'alias du='du -h'## Misc :)alias less='less -r' # raw control charactersalias whence='type -a' # where, of a sortalias grep='grep --color' # show differences in colouralias egrep='egrep --color=auto' # show differences in colouralias fgrep='fgrep --color=auto' # show differences in colour## Some shortcuts for different directory listingsalias ls='ls -hF --color=tty' # classify files in colouralias dir='ls --color=auto --format=vertical'alias vdir='ls --color=auto --format=long'alias ll='ls -l' # long listalias la='ls -A' # all but . and ..alias l='ls -CF' #alias hexopull='cd ~/Hexo &amp;&amp; git fetch --all &amp;&amp; git reset --hard origin/master &amp;&amp; git pull'alias hexopush='cd ~/Hexo &amp;&amp; hexo clean &amp;&amp; hexo g -d &amp;&amp; git add -A &amp;&amp; git commit -m "update" &amp;&amp; git push origin master'alias algpull='cd ~/alg &amp;&amp; git fetch --all &amp;&amp; git reset --hard origin/master &amp;&amp; git pull'alias algpush='cd ~/alg &amp;&amp; hexo clean &amp;&amp; hexo g -d &amp;&amp; git add -A &amp;&amp; git commit -m "update" &amp;&amp; git push origin master'alias hexodebug='hexo clean &amp;&amp; hexo g &amp;&amp; hexo s --debug'# Umask## /etc/profile sets 022, removing write perms to group + others.# Set a more restrictive umask: i.e. no exec perms for others:# umask 027# Paranoid: neither group nor others have any perms:# umask 077# Functions## Some people use a different file for functions# if [ -f "$&#123;HOME&#125;/.bash_functions" ]; then# source "$&#123;HOME&#125;/.bash_functions"# fi## Some example functions:## a) function settitle# settitle ()# &#123;# echo -ne "\e]2;$@\a\e]1;$@\a";# &#125;## b) function cd_func# This function defines a 'cd' replacement function capable of keeping,# displaying and accessing history of visited directories, up to 10 entries.# To use it, uncomment it, source this file and try 'cd --'.# acd_func 1.0.5, 10-nov-2004# Petar Marinov, http:/geocities.com/h2428, this is public domain# cd_func ()# &#123;# local x2 the_new_dir adir index# local -i cnt## if [[ $1 == "--" ]]; then# dirs -v# return 0# fi## the_new_dir=$1# [[ -z $1 ]] &amp;&amp; the_new_dir=$HOME## if [[ $&#123;the_new_dir:0:1&#125; == '-' ]]; then# ## # Extract dir N from dirs# index=$&#123;the_new_dir:1&#125;# [[ -z $index ]] &amp;&amp; index=1# adir=$(dirs +$index)# [[ -z $adir ]] &amp;&amp; return 1# the_new_dir=$adir# fi## ## # '~' has to be substituted by $&#123;HOME&#125;# [[ $&#123;the_new_dir:0:1&#125; == '~' ]] &amp;&amp; the_new_dir="$&#123;HOME&#125;$&#123;the_new_dir:1&#125;"## ## # Now change to the new dir and add to the top of the stack# pushd "$&#123;the_new_dir&#125;" &gt; /dev/null# [[ $? -ne 0 ]] &amp;&amp; return 1# the_new_dir=$(pwd)## ## # Trim down everything beyond 11th entry# popd -n +11 2&gt;/dev/null 1&gt;/dev/null## ## # Remove any other occurence of this dir, skipping the top of the stack# for ((cnt=1; cnt &lt;= 10; cnt++)); do# x2=$(dirs +$&#123;cnt&#125; 2&gt;/dev/null)# [[ $? -ne 0 ]] &amp;&amp; return 0# [[ $&#123;x2:0:1&#125; == '~' ]] &amp;&amp; x2="$&#123;HOME&#125;$&#123;x2:1&#125;"# if [[ "$&#123;x2&#125;" == "$&#123;the_new_dir&#125;" ]]; then# popd -n +$cnt 2&gt;/dev/null 1&gt;/dev/null# cnt=cnt-1# fi# done## return 0# &#125;## alias cd=cd_funcalias grep='grep --color=auto --exclude-dir=&#123;.bzr,CVS,.git,.hg,.svn&#125;'alias e=exploreralias giturl='curl -i https://git.io -F'alias poweroff='(shutdown -s -t 0 &amp;); (net stop autossh_5679 &amp;);'alias reboot='(shutdown -r -t 0 &amp;); (net stop autossh_5679 &amp;);'# alias uptime='net stats server | grep -P -o "[\d/]+.*M$" --color=never'alias lcd='/e/UtilityPrograms/_exe/TurnOffLCD.exe'# alias pb='~/App/pastebinit/pastebinit -b http://paste.ubuntu.com'# alias pb='~/App/pastebinit/pastebinit -b http://paste.ubuntu.org.cn'alias wolfram='winpty /e/Mathematica/11.1/wolfram'alias loginpc='cygrunsrv -S autossh_5679'alias viz='vim `which z`'alias memopull='cd ~/memos &amp;&amp; git fetch --all &amp;&amp; git reset --hard origin/master &amp;&amp; git pull'alias memopush='cd ~/memos &amp;&amp; hexo clean &amp;&amp; hexo g -d &amp;&amp; git add -A &amp;&amp; git commit -m "update" &amp;&amp; git push origin master'HISTTIMEFORMAT='%F %T 'HISTCONTROL=erasedupsHISTIGNORE="ls:pwd:cd:clear:vim:fg:bg:jobs:top:htop"export LESS_TERMCAP_mb=$(printf '\e[01;31m') # enter blinking mode - redexport LESS_TERMCAP_md=$(printf '\e[01;35m') # enter double-bright mode - bold, magentaexport LESS_TERMCAP_me=$(printf '\e[0m') # turn off all appearance modes (mb, md, so, us)export LESS_TERMCAP_se=$(printf '\e[0m') # leave standout modeexport LESS_TERMCAP_so=$(printf '\e[01;33m') # enter standout mode - yellowexport LESS_TERMCAP_ue=$(printf '\e[0m') # leave underline modeexport LESS_TERMCAP_us=$(printf '\e[04;36m') # enter underline mode - cyan# export http_proxy="http://192.168.1.102:1888/"# export https_proxy="https://192.168.1.102:1888/"# export ftp_proxy="ftp://192.168.1.102:1888/"# export PS1="[\[\e[01;33m\]foo\[\e[37;40m\]@\[\e[34;40m\]PHANTOM \[\e[37;40m\]\t \[\e[34;40m\]\W\[\e[0m\]]$ "export PS1="[ \[\e[37;40m\]\t \[\e[34;40m\]\W\[\e[0m\] ]$ "export GTAGSLIBPATH=$GTAGSLIBPATH:/usr/include/export HISTFILESIZE=50000export HISTSIZE=50000export PATH=$PATH:~/App/binexport PATH=$PATH:/e/Nodejsexport PATH=$PATH:/c/Users/Liang/AppData/Roaming/npmexport PATH=$PATH:/e/MySQL/binexport PATH=$PATH:/d/Java/jdk-10/binexport PATH=$PATH:/f/WorkingDirectory/Binexport PATH=$PATH:/e/TexLive/2018/bin/win32export PATH=$PATH:/e/R/bin/x64export PATH=$PATH:/f/WorkingDirectory/Binexport PATH=$PATH:/c/Users/Liang/AppData/Roaming/local/bin# STACK_ROOT=/f/HaskellStack 比如 Git 需要代理: .gitconfig .gitconfig1234567[user] name = michaelHL email = lbgnmic@gmail.com[github] user = michaelHL[http] proxy = socks5://127.0.0.1:1888 比如忽略大小写的 .inputrc： .inputrc .inputrc123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114# To the extent possible under law, the author(s) have dedicated all # copyright and related and neighboring rights to this software to the # public domain worldwide. This software is distributed without any warranty. # You should have received a copy of the CC0 Public Domain Dedication along # with this software. # If not, see &lt;http://creativecommons.org/publicdomain/zero/1.0/&gt;. # ~/.inputrc: readline initialization file.# The copy in your home directory (~/.inputrc) is yours, please# feel free to customise it to create a shell# environment to your liking. If you feel a change# would be benifitial to all, please feel free to send# a patch to the msys2 mailing list.# the following line is actually# equivalent to "\C-?": delete-char# "\e[3~": delete-char# VT# "\e[1~": beginning-of-line# "\e[4~": end-of-line# kvt# "\e[H": beginning-of-line# "\e[F": end-of-line# rxvt and konsole (i.e. the KDE-app...)# "\e[7~": beginning-of-line# "\e[8~": end-of-line# VT220# "\eOH": beginning-of-line# "\eOF": end-of-line# Allow 8-bit input/output# set meta-flag on# set convert-meta off# set input-meta on# set output-meta on#$if Bash # Don't ring bell on completion set bell-style none # or, don't beep at me - show me #set bell-style visible # Show all instead of beeping first set show-all-if-ambiguous off # Filename completion/expansion set completion-ignore-case on #set show-all-if-ambiguous on # Expand homedir name #set expand-tilde on # Append "/" to all dirnames #set mark-directories on #set mark-symlinked-directories on # visible-stats # Append a mark according to the file type in a listing set visible-stats off set mark-directories on # Match all files #set match-hidden-files on # 'Magic Space' # Insert a space character then performs # a history expansion in the line #Space: magic-space#$endif# MSYSTEM is emacs based$if mode=emacs # Common to Console &amp; RXVT "\C-?": backward-kill-line # Ctrl-BackSpace "\e[2~": paste-from-clipboard # "Ins. Key" "\e[5~": beginning-of-history # Page up "\e[6~": end-of-history # Page down $if term=msys # RXVT "\e[7~": beginning-of-line # Home Key "\e[8~": end-of-line # End Key "\e[11~": display-shell-version # F1 "\e[15~": re-read-init-file # F5 "\e[12~": "Function Key 2" "\e[13~": "Function Key 3" "\e[14~": "Function Key 4" "\e[17~": "Function Key 6" "\e[18~": "Function Key 7" "\e[19~": "Function Key 8" "\e[20~": "Function Key 9" "\e[21~": "Function Key 10" $else # Eh, normal Console is not really cygwin anymore, is it? Using 'else' instead. -mstormo # $if term=cygwin # Console "\e[1~": beginning-of-line # Home Key "\e[4~": end-of-line # End Key "\e[3~": delete-char # Delete Key "\e\e[C": forward-word # Alt-Right "\e\e[D": backward-word # Alt-Left "\e[1;5C": forward-word # ctrl + right "\e[1;5D": backward-word # ctrl + left "\e[17~": "Function Key 6" "\e[18~": "Function Key 7" "\e[19~": "Function Key 8" "\e[20~": "Function Key 9" "\e[21~": "Function Key 10" "\e[23~": "Function Key 11" $endif$endif 比如 Vim 配置文件 .vimrc 编译 Vim 1234567891011121314pacman -S ncurses-devel libcrypt-devel./configure --with-features=huge \ --enable-luainterp=yes \ --enable-perlinterp=yes \ --enable-pythoninterp=yes \ --enable-python3interp=yes \ --with-lua-prefix=/usr/local \ --enable-fontset=yes \ --enable-cscope=yes \ --enable-multibyte \ --disable-gui \ --enable-fail-if-missing \ --prefix=/usr/local \ --with-compiledby='Professional operations' 这里提醒自己下，折腾有度，比如尝试在 MSYS2 中编译 ycm 十几次未遂这种行为是不可取的。 替换默认终端 将自带的 Mintty 换成 Windows 下很棒的终端模拟器：ConEmu。 设置为默认的系统终端程序，替换掉残废的 cmd：Settings - Integration - Default term - Force ConEmu as default terminal for console applications 如果希望「劫持」某些程序调试时使用的终端程序（比如 VS 在调试时会唤起系统默认的 cmd），在下面的输入框中填入 explorer.exe|devenv.exe 对于 MSYS2 的集成： 新建 Task：set MSYSTEM=MINGW64 &amp; "/path/to/MSYS-connector -cur_console:n" Connector 网址：cygwin-connector，不同版本的设置如下： Cygwin：conemu-cyg-32.exe and conemu-cyg-64.exe MSYS 1.0：conemu-msys-32.exe MSYS 2.0：conemu-msys2-32.exe and conemu-msys2-64.exe 复制到 sh.exe 同目录下即可 启动时的相关设定（Settings - Startup - Environment）： 123set PATH=%ConEmuBaseDir%\Scripts;%PATH%chcp utf-8set LANG=en_US.utf-8 当前的配置文件 conemu.xml 新版本的 ConEmu 已经自带了适配各种系统下的 connector，所以在 Task 里面关于 connector 的路径直接填写其程序名即可。（见 cygwin/msys terminal connector） 题外话 - Sublime Text 调用 ConEmu 对于一般程序，在设置中的 Integration - Default term - List of ... 中添加程序，ConEmu 将被自动唤起以替代 cmd，但添加 Sublime Text 的 sublime_text.exe 并没有反应，只能曲线救国，比如 C 类型文件的编译配置文件 C.sublime-build： C.sublime-build1234567&#123; // "shell_cmd": "gcc -std=c11 -Wall -s \"$&#123;file&#125;\" -o \"$&#123;file_path&#125;/$&#123;file_base_name&#125;\" &amp;&amp; \"$&#123;file_path&#125;/$&#123;file_base_name&#125;\"", "shell_cmd": "/path/to/conemu /single -run cmd /c -cur_console:n \"gcc -std=c11 -Wall -s $&#123;file&#125; -o $&#123;file_path&#125;/$&#123;file_base_name&#125; &amp;&amp; $&#123;file_path&#125;/$&#123;file_base_name&#125; &amp; pause \"", "file_regex": "^(..[^:]*):([0-9]+):?([0-9]+)?:? (.*)$", "working_dir": "$&#123;file_path&#125;", "selector": "source.c"&#125; 问题 如果发现程序的输出被缓冲：可尝试利用工具 winpty git clone 时出现字符相关的奇怪问题：使用 MSYS 而不是 MinGW64 或者 MinGW32 2018-02-09 ncurses 版本升级为 ncurses-6.1.20180127-1-x86_64 后 ConEmu 终端会出现各种光标问题，可通过回退版本至 ncurses-6.0.20170708-2-x86_64 来解决： 12pacman -R ncurses-develpacman -U ncurses-6.0.20170708-2-x86_64.pkg.tar.xz --force 2018-02-10 如果集成在 VSCode 中的 MSYS2 也出现上述情况, 可考虑直接使用 connector： settings.json123&#123; "terminal.integrated.shell.windows": "E:/UtilityPrograms/ConEmu/ConEmu/conemu-msys2-64.exe",&#125; 或者如果仅需为清屏设置快捷键： keybindings.json12345&#123; "key": "ctrl+l", "command": "workbench.action.terminal.clear", "when": "terminalFocus"&#125;]]></content>
      <categories>
        <category>Handy Utilities</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>MSYS2</tag>
        <tag>Windows</tag>
        <tag>ConEmu</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ssh / autossh / Xshell 端口转发及内网穿透]]></title>
    <url>%2Fssh-reverse-tunnel%2F</url>
    <content type="text"><![CDATA[没有公网 IP？内网服务器成笼中凤凰？果断穿透一波！手头上有三台机器，记号如下： 记号 位置 地址 账户 A 位于公网 a.site usera B 位于 NAT 之后 localhost userb C 位于 NAT 之后 localhost userc autossh 实现内网穿透 首先介绍比较稳定的 autossh。 操作 在机器 A 上： 设置 sshd 设置文件 /etc/ssh/sshd_config：GatewayPorts yes sudo systemctl restart sshd 在机器 B 上： 创建 SSH 密钥，上传至 A： 12ssh-keygen -t 'rsa'ssh-copy-id usera@a.site 如果仅作测试，直接键入命令 1autossh -M 6777 -NR 6766:localhost:22 usera@a.site -i /path/to/id_rsa 即可，但该命令会在前端等待。如果需要不间断运行地置于后台， 可使用 nohup 命令： 1nohup autossh -M 6777 -NR 6766:localhost:22 usera@a.site -i /path/to/id_rsa &gt;/dev/null 2&gt;&amp;1 &amp; 注 其中的 -M xxxx 表示守护进程，也就是如果监测到 6766 端口的进程挂掉之后，又会重新开启 autossh （所以可能导致 kill 不完进程），如果改为 -M 0 则表示没有守护进程。 如果希望作为系统服务并开机启动，需进行如下操作： 编辑文件 /etc/systemd/system/autossh.service， autossh.service12345678910[Unit]Description=autossh sshAfter=network-online.target[Service]Environment="AUTOSSH_GATETIME=0"ExecStart=/usr/bin/autossh -M 0 -o "ExitOnForwardFailure=yes" -o "ServerAliveInterval 30" -o "ServerAliveCountMax 3" -NR 6766:localhost:22 usera@a.site -i /path/to/id_rsa[Install]WantedBy=multi-user.target 一通令之生效的操作： 1234sudo systemctl daemon-reloadsudo systemctl enable autosshsudo systemctl start autosshsudo systemctl status autossh 注 *.service 文件中需要写绝对路径 systemctl enable 表示设置服务为自动启动 开耍 A 连 B：ssh -p 6766 userb@localhost C 连 B：ssh -p 6766 userb@a.site 反向连接时指定动态端口转发（机器 C）：ssh -p 6766 -qngfNTD 7677 userb@a.site 问题 报错： 1/usr/bin/ssh-copy-id: ERROR: failed to open ID file '/home/ismail/.pub': No such file 解决方案：不带参数地生成秘钥 ssh-keygen 防止超时断开： 在 B 和 C 的/etc/ssh/ssh_config后面加上: ServerAliveInterval 60 在 A 机的/etc/ssh/sshd_config后面加上： ClientAliveInterval 60 少数情况下，问题会出在 ssh 的认证上，可能需要下列操作： 修改文件 /etc/ssh/ssh_config: 123GSSAPIAuthentication noGSSAPIDelegateCredentials noStrictHostKeyChecking no 棘手问题 ssh_exchange_identification: read: Connection reset by peer 解决方案： 删除已有 autossh 连接，重启服务 若问题仍在，尝试在机器 A 上新开 SSH 端口，方法有两种： 在 /etc/ssh/sshd_config 中添加 Port xxxxx；或 sudo `which sshd` -ddd -p xxxxx。修改机器 B 中相关的服务参数并且重启服务 ssh 端口转发 除了利用 autossh 作为反向代理工具，强大的 ssh 自身就可以实现正向代理以及反向代理。下面摘自 SSH隧道与端口转发内网穿透. -L port:host:hostport：将本地机（客户机）的某个端口转发到远端指定机器的指定端口。 本地机器上分配了一个 socket 侦听 port 端口，一旦这个端口上有了连接，该连接就经过安全通道转发出去， 同时远程主机和 host 的 hostport 端口建立连接。可以在配置文件中指定端口的转发。只有 root 才能转发特权端口。IPv6 地址用另一种格式说明：port/host/hostport -R port:host:hostport：将远程主机（服务器）的某个端口转发到本地端指定机器的指定端口。 远程主机上分配了一个 socket 侦听 port 端口， 一旦这个端口上有了连接，该连接就经过安全通道转向出去，同时本地主机和 host 的 hostport 端口建立连接。可以在配置文件中指定端口的转发。只有用 root 登录远程主机才能转发特权端口。IPv6 地址用另一种格式说明：port/host/hostport -D port：指定一个本地机器「动态的」应用程序端口转发。 本地机器上分配了一个 socket 侦听 port 端口，一旦这个端口上有了连接，该连接就经过安全通道转发出去， 根据应用程序的协议可以判断出远程主机将和哪里连接。目前支持 SOCKS4 协议，将充当 SOCKS4 服务器。 只有 root 才能转发特权端口。可以在配置文件中指定动态端口的转发 -p：指定登录端口 -f：后台认证用户 / 密码，通常和 -N 连用，不用登录到远程主机 -N：不执行远程命令 -q：进入安静模式 -C：压缩数据传输 -g：在 -L/-R/-D 参数中，允许远程主机连接到建立的转发的端口，如果不加这个参数，只允许本地主机建立连接 常用的 SSH 隧道操作： 正向代理：ssh -C -f -N -L listen_port:DST_Host:DST_port user@Tunnel_Host 反向代理：ssh -C -f -N -R listen_port:DST_Host:DST_port user@Tunnel_Host 动态转发：ssh -C -f -N -D listen_port user@Tunnel_Host 为保持长时间连接，同 autossh 的参数，ssh 可附加的参数有： -o TCPKeepAlive=yes，-o ServerAliveInterval=30, -o ServerAliveCountMax=3 等。 Xshell 隧道转发 设想这样一个场景：本地机器 C 已经可以通过具有公网 IP 的 A 连接到服务器 B 的 SSH 服务，也就是说存在这样的一条隧道：C - A(10001) - B(22)。而在服务器 B 上运行着其它程序（比如网站），端口号为 5000，如果希望在本地 C 上直接访问到 B 的网站，自然下面这种思路：「建立从 B(5000) - A(&lt;web-port&gt;) 的隧道，C 通过 http://A:&lt;web-port&gt; 进行访问」。如此一来，又需要做一个「穿透」，把 B 的 5000 端口反向代理出去。但能否存在一种方式，在不额外给 A 增加服务端口的情况下，令 C 直接访问到 B 呢？ 客户端软件 Xshell 的隧道转发功能正好派上用场。Xshell 的设置中自带端口转发技能（或称「隧道」，听起来比较 装逼 高大上）：Sessions - Properties - Connection - SSH - Tunneling。上述情形，仅需在连接 C - A(10001) - B(22) 中添加正向代理： 12345Type : Local(Outgoing)Source Host : localhostListening Port : &lt;web-port&gt;Destination Host : localhostDestination Port : 5000 保存会话属性并连接后，会在本地开启 &lt;web-port&gt; 端口，在本地机器 C 中浏览 http://localhost:&lt;web-port&gt; 即可访问到 B 中运行的网站了。 参考 AutoSSH reverse tunnel service config for systemd 使用SSH反向隧道进行内网穿透 SSH端口转发：实现反向SSH隧道内网穿透]]></content>
      <categories>
        <category>Operation and Maintenance</category>
      </categories>
      <tags>
        <tag>SSH</tag>
        <tag>Server</tag>
        <tag>Autossh</tag>
        <tag>Xshell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[交互 Shells 和登录 Shells]]></title>
    <url>%2Finteractive-and-login-shells%2F</url>
    <content type="text"><![CDATA[提出疑问 摘自 Interactive and Login Shells: It doesn't seem like it's possible for there to be a login shell but not interactive. Cron shell scripts are always non-login and non-interactive. SSH shells are always login and interactive. Subshells are always interactive but not login. Shell scripts are always non-login and non-interactive. Initial TTY shell should be login and interactive. Swtching users inside Linux involves creating subshells, can you elect to switch without logging in, or switch while simulate the logging in process. Note that logging in doesn’t necessarily mean you need to enter passwords, nor that any password to be entered is possessed by the user you’re logging into. Since .bashrc is read on interactive but not login, and .bash_profile is read on all login shells. People source the .bashrc in the .bash_profile, allowing you to set general configuration (that applies to all interactive shells) inside .bashrc but login specific configuration in .bash_profile. 略加思索 下面为具体的解释, 以及不同情况下启动脚本的加载顺序. (来自 login/non-login and interactive/non-interactive shells) login shell: A login shell logs you into the system as a spiecified user, necessary for this is a username and password. When you hit ctrl+alt+F1 to login into a virtual terminal you get after successful login: a login shell (that is interactive). Sourced files: /etc/profile and ~/.profile for Bourne compatible shells (and /etc/profile.d/*) ~/.bash_profile for bash /etc/zprofile and ~/.zprofile for zsh /etc/csh.login and ~/.login for csh non-login shell: A shell that is executed without logging in, necessary for this is a current logged in user. When you open a graphic terminal in gnome it is a non-login (interactive) shell. Sourced files: /etc/bashrc and ~/.bashrc for bash interactive shell: A shell (login or non-login) where you can interactively type or interrupt commands. For example a gnome terminal (non-login) or a virtual terminal (login). In an interactive shell the prompt variable must be set ($PS1). Sourced files: /etc/profile and ~/.profile /etc/bashrc or /etc/bash.bashrc for bash non-interactive shell: A (sub)shell that is probably run from an automated process you will see neither input nor outputm when the calling process don’t handle it. That shell is normally a non-login shell, because the calling user has logged in already. A shell running a script is always a non-interactive shell, but the script can emulate an interactive shell by prompting the user to input values. Sourced files: /etc/bashrc or /etc/bash.bashrc for bash (but, mostly you see this at the beginning of the script: [ -z "$PS1" ] &amp;&amp; return. That means don’t do anything if it’s a non-interactive shell) depending on shell; some of them read the file in the $ENV variable 识破 那么如何判断当前 shell 为 interactive 或 login shell 呢? bash (参考 How to check if a shell is login/interactive/batch) 12[[ $- == *i* ]] &amp;&amp; echo 'interactive' || echo 'NOT interactive'shopt -q login_shell &amp;&amp; echo 'login shell' || echo 'NOT login shell' zsh (参考 Interactive and Login Shells) 12[[ -o interactive ]] &amp;&amp; echo "interactive" || echo "NOT interactive"[[ -o login ]] &amp;&amp; echo "login shell" || echo "NOT login shell"]]></content>
      <categories>
        <category>Operation and Maintenance</category>
      </categories>
      <tags>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mobaxterm 折腾笔记]]></title>
    <url>%2Fconfiguration-of-cygwin-in-mobaxterm-and-issues-of-ssh-proxy%2F</url>
    <content type="text"><![CDATA[虽然已经不用 Mobaxterm 作为日常工具了，但为缅怀以前折腾的那段时光，特此归档。 札记 建议使用 10.0 版本的 Mobaxterm（下简称 Moba），10.2 版本的有少许问题，比如用 apt-get 或者 apt-cyg 不能用 Ctrl-C 停止，不能使用 gist-vim 插件，git clone 也出现各种不能名状的问题 配置 Persistent home directory 以及 Persistent root (/) directory，个人的路径为 F:\WorkingDirectory\Cygwin\home，F:\WorkingDirectory\Cygwin。关闭 Moba，修改 /etc/fstab 文件，加上行： 1none /cygdrive cygdrive text,posix=0,noacl,user 0 并设置文件为只读. 关闭所谓的 POSIX 权限，否则导致由 Cygwin 生成的文件权限紊乱 设置环境变量，在 ~/.bashrc 中写上 1export PATH=/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/bin:/cygdrive/c/windows:/cygdrive/c/windows/system32 安装各种软件包，注意每次需通过 -m 来设置源（或者通过脚本或 alias 简化操作）。可用的 repo 有： http://mirrors.neusoft.edu.cn/cygwin/ http://mirrors.ustc.edu.cn/cygwin/ http://mirrors.aliyun.com/cygwin/ http://mirrors.163.com/cygwin/ 比如这种操作： 1apt-cyg -m http://mirrors.aliyun.com/cygwin/ install vim 有时即便指定了 repo，但无法下载包，可能提示找不到文件，但仔细浏览 repo 里面相应的软件包版本，发现版本号不正确，手动下载 setup.ini（或者下载 setup.xz 进行解压）覆盖掉 /home/.aptcyg/&lt;http%3a%2f%2fmirrors.foo&gt; 下的 setup.ini 即可。 有时无法直接通过 apt-cyg install &lt;pkg&gt; 来更新包，只好先 remove 再 install。 建议安装的包： busybox coreutils curl libopenssl100 git wget vim gcc-core gcc-g++ gcc-mingw-core gcc-mingw-g++ make 问题 SSH 代理问题 让 Cygwin 中的 git 通过 shadowsocks 代理。（假设代理端口为 1888） 主要参考：如何为 Git 设置代理？ 建立 socksssh，wrapper 文件（假设在 ~/.ssh 目录下建立） sockssh12#!/bin/shssh -o ProxyCommand="/home/.ssh/wrapper %h %p" "$@" wrapper12#!/bin/shconnect -S 127.0.0.1:1888 "$@" 配置 Git：在 ~/.gitconfig 文件中添加 / 修改内容： 123456[http] proxy = socks5://127.0.0.1:1888[https] proxy = socks5://127.0.0.1:1888[core] gitproxy = /home/.ssh/wrapper 编译或拷贝 connect。 项目地址：https://bitbucket.org/gotoh/connect 下载： https://bitbucket.org/gotoh/connect/downloads/ 或直接： release 将 connect.exe 复制到 /usr/local/bin 目录下（确保该路径在 $PATH 中） 在 ~/.bashrc 中加入 1export GIT_SSH=/home/.ssh/socksssh 重进 Moba. 上面的 wrapper 文件中 -S 表示以 socks 方式进行代理，也可以改成 -H (http)，不过可能要相应更改 ~/.gitconfig 中的 proxy。 git clone 出现 X11 forwarding request failed on channel 0 关系不大，倒是恼人。将文件 /etc/ssh_config 中 ForwardX11 yes 改为 ForwardX11 no 即可。]]></content>
      <categories>
        <category>Handy Utilities</category>
      </categories>
      <tags>
        <tag>Mobaxterm</tag>
        <tag>SSH</tag>
        <tag>Cygwin</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS 下编译 Python]]></title>
    <url>%2Fcompile-python-on-centos%2F</url>
    <content type="text"><![CDATA[CentOS 7.3 自带的 Python 版本只有 2.7.5，很多新鲜的包都不能正常使用，一怒之下尝试更新其至目前最新的 2.7.13 版本，顺便编译最新的 Python 3.6.2。当然系统自带的 Python 2.7.5 是不能删除的，会导致很多依赖它的工具无法正常工作，所以将新版本的 Python 安装至 /usr/local/ 下。 首先安装一些依赖，比如 1yum install openssl-devel 比如 SQLite: 1234wget http://www.sqlite.org/snapshot/sqlite-snapshot-201708251543.tar.gztar zxf sqlite-snapshot-201708251543.tar.gzcd sqlite-snapshot-201708251543./configure --prefix=/usr/local 下面开始 Python 的编译工作： 12345wget https://www.python.org/ftp/python/2.7.13/Python-2.7.13.tgztar zxf Python-2.7.13.tgzcd Python-2.7.13./configure --prefix=/usr/localmake &amp;&amp; make install Python 3 的编译安装同理，将网址改为 https://www.python.org/ftp/python/3.6.2/Python-3.6.2.tgz 即可。 这时会发现 yum 不能用了，需要将 /usr/bin/yum，/usr/libexec/urlgrabber-ext-down 的 shebang 改为 /usr/bin/python2.7，也就是原来的低版本 (2.7.5)。]]></content>
      <categories>
        <category>Operation and Maintenance</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux 技巧拾零]]></title>
    <url>%2Ftips-on-linux%2F</url>
    <content type="text"><![CDATA[记录 Linux 下遇到的问题、技巧与备忘。 令 Tab 补全对忽略大小写 所有用户：/etc/inputrc 当前用户：~/.inputrc 输入内容：set completion-ignore-case on history 不显示连续、重复、特定的命令、加上时间戳 于 /etc/bashrc（或 ~/.bashrc）中添加 123HISTTIMEFORMAT='%F %T 'HISTCONTROL=erasedupsHISTIGNORE="ls:pwd:cd:clear:vim:fg:bg:jobs:top" 将 HISTCONTROL 设成 ignoredups 仅忽略连续的重复命令，而 erasedups 清除整个历史中重复条目 常用终端快捷键 快捷键 用途 快捷键 用途 Ctrl-A 移动到行首 Esc-F 移动到后面一个单词 Ctrl-E 移动到行末 Ctrl-K 删除到行末 Ctrl-B 移动到前面一个字母 Ctrl-U 删除到行首 Ctrl-F 移动到后面一个字母 Ctrl-T 交换光标位置前两个字符 Esc-B 移动到前面一个单词 Esc-T 交换光标位置前两个单词 SSH 登录服务器缓慢解决方案： 关闭 DNS 反向解析：vim /etc/ssh/sshd_config，设定其中 UseDNS=no，重启服务 service sshd restart 服务端禁用 GSSAPIAuthentication：同样在 /etc/ssh/sshd_config 中设定 GSSAPIAuthentication no SSH 登录欢迎界面设置文件：/etc/motd SSH Log 日志文件： Redhat，Fedora Core: /var/log/secure Mandrake，FreeBSD，OpenBSD，Debian: /var/log/auth.log SUSE: /var/log/messages 系统内建函数 time 功能有限 （real 时间是指挂钟时间，也就是命令开始执行到结束的时间。这个短时间包括其他进程所占用的时间片， 和进程被阻塞时所花费的时间。user 时间是指进程花费在用户模式中的CPU时间， 这是唯一真正用于执行进程所花费的时间，其他进程和花费阻塞状态中的时间没有计算在内。sys 时间是指花费在内核模式中的 CPU 时间，代表在内核中执系统调用所花费的时间，这也是真正由进程使用的 CPU 时间） REHL 与 Debian 中的 man time 是不同的。比如输出带管道命令的运行时间：\time -f '%es' bash -c './test.py | sort &gt; /dev/null'，其中 time 前面的 \ 消除 alias 对命令的影响（相当于执行 /usr/bin/time），在这里由于 time 是内建命令（与 /usr/bin/time 冲突） screen 玩法： -ls – 列出当前用户分享的 screen -dmS session – 新建一个 session（-d 表示不立即附着） -r – （对于本机登录的自己）恢复离线的 screen 作业 -x – （对于别处登录的相同的账号）恢复作业，实现同账号分享 以下操作处于 screen 中： &lt;C-a&gt; d – 从 screen 中脱离（注：直接 &lt;C-d&gt; 会关闭这个 screen ！） &lt;C-a&gt; s – 冻结屏幕 &lt;C-a&gt; q – 恢复冻结的屏幕 &lt;C-a&gt; :multiuser on – 开始多用户模式 &lt;C-a&gt; :acladd USER – 多用户模式中允许用户 USER 访问 要实现不同账号分享，首先在 root 权限下执行： 123chmod u+s $(which screen)chmod 755 /var/run/screenrm -fr /var/run/screen/* 再开启多用户模式，添加用户访问权限，其它用户通过命令 screen -x usera/shared 即可。 另，出现 cannot open terminal 时可用 script /dev/null Zsh 中的 nohup 与 Bash 有所不同：关闭 shell 后仍然会停止后台任务。 解决方案： nohup &lt;command&gt; &amp; disown &lt;command&gt; &amp;! setopt NO_HUP 获得指定用户登录 Shell 路径：getent passwd $LOGNAME | cut -d: -f7 配置静态 DNS (Ubuntu)：修改 /etc/network/interfaces： 1dns-nameservers 223.5.5.5 223.6.6.6 重启 networking：sudo /etc/init.d/networking restart docker 命令免 sudo： 123sudo groupadd dockersudo gpasswd -a $&#123;USER&#125; dockersudo service docker restart 命令 lsb_release 提示 No LSB modules are available.： 1sudo apt install lsb-core 开启 swap （交换）分区： 创建用于交换分区的文件 1dd if=/dev/zero of=/mnt/swap bs=block_size count=number_of_block 注：block_size，number_of_block 大小可以自定义，比如 bs=1M，count=1024，代表设置 1G 大小 swap 分区 设置交换分区文件 1mkswap /mnt/swap 立即启用交换分区文件 /etc/fstab1swapon /mnt/swap 如果在 /etc/rc.local 中有 swapoff -a 需要修改为 swapon -a 设置开机时启用 swap 分区： 1/mnt/swap swap swap defaults 0 0 注：/mnt/swap 路径可以修改，可以根据创建的 swap 文件具体路径来配置，设置后可以执行 free -m 命令查看效果。 参考：针对阿里云及腾讯云等默认不开启swap分区解决办法 利用 svn 从远程仓库下载部分目录: GitHub：svn export https://github.com/&lt;username&gt;/&lt;repo&gt;/trunk/&lt;subdir&gt; 码云：svn export svn://git.oschina.net/&lt;username&gt;/&lt;repo&gt;/trunk/&lt;subdir&gt; 码市：svn export svn+ssh://svn@svn.coding.net/&lt;username&gt;/&lt;repo&gt;/trunk/&lt;subdir&gt; 其中 GitHub 已默认开启 svn； 码云及码市需要手动开启。如要获取额外的版本信息，将 export 改为 checkout CentOS7.3 (REHL 7) 为 GDB 工具安装必要包 debuginfo。 对简单的一段程序进行调试，却提示缺少包，需要通过 debuginfo-install 去安装 glibc-2.17-...，但无法直接安装 debuginfo-install，发现此工具在 yum-utils 中，所以首先安装 yum-utils 1yum install yum-utils 然后需要在 /etc/yum/repos.d 下新建 CentOS-Debuginfo.repo 文件: /etc/yum/repos.d/CentOS-Debuginfo.repo123456#Debug Info[debuginfo]name=CentOS-$releasever - DebugInfobaseurl=http://debuginfo.centos.org/$releasever/$basearchgpgcheck=0enabled=1 保存即可 U 盘安装 CentOS 7.3 Windows 下用 UltraISO 将系统刻入 U 盘 改 BIOS 启动引导项为 U 盘，进入的第一个界面中将光标移至 Install ...，按下 Tab，修改命令为 1vmlinuz initrd=initrd.img linux dd quiet 上面的命令只是查询 U 盘的设备号，比如此次安装时显示出 U 盘的设备号为 sdb4，按下 Ctrl-Alt-Del 强制重启，在下次的重启选项中键入 1vmlinuz initrd=initrd.img inst.stage2=hd:/dev/sdb4 quiet 源码编译 Git： 123456wget 'https://github.com/git/git/archive/v2.17.0-rc0.tar.gz'tar -xzvf v2.17.0-rc0.tar.gzcd git-2.17.0-rc0make configure./configure --prefix=/usr/local/git-2.17sudo make install -j4 注：Git 源文件中的 Makefile 默认不提供 uninstall 选项， 安装时务必慎重选取安装路径。 参考: How To Install Git on CentOS 7 Ubuntu 报错 sudo: unable to resolve host： /etc/hosts1127.0.0.1 localhost abcdefg 其中第三列为主机名 安装 Node.js 后报错：/usr/bin/env: ‘node’: No such file or directory 解决方案： 1ln -s /usr/bin/nodejs /usr/bin/node SSH 登录出现错误提示 WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!，一般是因为认证密钥过期，解决方案： 根据提示删除 ~/.ssh/known_hosts 中相应的行 ssh-keygen -R "you server hostname or ip" HEREDOC 作为参数调用方法（以 perl -e 为例）： 12345678910111213141516echo -e "\n"; set +H; perl -E "$(cat &lt;&lt;'EOP'foreach (1..10) &#123; our $num = $_; say "Iteration number $_.\n"; print "Please choose: last, next, redo, or none of the above? "; chomp(my $choice = &lt;STDIN&gt;); say; last if $choice =~ m'last'i; next if $choice =~ m`next`i; redo if $choice =~ /redo/i; say "That wasn't any of the choices ... onward!\n";&#125;say "That's all folks!";say "And the last number is $num";EOP)"; set -H 其中，为避免叹号 !（Exclamation Mark）引用历史命令使用 set +H yum 安装包时不清楚程序所在程序包名如何查询：yum provides */&lt;program&gt;]]></content>
      <categories>
        <category>Tips and Tricks</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[「转」CentOS 系统安装 GCC]]></title>
    <url>%2Fhow-to-install-gcc-on-centos-6%2F</url>
    <content type="text"><![CDATA[链接: How To Install GCC on CentOS 6 日期: Published on: Tue, Apr 28, 2015 at 1:02 am EST CentOS follows the development of Red Hat Enterprise Linux (RHEL). RHEL strives to be a stable server platform, which means that it does not rush to include the latest versions of every software package. As of the writing of this article, CentOS 6 officially distributes GCC v4.4.7. However, GCC v5.1 was recently released. Before that, v4.9.2 was available. The official suggestion to needing a more recent version of GCC is that you should consider a different UNIX distribution which is more focused on supporting the latest versions of software packages. Fortunately, you are able to install a more recent version of GCC on CentOS, leaving the older version still installed. This deviates from purely using the officially distributed software, but sometimes you may feel like you have little choice. You can run into some complications; for example, if you are installing third party kernel modules, they must be compiled using the same version of GCC used to build your kernel. This article describes how to install the CentOS 6 officially supported version of GCC, and how to install a newer version as well. This article assumes that you have a freshly installed CentOS 6 VPS, although you can certainly follow the instructions on an existing VPS. Install an officially supported (older) version of GCC Even if you want to install a newer version of GCC from source, GCC itself is written in C++. Therefore, you first have to install an older C++ compiler. Login to your VPS, either by clicking “View Console” in the Vultr control panel, or by SSH, if you have set that up. Login as root. Create your own user account, and give it a password. 12adduser &lt;username&gt;passwd &lt;username&gt; Allow your user account to execute commands with root privileges, through the sudo command. 12345678visudo After the line &quot;root ALL=(ALL) ALL&quot; Add the line &quot;&lt;username&gt; ALL=(ALL) ALL&quot; --- If you aren&apos;t familiar with vi, go to the line &quot;root ALL=(ALL) ALL&quot;. --- Hit &quot;o&quot; to create a new line after that line and enter insert mode. --- Type &quot;&lt;username&gt; ALL=(ALL) ALL&quot;. --- Hit ESC. --- Type &quot;ZZ&quot; to save. Log out as root, and login to your user account. Install the CentOS 6 GCC packages. This will ask you if you want to install around 11 packages, due to dependencies. 1yum install gcc gcc-c++ Check the installed versions, and show their locations. 12345678gcc --version May say: gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-11)g++ --version May say: g++ (GCC) 4.4.7 20120313 (Red Hat 4.4.7-11)which gcc /usr/bin/gccwhich g++ /usr/bin/g++ Install a newer version of GCC from source If you only want the CentOS officially supported version of GCC, you’re all set. If you need a more recent version of GCC, continue on. IMPORTANT! First, complete the steps above to install an older binary version of GCC. Install additionally required packages. This will ask you if you want to install around 41 packages. 1yum install svn texinfo-tex flex zip libgcc.i686 glibc-devel.i686 Decide which version of GCC you want to install. This command will show you the “tags” for each of the versions available. 12345svn ls svn://gcc.gnu.org/svn/gcc/tags | grep gcc | grep release gcc-2_95-release/ ... gcc-4_9_2_release/ gcc-5_1_0_release/ Get the source of the version of GCC you want. This will run for a few minutes. The rest of this article is written for gcc-5_1_0_release and will download the sources into ~/sourceInstallations/gcc_5_1_0_release/. 123mkdir ~/sourceInstallationscd ~/sourceInstallationssvn co svn://gcc.gnu.org/svn/gcc/tags/gcc_5_1_0_release/ Get the source of additional prerequisites. Using v5.1.0, this downloads sources and adds them to the GCC build for MPFR v2.4.2, GMP 4.3.2, and MPC 0.8.1. 1234cd gcc_5_1_0_release/./contrib/download_prerequisites --- Important, run this as shown, from the gcc_5_1_0_release directory. --- Do not cd to the contrib directory If your VPS only has 768MB of memory, you will run out of memory in the next step. If you have 1GB of memory, you may be OK, but it can’t hurt to do this step. If you have 2GB of memory, or more, you can skip this step. This step adds 500MB of virtual memory, using a swap file. 1234SWAP=/tmp/swapdd if=/dev/zero of=$SWAP bs=1M count=500mkswap $SWAPswapon $SWAP Build GCC. This will run for hours. If this completes correctly, the last line you will see will say “success”. It is normal to see some error-looking messages scrolling by quickly, as long as the build completes and echos “success”. It’s always a good idea to build things in a different directory than a source directory. GCC documentation states that you should not use a build directory that is a sub-directory of the source directory. 1234567cd ..mkdir gcc_5_1_0_release_build/cd gcc_5_1_0_release_build/../gcc_5_1_0_release/configure &amp;&amp; make &amp;&amp; make install &amp;&amp; echo &quot;success&quot;--- If your VPS has multiple cores, you can speed up the build by changing the middle part--- of this line from &quot;&amp;&amp; make &amp;&amp;&quot; to &quot;&amp;&amp; make -j &lt;number of cores&gt; &amp;&amp;&quot;.--- You can see the number of cores your VPS has by running &quot;nproc&quot; If you set up a swap file in step 6, remove it. Without doing more configuring, after a reboot, it won’t be used as a swap file, and just take up hard drive space in your VPS. 12swapoff $SWAPrm /tmp/swap Check the installed versions, and see their locations. 12345678910hash -r (Makes your login &quot;forget&quot; about the previously seen locations of gcc and g++)gcc --version May say: gcc (GCC) 5.1.0g++ --version May say: g++ (GCC) 5.1.0which gcc /usr/local/bin/gccwhich g++ /usr/local/bin/g++ Add the new libraries to ld (the GNU linker). 12345echo &quot;/usr/local/lib64&quot; &gt; usrLocalLib64.confsudo mv usrLocalLib64.conf /etc/ld.so.conf.d/sudo ldconfig --- This may say a file or two &quot;is not an ELF file - it has the wrong magic bytes at the start.&quot; --- You may ignore this message. It is silent about the work it successfully completed. Optionally make a hello world program. 1234567891011121314mkdir ~/codecd ~/codeCreate a file main.cpp that says: #include &lt;iostream&gt; using namespace std; int main() &#123; cout &lt;&lt; &quot;Hello world!&quot; &lt;&lt; endl; return 0; &#125;--- One way to create this file is to run &quot;vi main.cpp&quot;, hitting &quot;i&quot; to enter insert mode,--- typing the above file, hitting ESC, and hitting &quot;ZZ&quot; to save.g++ main.cpp -o main./main Hello World! Optionally reclaim hard drive space. Your ~/sourceInstallations folder will be taking up around 8.0GB. It’s probably wise to keep the folders, as there are optional configuration options you may need to use at some point in the future, and it would be faster to have a lot already done. Also, the build process makes logs that you can later check and work from if something goes wrong. But, after running sudo make install earlier, your installed GCC isn’t depending on anything in this directory, and space can be at a premium, so you can do this step and reclaim the 8.0GB or so. 123cd ~/rm -rf sourceInstallations--- Again, if you can spare the space, you may someday be happy to have left it there. You now have your CentOS officially supported gcc and g++ still in /usr/bin/, your CentOS officially supported 32-bit libs in /lib, your CentOS officially supported 64-bit libs in /lib64, and your CentOS officially supported include files in /usr/include. Your newer gcc and g++ are in /usr/local/bin, newer 32-bit libs in /usr/local/lib, your newer 64-bit libs in /usr/local/lib64, and your newer include files in /usr/local/include.]]></content>
      <categories>
        <category>Operation and Maintenance</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
        <tag>GCC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[「转」CentOS 系统安装 LLVM 以及 Clang]]></title>
    <url>%2Fhow-to-install-llvm-and-clang-on-centos-6%2F</url>
    <content type="text"><![CDATA[链接: How To Install LLVM and Clang on CentOS 6 日期: Wed, May 13, 2015 at 3:22 am EST LLVM is an open-source compiler infrastructure. LLVM was started in 2000, and has been extensively used and modified by Apple since 2005. Clang is a C, C++, Objective-C, and Objective-C++ compiler that works with the LLVM system. Clang was started in 2007 by Apple, and since then Google and Intel have become involved in its continued development. Clang’s developers claim that compared to GCC, it compiles faster, uses less memory, gives more user friendly diagnostics during compilation, and is compatible with GCC. CentOS follows the development of Red Hat Enterprise Linux (RHEL). RHEL strives to be a stable server platform, which means it does not rush to include the latest versions of everything. As of the writing of this article, CentOS 6 officially distributes LLVM &amp; Clang v3.4.2. However, Clang v3.6 has been released. The official suggestion is if you need a more recent version of LLVM &amp; Clang, you should consider a different UNIX distribution which is more focused on supporting the latest versions of software packages. Fortunately, you are able to install a more recent version LLVM &amp; Clang GCC on CentOS. This deviates from purely using the officially distributed software, but sometimes you may feel like you have little choice. This article describes how to install the CentOS 6 officially supported version of LLVM &amp; Clang, and how to install a newer version. This article assumes you have a freshly installed CentOS 6 VPS, however you can certainly follow the instructions on a VPS you have already been using. Clang is largely independent from GCC, but as of the writing of this article, Clang still uses several shared libraries installed by GCC (namely, crtbegin.o, gcc, and gcc_s). If you install LLVM &amp; Clang on CentOS 6, you won’t be able to compile anything if you don’t also have GCC on your system for these shared libraries. Ideally, yum would have a package dependency for clang of gcc and gcc-c++, but as of the writing of this article, yum is unaware of the dependency. Additionally, building a newer version of LLVM &amp; Clang from source requires G++ v4.7+, which you can only get on CentOS 6 by installing it by source. If you run all of the steps below, you’ll wind up with 2 versions of GCC and 2 versions of LLVM &amp; Clang. This includes an officially supported binary older version and a newer version from source for each program. However, there’s no need to run all the steps below. You can decide whether you want the officially supported binary older version of LLVM &amp; Clang, or the newer version from source, and run whichever section of instructions fits your decision. Install an officially supported (older) version of LLVM &amp; Clang IMPORTANT! First, install an officially supported (older) version of GCC, by performing the steps in the article How to Install GCC on CentOS 6 – you do NOT need to perform the steps under that article’s heading “Install a newer version of GCC from source”. Install LLVM &amp; Clang 12yum install clang --- This will bring in llvm as a dependency Check the installed versions, and see their locations. 123456789101112clang --version May say: clang version 3.4.2 (tags/RELEASE_34/dot2-final)which clang /usr/bin/clanggcc --version May say: gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-11)g++ --version May say: g++ (GCC) 4.4.7 20120313 (Red Hat 4.4.7-11)which gcc /usr/bin/gccwhich g++ /usr/bin/g++ Install a newer version of LLVM &amp; Clang from source To build LLVM &amp; Clang by source on CentOS, you have to have GCC v4.7 or above. CentOS 6 does not have this high of a version in yum, so you first have to install a more recent GCC from source. IMPORTANT! First, install a newer version of GCC from source, by performing the steps in the article How to Install GCC on CentOS 6 – you DO need to perform all steps in that article, including under the heading “Install a newer version of GCC from source”. Install additionally required packages. 1yum install cmake Install a newer version of Python. LLVM &amp; Clang v3.6.0 requires Python v2.7+, but CentOS 6 yum repository only has Python v2.6.6. 123456mkdir ~/sourceInstallationscd ~/sourceInstallationswget https://www.python.org/ftp/python/2.7.9/Python-2.7.9.tgztar -xvf Python-2.7.9.tgzcd Python-2.7.9./configure &amp;&amp; make &amp;&amp; make install Decide which version of LLVM &amp; Clang you want. This command will show you the “tags” for the versions available. 123456789101112131415svn ls http://llvm.org/svn/llvm-project/llvm/tags | grep RELEASE RELEASE_1/ ... RELEASE_352/ RELEASE_360/ RELEASE_361/svn ls http://llvm.org/svn/llvm-project/llvm/tags/RELEASE_361 rc1/ --- At this time, there is no final, just a release candidate. You could certainly use a release candidate, but this article will show how to use a final release.svn ls http://llvm.org/svn/llvm-project/llvm/tags/RELEASE_360 final/ rc1/ rc2/ rc3/ rc4/ Get the source of the version of LLVM &amp; Clang that you want. This will run for a few minutes. The rest of this article is written for RELEASE_360/ and will download the sources into ~/sourceInstallations/llvm_RELEASE_360/ – You will have to substitute the proper tag to fit future versions. The directories below of compiler-rt, libcxx, and libcxxabi are not absolutely necessary, but contain some of the features that LLVM &amp; Clang have that GCC doesn’t, so are included in this article. There are other LLVM “sub-projects” you could choose to use, such as dragonegg, LLDB, OpenMB, vmkit, polly, libclc, klee, SAFECode, and lld. You can read about those on the LLVM website. 123456789101112cd ~/sourceInstallationssvn co http://llvm.org/svn/llvm-project/llvm/tags/RELEASE_360/final llvm_RELEASE_360cd llvm_RELEASE_360/toolssvn co http://llvm.org/svn/llvm-project/cfe/tags/RELEASE_360/final clangcd ../projectssvn co http://llvm.org/svn/llvm-project/compiler-rt/tags/RELEASE_360/final compiler-rtsvn co http://llvm.org/svn/llvm-project/libcxx/tags/RELEASE_360/final libcxxsvn co http://llvm.org/svn/llvm-project/libcxxabi/tags/RELEASE_360/final libcxxabicd ..svn update At revision X. --- Hopefully this outputs one line saying &quot;At revision X&quot;, but numbers instead of &quot;X&quot;. If it downloads more source files, a new revision was released while you were downloading the source code. This is highly unlikely unless you&apos;re using trunk (the most up to date, maybe unstable code.) But, if this happens, perform a svn update in the tools/clang, projects/compiler-rt, projects/libcxx, projects/libcxxabi, and again ~/sourceInstallations/llvm_RELEASE_360, until you are fully up to date. Build LLVM &amp; Clang. This will run for a while. If this completes correctly, the last line you will see will say “success”. It is normal to see some error-looking messages scrolling by quickly. It’s always a good idea to build things in a different directory than a source directory. 12345678mkdir ../llvm_RELEASE_360_buildcd ../llvm_RELEASE_360_buildcmake -G &quot;Unix Makefiles&quot; -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=/usr/local/bin/gcc -DCMAKE_CXX_COMPILER=/usr/local/bin/g++ ../llvm_RELEASE_360 &amp;&amp; make &amp;&amp; make install &amp;&amp; echo success --- If your VPS has multiple cores, you can speed up the build by changing the middle part --- of this line from &quot;&amp;&amp; make &amp;&amp;&quot; to &quot;&amp;&amp; make -j &lt;number of cores&gt; &amp;&amp;&quot;. --- You can see the number of cores your VPS has by running &quot;nproc&quot; --- If you omit -DCMAKE_BUILD_TYPE=Release, the build defaults to debug. This is great if you need to debug LLVM &amp; Clang itself, but slows down compilation of your end programs considerably. --- If you omit the references to gcc and g++, it will default to using the older binary versions in /usr/bin/, and will not compile. Check the installed versions, and see their locations. 12345678clang --version May say: clang version 3.6.0 (tags/RELEASE_360/final 237229)clang++ --version May say: clang version 3.6.0 (tags/RELEASE_360/final 237229)which clang /usr/local/bin/clangwhich clang++ /usr/local/bin/clang++ Add the new libraries to ld (the GNU linker). 12345echo &quot;/usr/local/lib&quot; &gt; usrLocalLib.confmv usrLocalLib.conf /etc/ld.so.conf.d/ldconfig --- This may say a file or two &quot;is not an ELF file - it has the wrong magic bytes at the start.&quot; --- You may ignore this message. It is silent about the work it successfully completed. Optionally make a “hello world” program. 123456789101112131415161718mkdir ~/codecd ~/codeCreate a file main.cpp that says: #include &lt;iostream&gt; using namespace std; int main() &#123; cout &lt;&lt; &quot;Hello world!&quot; &lt;&lt; endl; return 0; &#125;--- One way to create this file is to run &quot;vi main.cpp&quot;, hitting &quot;i&quot; to enter insert mode,--- typing the above file, hitting ESC, and hitting &quot;ZZ&quot; to save.clang++ main.cpp -o main./main Hello World!clang++ -stdlib=libc++ -lc++abi main.cpp -o main --- This uses Clang&apos;s libc++ and libc++abi, instead of the GNU stdlibc++ and stdlibc++abi./main Hello world! Use LLVM &amp; Clang when you want to. 12345You could set LLVM &amp; Clang to be your system&apos;s default C and C++ compiler by running: echo &quot;export CC=/usr/local/bin/gcc&quot; &gt;&gt; ~/.bashrc echo &quot;export CXX=/usr/local/bin/g++&quot; &gt;&gt; ~/.bashrc source ~/.bashrcOnce and a while there is a difference between Clang and GCC, but it&apos;s becoming more and more rare. To be more conservative, you could specify in your code&apos;s buildsystem to use LLVM &amp; Clang, but otherwise leave your system&apos;s default to the source build of GCC. Optionally reclaim hard drive space. Your ~/sourceInstallations folder will be taking up around 11GB of disk space. It’s probably wise to keep the folders, as there are optional configuration options you may need to use at some point in the future, and it would be faster to have a lot already done. And, as mentioned above, there are additional “sub-projects” you can add to LLVM &amp; Clang. Also, the build process makes logs that you can later check and work from if something goes wrong. But, after running “make install” earlier, your installed LLVM &amp; Clang isn’t depending on anything in this directory, and space can be at a premium, so you can do this step and reclaim the 11GB. 123cd ~/rm -rf sourceInstallations--- Again, if you can spare the space, you may someday be happy to have left it there. You now have your newer LLVM &amp; Clang in /usr/local/bin, your newer 64-bit LLVM &amp; Clang libs in /usr/local/lib, and your newer LLVM &amp; Clang include files in /usr/local/include.]]></content>
      <categories>
        <category>Operation and Maintenance</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
        <tag>Clang</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows 下安装 Anaconda3 产生的快捷方式]]></title>
    <url>%2Fshortcuts-of-anaconda-on-windows%2F</url>
    <content type="text"><![CDATA[部分情况下，一些 Windows 机器安装完 Anaconda 之后不会出现快捷方式，而其快捷方式较为复杂，故记录之。 用户名为 Michael，Anaconda3 安装目录为 D:\Anaconda3，若安装于其它目录，作相应修改即可。 root / base 环境 Shortcuts Commands Start in Anaconda Cloud D:\Anaconda3\pythonw.exe -m webbrowser -t "https://anaconda.org/" C:\Users\Michael Anaconda Navigator D:\Anaconda3\pythonw.exe D:\Anaconda3\cwp.py D:\Anaconda3 "D:/Anaconda3/pythonw.exe" "D:/Anaconda3/Scripts/anaconda-navigator-script.py" C:\Users\Michael\Documents Anaconda Prompt %windir%\system32\cmd.exe "/K" D:\Anaconda3\Scripts\activate.bat D:\Anaconda3 C:\Users\Michael IPython D:\Anaconda3\python.exe D:\Anaconda3\cwp.py D:\Anaconda3 "D:/Anaconda3/python.exe" "D:/Anaconda3/Scripts/ipython-script.py" C:\Users\Michael Jupyter Notebook D:\Anaconda3\python.exe D:\Anaconda3\cwp.py D:\Anaconda3 "D:/Anaconda3/python.exe" "D:/Anaconda3/Scripts/jupyter-notebook-script.py" %USERPROFILE% C:\Users\Michael Jupyter QTConsole D:\Anaconda3\pythonw.exe D:\Anaconda3\cwp.py D:\Anaconda3 "D:/Anaconda3/pythonw.exe" "D:/Anaconda3/Scripts/jupyter-qtconsole-script.py" C:\Users\Michael Reset Spyder Settings D:\Anaconda3\python.exe D:\Anaconda3\cwp.py D:\Anaconda3 "D:/Anaconda3/python.exe" "D:/Anaconda3/Scripts/spyder-script.py" --reset C:\Users\Michael Spyder D:\Anaconda3\pythonw.exe D:\Anaconda3\cwp.py D:\Anaconda3 "D:/Anaconda3/pythonw.exe" "D:/Anaconda3/Scripts/spyder-script.py" "C:\Users\Michael\Documents\Python Scripts" 其他环境（环境名：workspace） Shortcuts Commands Start in Anaconda Cloud D:\Anaconda3\pythonw.exe -m webbrowser -t "https://anaconda.org/" C:\Users\Michael Anaconda Navigator D:\Anaconda3\envs\workspace\pythonw.exe D:\Anaconda3\cwp.py D:\Anaconda3\envs\workspace "D:/Anaconda3/envs/workspace/pythonw.exe" "D:/Anaconda3/envs/workspace/Scripts/anaconda-navigator-script.py" C:\Users\Michael\Documents Anaconda Prompt %windir%\system32\cmd.exe "/K" D:\Anaconda3\Scripts\activate.bat D:\Anaconda3\envs\workspace C:\Users\Michael IPython D:\Anaconda3\envs\workspace\python.exe D:\Anaconda3\cwp.py D:\Anaconda3\envs\workspace "D:/Anaconda3/envs/workspace/python.exe" "D:/Anaconda3/envs/workspace/Scripts/ipython-script.py" C:\Users\Michael Jupyter Notebook D:\Anaconda3\envs\workspace\python.exe D:\Anaconda3\cwp.py D:\Anaconda3\envs\workspace "D:/Anaconda3/envs/workspace/python.exe" "D:/Anaconda3/envs/workspace/Scripts/jupyter-notebook-script.py" %USERPROFILE% C:\Users\Michael Jupyter QTConsole D:\Anaconda3\envs\workspace\pythonw.exe D:\Anaconda3\cwp.py D:\Anaconda3\envs\workspace "D:/Anaconda3/envs/workspace/pythonw.exe" "D:/Anaconda3/envs/workspace/Scripts/jupyter-qtconsole-script.py" C:\Users\Michael Reset Spyder Settings D:\Anaconda3\envs\workspace\python.exe D:\Anaconda3\cwp.py D:\Anaconda3\envs\workspace "D:/Anaconda3/envs/workspace/python.exe" "D:/Anaconda3/envs/workspace/Scripts/spyder-script.py" --reset C:\Users\Michael Spyder D:\Anaconda3\envs\workspace\pythonw.exe D:\Anaconda3\cwp.py D:\Anaconda3\envs\workspace "D:/Anaconda3/envs/workspace/pythonw.exe" "D:/Anaconda3/envs/workspace/Scripts/spyder-script.py" "C:\Users\Michael\Documents\Python Scripts"]]></content>
      <categories>
        <category>Memos</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>Anaconda</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[「转」Shell 脚本中的颜色]]></title>
    <url>%2Fshell-colors-colorizing-shell-scripts%2F</url>
    <content type="text"><![CDATA[链接: Shell Colors: colorizing shell scripts Shell scripts commonly used ANSI escape codes for color output. Following table shows Numbers representing colors in Escape Sequences. Color Foreground Background Black 30 40 Red 31 41 Green 32 42 Yellow 33 43 Blue 34 44 Magenta 35 45 Cyan 36 46 White 37 47 The numbers in the above table work for xterm terminal.Result may vary for other terminal emulators. Use the following template for writing colored text. 1echo -e "\033[COLORm Sample text" The \033[ begins the escape sequence. You can also use \e[ instead of \033[. COLOR specifies a foreground color, according to the table above.The m terminates escape sequence, and text begins immediately after that. Note: With an echo, the -e option enables the escape sequences. You can also use printf instead of echo. 1printf "\e[COLORm sample text\n" To print Green text 1echo -e "\033[32m Hello World" or 1printf "\e[32m Hello World" The problem with above statement is that the blue color that starts with the 32 color code is never switched back to the regular color, so any text you type after the prompt and even prompt also is still in the Green color. To return to the plain, normal mode, we have yet another sequence. 1echo -e "\033[0m" Now you won’t see anything new on the screen, as this echo statement was not passed any string to display. But it has done its job, which was to restore the normal viewing mode. Whatever yor type now will be avoid of any fancy effects. Escape sequence also allow you to control the manner in which characters are displayed on the screen. The following table summarizes numbers representing text attributes in Escape Sequences. ANSI CODE Meaning 0 Normal Characters 1 Bold Characters 4 Underlined Characters 5 Blinking Characters 7 Reverse video Characters Note: Blink attribute doesn’t work in any terminal emulator, but it will work on the console. Combining all these Escape Sequences, you can get more fancy effect. Use the following template for writing colored text on a colored background. 1echo -e "\033[COLOR1;COLOR2m sample text\033[0m" The semicolon separated numbers “COLOR1” and “COLOR2” specify a foreground and a background color.The order of the numbers does not matter, since the foreground and background numbers fall in non- overlapping ranges. m terminates the escape sequence, and the text begins immediately after that.Although setting the colors separately also work (i.e. \033[44m\033[32m). There are some differences between colors when combining colors with bold text attribute. The following table summarises these differences. Bold off color Bold on color 0;30 Balck 1;30 Dark Gray 0;31 Red 1;31 Dark Red 0;32 Green 1;32 Dark Green 0;33 Brown 1;33 Yellow 0;34 Blue 1;34 Dark Blue 0;35 Magenta 1;35 Dark Magenta 0;36 Cyan 1;30 Dark Cyan 0;37 Light Gray 1;30 White The following shell script prints all the colors and codes on the screen. 123456789101112#!/bin/bash# This script echoes colors and codesecho -e "\n\033[4;31mLight Colors\033[0m \t\t\033[1;4;31mDark Colors\033[0m"echo -e "\e[0;30;47m Black \e[0m 0;30m \t\e[1;30;40m Dark Gray \e[0m 1;30m"echo -e "\e[0;31;47m Red \e[0m 0;31m \t\e[1;31;40m Dark Red \e[0m 1;31m"echo -e "\e[0;32;47m Green \e[0m 0;32m \t\e[1;32;40m Dark Green \e[0m 1;32m"echo -e "\e[0;33;47m Brown \e[0m 0;33m \t\e[1;33;40m Yellow \e[0m 1;33m"echo -e "\e[0;34;47m Blue \e[0m 0;34m \t\e[1;34;40m Dark Blue \e[0m 1;34m"echo -e "\e[0;35;47m Magenta \e[0m 0;35m \t\e[1;35;40m DarkMagenta\e[0m 1;35m"echo -e "\e[0;36;47m Cyan \e[0m 0;36m \t\e[1;36;40m Dark Cyan \e[0m 1;36m"echo -e "\e[0;37;47m LightGray\e[0m 0;37m \t\e[1;37;40m White \e[0m 1;37m" OUTPUT: Some examples Block background and white text 1echo -e "\033[40;37m Hello World\033[0m" Reverse video text attribute option interchanges fg and bg colors. Bellow statement prints block on white 1234echo -e "\033[40;37;7m Hello World\033[0m"echo -e "\033[33;44m Yellow text on blue background\033[0m"echo -e "\033[1;33;44m Bold yellow text on blue background\033[0m"echo -e "\033[1;4;33;44mBold yellow underlined text on blue background\033[0m" The tput command: Other than echo there is a command called tput using which we can control the way the output is displayed on the screen.But it is less flexible than ANSI escape sequences. 补充控制选项说明 12345678910111213141516171819\033[0m 关闭所有属性\033[1m 设置高亮度\033[4m 下划线\033[5m 闪烁\033[7m 反显\033[8m 消隐\033[30m - \33[37m 设置前景色\033[40m - \33[47m 设置背景色\033[nA 光标上移n行\033[nB 光标下移n行\033[nC 光标右移n行\033[nD 光标左移n行\033[y;xH 设置光标位置\033[2J 清屏\033[K 清除从光标到行尾的内容\033[s 保存光标位置\033[u 恢复光标位置\033[?25l 隐藏光标\033[?25h 显示光标]]></content>
      <categories>
        <category>Memos</category>
      </categories>
      <tags>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[安装 Zsh]]></title>
    <url>%2Fzsh-installation%2F</url>
    <content type="text"><![CDATA[试验场所有 CentOS（本地 + 远程），Ubuntu 14.04+，MSYS2（比较卡，应该是 mintty 的原因，不打算继续折腾）。 安装 Zsh 12yum install zshchsh -s /usr/bin/zsh 安装 Oh-My-Zsh 官方 repo 1sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)" 或 1sh -c "$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)" 详情请见 oh-my-zsh 的 wiki。 主题 Powerlevel9k：repo 1git clone https://github.com/bhilburn/powerlevel9k.git ~/.oh-my-zsh/custom/themes/powerlevel9k 自带主题：Themes 额外主题：External themes 配置 zshrc 见 .zshrc (针对 powerlevel9k 主题) 秀一发: 注 其中所用字体为 Sauce Code Pro Nerd Font Complete Mono Windows Compatible，官方 repo 常见问题 不能更新，提示 error: Cannot pull with rebase: You have unstaged changes. 12cd $ZSH &amp;&amp; git stash &amp;&amp; cd -upgrade_oh_my_zsh]]></content>
      <categories>
        <category>Operation and Maintenance</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Shell</tag>
        <tag>Zsh</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[单用户 Jupyter Notebook 服务器环境搭建]]></title>
    <url>%2Fsetting-up-local-jupyter-notebook-server-environment%2F</url>
    <content type="text"><![CDATA[被朋友强烈安利入坑 TensorFlow，于是着手搭建 Python 的工作环境。之前在 Windows 下使用过 Anaconda，不仅能愉快地切换 Python 2.x 与 3.x 环境，还能像应用容器一样安装其他软件（RStudio，Spyder）等。但如此一来自身体积逐渐增大，于是考虑在装载 CentOS 7.3 系统的老爷机上搭建 Anaconda 环境，并部署 Jupyter Notebook 服务器。本文搭建的环境仅允许单用户访问，如需要多用户，需使用 JupyterHub。这里的初始参考来源是 Jupyter Notebook 的官方文档。 安装 Anaconda 建议以非 root 权限安装、运行 Anaconda，每个用户可以在自己独立的环境 /home/&lt;user&gt;/anaconda 中操作。 直接下载 Anaconda x.x.x For Linux Installer， 1bash ~/Downloads/Anaconda3-4.4.0-Linux-x86_64.sh 安装过程中的安装目录可进行自定义。通常由于喜闻乐见的原因，在 Conda 中下载包是速度是喜(gan)人的，所以需添加国内镜像： 12conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/conda config --set show_channel_urls yes 可查看 ~/.condarc 文件确认其配置，同时可配置代理（proxy_servers 项）： .condarc12345678910channels: - https://mirrors.ustc.edu.cn/anaconda/pkgs/main/ - https://mirrors.ustc.edu.cn/anaconda/pkgs/free/ - https://mirrors.ustc.edu.cn/anaconda/cloud/conda-forge/ - defaultsproxy_servers: http: http://localhost:1080 https: https://localhost:1080show_channel_urls: truessl_verify: true 安装 TensorFlow 虽然此步骤不影响 Jupyter Notebook 服务器的搭建，不过既然此次折腾的初衷就是为了用上 TensorFlow，所以顺便记录下安装过程。根据 TensorFlow 官方指南 Installing with Anaconda，进行如下一通操作即可： 1234conda create -n tensorflowsource activate tensorflow# (tensorflow)$ # Your prompt should changepip install --ignore-installed --upgrade &lt;tfBinaryURL&gt; 其中的 &lt;tfBinaryURL&gt; 即为 URL of the TensorFlow Python package，选择适配的版本进行安装即可，安装过程可能由于强大的网(Fang)络(Huo)环(Chang)境(Cheng)而中断。这里稍微提下 Conda 这个包管理系统。它不仅是一般意义上对各类包进行管理的工具，更重要的是可以创造出独立的环境，比如上述 conda create -n 就新建了一个新的环境，默认环境为 root，可通过 conda info --envs 查看当前用户下所有的环境，标注 * 的表示当前环境，所以为版本切换提供了十分便捷的途径。 测试 新建 test.py： test.py123456789import osimport tensorflow as tfos.environ['TF_CPP_MIN_LOG_LEVEL']='2'hello = tf.constant('Hello,Tensorflow!')sess = tf.Session()print(sess.run(hello))a = tf.constant(10)b = tf.constant(32)print(sess.run(a + b)) 运行结果如下： 123python test.py# b'Hello,Tensorflow!'# 42 配置 Jupyter Notebook 安装完 Anaconda 之后，默认的 root 环境已经自带一个 jupyter，可通过 conda info --envs 来查询已有环境。所以如果直接在终端键入 jupyter notebook，打开的是默认环境下的 jupyter，所以需要在当前环境 tensorflow 中也安装一个 jupyter。 生成配置文件 12conda install --name tensorflow jupyterjupyter notebook --generate-config 创建「伪」SSL证书。参考如何在云端服务器运行Jupyter Notebook？。 1openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout mycert.pem -out mycert.pem 便会在当前路径生成 mycert.pem 私钥文件 生成密码哈希值。打开 ipython： 12345In [1]: from notebook.auth import passwdIn [2]: passwd()Enter password:Verify password:Out[2]: 'sha1:xxxxxxxxxxxxxxxxxxxxx' 或者单行： 1python -c "from notebook.auth import passwd; print(passwd())" 修改配置文件 ~/.jupyter/jupyter_notebook_config.py。 jupyter_notebook_config.py12345c.NotebookApp.certfile = u'path/to/mycert.pem'c.NotebookApp.ip = '*'c.NotebookApp.password = u'sha1:xxxxxxxxxxxxxxxxxxxxx'c.NotebookApp.open_browser = Falsec.NotebookApp.port = 8889 开启端口。（参考Centos防火墙设置与端口开放的方法） Centos 升级到 7 之后，内置的防火墙已经从 iptables 变成了 firewalld。 罗列 firewalld 常用命令： 启动 / 关闭防火墙：systemctl start/stop firewalld 启用 / 停止服务：systemctl enable/disable firewalld 查看状态：systemctl status firewalld 或 firewall-cmd --state 更新防火墙规则 无需断开连接：firewall-cmd --reload 需要断开连接，类似重启：firewall-cmd --complete-reload 查看指定区域所有打开的端口：firewall-cmd --zone=public --list-ports 在指定区域打开端口（记得重启防火墙）： 1firewall-cmd --zone=public --add-port=80/tcp [--permanent] 说明: zone 作用域 add-port=80/tcp 添加端口，格式为：端口 / 通讯协议 permanent 永久生效，没有此参数重启后失效 所以需要开放 8889 端口： 12firewall-cmd --zone=public --add-port=8889/tcp --permanentfirewall-cmd --complete-reload 启动 Jupyter Notebook： 1jupyter notebook 浏览器输入 https://&lt;ip&gt;:8889 访问即可。 补充 折腾必备 — 改主题 利用 pip 安装 jupyter-themes： 12pip install jupyterthemespip install --upgrade jupyterthemes 如需永久更改 pip 源，修改 ~/.pip/pip.conf（Windows 下为 %userprofile%\pip\pip.ini）： pip.conf1234[global]index-url = https://mirrors.ustc.edu.cn/pypi/web/simple# index-url = https://pypi.tuna.tsinghua.edu.cn/simple# index-url = https://pypi.douban.com/simple 修改 Jupyter Notebook 主题并开启服务端： 12jt -f code -fs 12 -tf ptsans -tfs 13 -dfs 11 -ofs 12 -lineh 125 -cellw 1000 -t solarizedl -T -vimjupyter notebook 主题效果如下： 多核环境以及 Jupyter Notebook 插件 Jupyter Notebook 插件集 jupyter_contrib_nbextensions，貌似在多环境中，该插件应该最先被安装 从 Anaconda 4.1.0 开始，一个特别的包 nb_conda_kernels 能够自动检测 Conda 的所有环境并注册这些核到 Jupyter Notebook 中]]></content>
      <categories>
        <category>Development and Deployment</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Server</tag>
        <tag>Anaconda</tag>
        <tag>Jupyter</tag>
        <tag>TensorFlow</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS 服务器部署 Hexo 博客并利用 Webhook 自动更新]]></title>
    <url>%2Fhexo-deployment-on-server%2F</url>
    <content type="text"><![CDATA[Hexo, A fast, simple & powerful blog framework. 本地部署 Hexo 安装 根据 Hexo 官网的介绍，首先要安装 Git 以及 Nodejs，CentOS 系统下直接 yum 安装即可： 12yum install gityum install nodejs 两个工具都装好之后，必要时设置 npm 的源： 12npm config set proxy https://domain:portnpm config set registry http://registry.npm.taobao.org/ 利用 npm 安装 hexo： 1npm install hexo-cli -g 注意 npm 安装的包在 ~/.npm 目录下（所以是用户级别的）。 配置 初始化 Hexo: 1234mkdir ~/Hexocd ~/Hexohexo initnpm install Hexo 文件夹下的 _config.yml 为站点配置文件，比如 _config.yml1234567# Sitetitle:subtitle:description:author:language:timezone: 服务器 这里摘自 Hexo 官网的介绍。安装 hexo-server 包： 1npm install hexo-server --save 那么输入 1hexo server 网站就会在 http://localhost:4000 下启动，并且 Hexo 会监视文件变动并更新，如需改变端口或遇到 EADDRINUSE 错误，加上 -p 参数并指定端口： 1hexo server -p 5000 生成器 利用 hexo generate 或者 hexo g 即可生成静态文件，生成的文件目录为 ~/Hexo/public。 同步到代码托管平台 安装 hexo-deployer-git： 1npm install hexo-deployer-git --save 在前述 _config.yml 文件中，找到 deploy 项，配置为： _config.yml123456deploy: type: git repo: github: git@github.com:xxx/blog.git coding: git@git.coding.net:xxx/blog.git branch: master 这里将 Github 上的仓库命名为 blog，与后文中本地仓库名相同。 直接利用 hexo deploy 或 hexo d 直接 push 到 Github 上。生成静态文件与同步可以合为一步（两者作用相同）： 12hexo g -dhexo d -g 详细配置过程见官方文档。 配置 Nginx 添加 Nginx 的 repo 并安装： 123rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpmyum info nginxyum install nginx Nginx 二进制文件所在目录为 /usr/sbin/nginx，配置目录为 /etc/nginx/。由于 /etc/nginx/nginx.conf 文件中包含 1include /etc/nginx/conf.d/*.conf; 所以仅需在 /etc/nginx/conf.d/ 下新建 hexo.conf 文件，配置网站信息即可： hexo.conf123456server &#123; listen 80; server_name domain.com; root /var/www/blog; index index.html index.htm;&#125; 启动Nginx服务：service nginx start 重载Nginx服务：service nginx reload 这里的 root 即为网站所在目录，大量的教程中将 /var/www/ 设成网站所在目录，估计是约定俗成吧。那么这里就有权限问题了，刚入坑的我还并不是很了解 Linux 的权限机制，所以干脆决定在普通用户下生成静态文件，并同步至 Github，再利用系统用户利用 Webhook 从 Github 更新网站目录。 配置 Webhook 以 root 用户登录，创建两个文件： - sync.sh：用于从 Github 上 pull 数据，即更新本地网站目录，注意加上执行权限 sync.sh12345678#!/bin/bashecho -e "\033[32m [AUTO SYNC] sync hexo start \033[0m"cd /var/www/blogecho -e "\033[32m [AUTO SYNC] git pull... \033[0m"git fetch --allgit reset --hard origin/mastergit pullecho -e "\033[32m [AUTO SYNC] sync hexo finish \033[0m" - hexo-server.js：接受 Github 的 post 信息后执行 sync.sh hexo-server.js123456789101112131415161718192021222324252627282930313233343536var http = require('http')var exec = require('child_process').execvar createHandler = require('github-webhook-handler')var handler = createHandler(&#123; path: '/webhook', secret: '******' &#125;)http.createServer(function (req, res) &#123; handler(req, res, function (err) &#123; res.statusCode = 404 res.end('no such location') &#125;)&#125;).listen(7777)handler.on('error', function (err) &#123; console.error('Error:', err.message)&#125;)handler.on('push', function (event) &#123; console.log('Received a push event for %s to %s', event.payload.repository.name, event.payload.ref) exec('/root/Scripts/sync.sh', function(err, stdout, stderr)&#123; if(err) &#123; console.log('sync server err: ' + stderr) &#125; else &#123; console.log(stdout) &#125; &#125;)&#125;)handler.on('issues', function (event) &#123; console.log('Received an issue event for %s action=%s: #%d %s', event.payload.repository.name, event.payload.action, event.payload.issue.number, event.payload.issue.title)&#125;) 注意 hexo-server.js 中的 sync.sh 填写的是绝对路径。 安装 github-webhook-handler 以及 forever： 12npm install github-webhook-handlernpm install forever -g 在 Github 的仓库设置的 Webhooks 选项中，Payload URL 填写为： 1http://domain.com:7777/webhook 这里的端口7777与上面 hexo-server.js 中设定的端口是一致的，Content type 选择 application/json，秘钥 Secret 自行设置，与上述 js 文件中 ****** 相同。触发事件选择仅 push 的时候即可。之前生成静态文件并更新至 Github 时发现 Webhooks 设置页面最下方的记录中，总出现 1We couldn’t deliver this payload: Service Timeout 的提示，当然外网访问的博客也没有更新，说明是 Github 与阿里云服务器的沟通出了问题。结合之前部署 RStudio 服务器的经历，想起阿里云服务器配备了安全组，所以在阿里云服务器安全组规则设置页面中开放 7777 端口，这样才能正常访问。这里不知道是否可用 Nginx 来做中转，以后再折腾。 利用之前安装的 forever 运行 js 脚本：hexo-server.js1forever start hexo-server.js 当然如果要停止这个脚本: forever stop ***.js. 于是，写完博客，hexo g -d 同步到 Github 仓库，就万事大吉了：Github 接受到这样的一个 push 请求之后向服务器特定端口发送了一个 HTTP POST，服务器接受到这个POST后自动执行 sync.sh，也就是到定位本地仓库/网页目录，从 Github 上拉取最新的网页文件。 更新历史 2017-07-17 修改了部分主题样式，添加部分插件，注意利用 npm 安装插件必须加上 --save 选项！ font-awesome 图标：hexo-tag-fontawesome 字数统计插件 hexo-wordcount，不过最新版的NexT主题已经内置该功能 RSS插件 hexo-generator-feed 本地搜索服务 hexo-generator-searchdb SEO优化 hexo-generator-sitemap，hexo-generator-baidu-sitemap 2017-07-18 发现外网访问服务器速度实在过慢，老实投靠 Github，Coding 进行双线部署，并更新博客为二级域名，在解析上下了点功夫。加之 Coding 可以强制 https 访问，遂抛弃 Github 部署 2017-12-03 增加 \(Mathjax\) 支持。参考: 搭建一个支持LaTEX的hexo博客。然而这里出现了一些意外状况，比如公式的分式的中横线显示偏低，这是不能接受的，首先将主题配置文件中 mathjax 设置为： 1234mathjax: enable: true per_page: true cdn: //cdn.bootcss.com/mathjax/2.7.2/latest.js?config=TeX-MML-AM_CHTML 这末尾的 config=... 极其重要，就是被这玩意儿折腾良久。关键在于公式的渲染方式，在这儿应选 Common HTML 而不是坑爹的 HTML-CSS。 再折腾下文件 themes/next/layout/_third-party/mathjax.swig： mathjax.swig12345678910111213141516MathJax.Hub.Config(&#123; showProcessingMessages: false, messageStyle: "none", tex2jax: &#123; inlineMath: [ ['$','$'], ["\\(","\\)"] ], displayMath: [ ['$$', '$$'], ["\\[", "\\]"] ], processEscapes: true, skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'] &#125;, TeX: &#123; equationNumbers: &#123; autoNumber: 'AMS' &#125;, extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"] &#125;&#125;); 最后，对于 IE 浏览器兼容方面出现问题的解决方案： mathjax.swig12&lt;script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"&gt;&lt;/script&gt;&lt;!-- &lt;script type="text/javascript" src=""&gt;&lt;/script&gt; --&gt; 2017-12-03 再再次更换阵地 – 把博客迁移至 码云 （感觉访问速度更快些） 2017-12-03 再再再次更换阵地 – 又回到码市的怀抱，因为码云不支持自定义域名，做跳转又不清真，我只想好好写个博客 ToT 2017-12-03 实现多端博客同步。这里采用比较暴力但高效的办法：在远程新建两个仓库， 一个私有仓库用户存储源文件（原始 Markdown 文件，各类魔改过的文件等， 将整个本地的 Hexo 目录作为本地仓库），一个公有仓库（用于展示网页）。那么这两个命令就可以手动同步了： 12alias hexopull='git fetch --all &amp;&amp; git reset --hard origin/master &amp;&amp; git pull'alias hexopush='hexo clean &amp;&amp; hexo g -d &amp;&amp; git add -A &amp;&amp; git commit -m "update" &amp;&amp; git push origin master' 2017-12-31 更换 markdown 渲染引擎。 12npm uninstall hexo-renderer-marked --savenpm install hexo-renderer-pandoc --save 2018-07-17 添加脚注插件 hexo-footnotes 2018-11-20 将博客回归至 Github，并以 Netlify 作为持续集成]]></content>
      <categories>
        <category>Development and Deployment</category>
      </categories>
      <tags>
        <tag>Server</tag>
        <tag>Hexo</tag>
        <tag>Nginx</tag>
        <tag>Webhook</tag>
      </tags>
  </entry>
</search>
