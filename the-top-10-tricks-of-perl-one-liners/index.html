<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Merriweather:300,300italic,400,400italic,700,700italic|Philosopher:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Perl," />





  <link rel="alternate" href="/atom.xml" title="Heller 的博客" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="作者: Guest Author 链接: The top 10 tricks of Perl one-liners 来源: Oracle Blogs  I’m a recovering perl hacker. Perl used to be far and away my language of choice">
<meta name="keywords" content="Perl">
<meta property="og:type" content="article">
<meta property="og:title" content="「转」The top 10 tricks of Perl one-liners">
<meta property="og:url" content="http://notes.shinemic.cn/the-top-10-tricks-of-perl-one-liners/index.html">
<meta property="og:site_name" content="Heller 的博客">
<meta property="og:description" content="作者: Guest Author 链接: The top 10 tricks of Perl one-liners 来源: Oracle Blogs  I’m a recovering perl hacker. Perl used to be far and away my language of choice, but these days I’m more likely to wr">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-02-28T13:06:49.516Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="「转」The top 10 tricks of Perl one-liners">
<meta name="twitter:description" content="作者: Guest Author 链接: The top 10 tricks of Perl one-liners 来源: Oracle Blogs  I’m a recovering perl hacker. Perl used to be far and away my language of choice, but these days I’m more likely to wr">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://notes.shinemic.cn/the-top-10-tricks-of-perl-one-liners/"/>





  <title>「转」The top 10 tricks of Perl one-liners | Heller 的博客</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Heller 的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">世界不是非黑即白</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-series">
          <a href="/series/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-envelope"></i> <br />
            
            系列
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sketch">
          <a href="/sketch/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-leaf"></i> <br />
            
            札记
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://notes.shinemic.cn/the-top-10-tricks-of-perl-one-liners/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Heller">
      <meta itemprop="description" content="多做正事少折腾">
      <meta itemprop="image" content="/img/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Heller 的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">「转」The top 10 tricks of Perl one-liners</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-17T11:56:25+08:00">
                <!-- 2018-01-17 -->
                2018-01-17 11:56
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2019-02-28T21:06:49+08:00">
                <!-- 2019-02-28 -->
                2019-02-28 21:06
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tips-and-Tricks/" itemprop="url" rel="index">
                    <span itemprop="name">Tips and Tricks</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/the-top-10-tricks-of-perl-one-liners/" class="leancloud_visitors" data-flag-title="「转」The top 10 tricks of Perl one-liners">
               <span><br></span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  1,555
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  10
                </span>
              

              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>作者: <a href="https://blogs.oracle.com/author/guest-contributor" target="_blank" rel="noopener">Guest Author</a><br>
链接: <a href="https://blogs.oracle.com/ksplice/the-top-10-tricks-of-perl-one-liners" target="_blank" rel="noopener">The top 10 tricks of Perl one-liners</a><br>
来源: <a href="https://blogs.oracle.com/" target="_blank" rel="noopener">Oracle Blogs</a></p>
</blockquote>
<p>I’m a recovering perl hacker. Perl used to be far and away my language of choice, but these days I’m more likely to write new code in Python, largely because far more of my friends and coworkers are comfortable with it.</p>
<a id="more"></a>
<p>I’ll never give up perl for quick one-liners on the command-line or in one-off scripts for munging text, though. Anything that lasts long enough to make it into git somewhere usually gets rewritten in Python, but nothing beats perl for interactive messing with text.</p>
<p>Perl, never afraid of obscure shorthands, has accrued an impressive number of features that help with this use case. I’d like to share some of my favorites that you might not have heard of.</p>
<h2 id="one-liners-primer">One-liners primer</h2>
<p>We’ll start with a brief refresher on the basics of perl one-liners before we begin. The core of any perl one-liner is the <code>-e</code> switch, which lets you pass a snippet of code on the command-line: <code>perl -e 'print "hi\n"'</code> prints <code>"hi"</code> to the console.</p>
<p>The second standard trick to perl one-liners are the <code>-n</code> and <code>-p</code> flags. Both of these make perl put an implicit loop around your program, running it once for each line of input, with the line in the <code>$_</code> variable. <code>-p</code> also adds an implicit print at the end of each iteration.</p>
<p>Both of these use perl’s special <code>ARGV</code> magic file handle internally. What this means is that if there are any files listed on the command-line after your <code>-e</code>, perl will loop over the contents of the files, one at a time. If there aren’t any, it will fall back to looping over standard input.</p>
<p><code>perl -ne 'print if /foo/'</code> acts a lot like <code>grep foo</code>, and <code>perl -pe 's/foo/bar/'</code> replaces foo with bar.</p>
<p>Most of the rest of these tricks assume you’re using either <code>-n</code> or <code>-p</code>, so I won’t mention it every time.</p>
<h2 id="the-top-10-one-liner-tricks">The top 10 one-liner tricks</h2>
<h3 id="trick-1--l">Trick #1: <code>-l</code></h3>
<p>Smart newline processing. Normally, perl hands you entire lines, including a trailing newline. With <code>-l</code>, it will strip the trailing newline off of any lines read, and automatically add a newline to anything you print (including via <code>-p</code>).</p>
<p>Suppose I wanted to strip trailing whitespace from a file. I might naïvely try something like</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -pe <span class="string">'s/\s*$//'</span></span><br></pre></td></tr></table></figure>
<p>The problem, however, is that the line ends with <code>\n</code>, which is whitespace, and so that snippet will also remove all newlines from my file! <code>-l</code> solves the problem, by pulling off the newline before handing my script the line, and then tacking a new one on afterwards:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -lpe <span class="string">'s/\s*$//'</span></span><br></pre></td></tr></table></figure>
<h3 id="trick-2--0">Trick #2: <code>-0</code></h3>
<p>Occasionally, it’s useful to run a script over an entire file, or over larger chunks at once. <code>-0</code> makes <code>-n</code> and <code>-p</code> feed you chunks split on NULL bytes instead of newlines. This is often useful for, e.g. processing the output of find <code>-print0</code>. Furthermore, <code>perl -0777</code> makes perl not do any splitting, and pass entire files to your script in <code>$_</code>.</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">'*~'</span> -<span class="keyword">print</span><span class="number">0</span> | perl -0ne <span class="keyword">unlink</span></span><br></pre></td></tr></table></figure>
<p>Could be used to delete all ~-files in a directory tree, without having to remember how xargs works.</p>
<h3 id="trick-3--i">Trick #3: <code>-i</code></h3>
<p><code>-i</code> tells perl to operate on files in-place. If you use <code>-n</code> or <code>-p</code> with <code>-i</code>, and you pass perl filenames on the command-line, perl will run your script on those files, and then replace their contents with the output. <code>-i</code> optionally accepts an backup suffix as argument; Perl will write backup copies of edited files to names with that suffix added.</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -i.bak -<span class="keyword">ne</span> <span class="string">'print unless /^#/'</span> script.sh</span><br></pre></td></tr></table></figure>
<p>Would strip all whole-line commands from <code>script.sh</code>, but leave a copy of the original in <code>script.sh.bak</code>.</p>
<h3 id="trick-4-the-..-operator">Trick #4: The <code>..</code> operator</h3>
<p>Perl’s <code>..</code> operator is a stateful operator – it remembers state between evaluations. As long as its left operand is false, it returns false; Once the left hand returns true, it starts evaluating the right-hand operand until that becomes true, at which point, on the next iteration it resets to false and starts testing the other operand again.</p>
<p>What does that mean in practice? It’s a range operator: It can be easily used to act on a range of lines in a file. For instance, I can extract all GPG public keys from a file using:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -<span class="keyword">ne</span> <span class="string">'print if /-----BEGIN PGP PUBLIC KEY BLOCK-----/../-----END PGP PUBLIC KEY BLOCK-----/'</span> FILE</span><br></pre></td></tr></table></figure>
<h3 id="trick-5--a">Trick #5: <code>-a</code></h3>
<p><code>-a</code> turns on autosplit mode – perl will automatically split input lines on whitespace into the <code>@F</code> array. If you ever run into any advice that accidentally escaped from 1980 telling you to use awk because it automatically splits lines into fields, this is how you use perl to do the same thing without learning another, even worse, language.</p>
<p>As an example, you could print a list of files along with their link counts using</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l | perl -lane <span class="string">'print "$F[7] $F[1]"'</span></span><br></pre></td></tr></table></figure>
<h3 id="trick-6--f">Trick #6: <code>-F</code></h3>
<p><code>-F</code> is used in conjunction with <code>-a</code>, to choose the delimiter on which to split lines. To print every user in <code>/etc/passwd</code> (which is colon-separated with the user in the first column), we could do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -F: -lane &apos;print $F[0]&apos; /etc/passwd</span><br></pre></td></tr></table></figure>
<h3 id="trick-7-k">Trick #7: <code>\K</code></h3>
<p><code>\K</code> is undoubtedly my favorite little-known-feature of Perl regular expressions. If <code>\K</code> appears in a regex, it causes the regex matcher to drop everything before that point from the internal record of “Which string did this regex match?”. This is most useful in conjunction with <code>s///</code>, where it gives you a simple way to match a long expression, but only replace a suffix of it.</p>
<p>Suppose I want to replace the From: field in an email. We could write something like</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -lape &apos;s/(^From:).*/$1 Nelson Elhage &lt;nelhage\@ksplice.com&gt;/&apos;</span><br></pre></td></tr></table></figure>
<p>But having to parenthesize the right bit and include the <code>$1</code> is annoying and error-prone. We can simplify the regex by using <code>\K</code> to tell perl we won’t want to replace the start of the match:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -lape <span class="string">'s/^From:\K.*/ Nelson Elhage &lt;nelhage\@ksplice.com&gt;/'</span></span><br></pre></td></tr></table></figure>
<h3 id="trick-8-env">Trick #8: <code>$ENV{}</code></h3>
<p>When you’re writing a one-liner using <code>-e</code> in the shell, you generally want to quote it with <code>'</code>, so that dollar signs inside the one-liner aren’t expanded by the shell. But that makes it annoying to use a <code>'</code> inside your one-liner, since you can’t escape a single quote inside of single quotes, in the shell.</p>
<p>Let’s suppose we wanted to print the username of anyone in <code>/etc/passwd</code> whose name included an apostrophe. One option would be to use a standard shell-quoting trick to include the <code>'</code>:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -F: -lane <span class="string">'print $F[0] if $F[4] =~ /'</span><span class="string">"'"</span><span class="string">'/'</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<p>But counting apostrophes and backslashes gets old fast. A better option, in my opinion, is to use the environment to pass the regex into perl, which lets you dodge a layer of parsing entirely:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env re=&quot;&apos;&quot; perl -F: -lane &apos;print $F[0] if $F[4] =~ /$ENV&#123;re&#125;/&apos; /etc/passwd</span><br></pre></td></tr></table></figure>
<p>We use the env command to place the regex in a variable called <code>re</code>, which we can then refer to from the perl script through the <code>%ENV</code> hash. This way is slightly longer, but I find the savings in counting backslashes or quotes to be worth it, especially if you need to end up embedding strings with more than a single metacharacter.</p>
<h3 id="trick-9-begin-and-end">Trick #9: <code>BEGIN</code> and <code>END</code></h3>
<p><code>BEGIN { ... }</code> and <code>END { ... }</code> let you put code that gets run entirely before or after the loop over the lines.</p>
<p>For example, I could sum the values in the second column of a CSV file using:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -F, -lane <span class="string">'$t += $F[1]; END &#123; print $t &#125;'</span></span><br></pre></td></tr></table></figure>
<h3 id="trick-10--mregexpcommon">Trick #10: <code>-MRegexp::Common</code></h3>
<p>Using <code>-M</code> on the command line tells perl to load the given module before running your code. There are thousands of modules available on <code>CPAN</code>, numerous of them potentially useful in one-liners, but one of my favorite for one-liner use is <code>Regexp::Common</code>, which, as its name suggests, contains regular expressions to match numerous commonly-used pieces of data.</p>
<p>The full set of regexes available in <code>Regexp::Common</code> is available in its documentation, but here’s an example of where I might use it:</p>
<p>Neither the ifconfig nor the ip tool that is supposed to replace it provide, as far as I know, an easy way of extracting information for use by scripts. The ifdata program provides such an interface, but isn’t installed everywhere. Using perl and <code>Regexp::Common</code>, however, we can do a pretty decent job of extracing an IP from ips output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip address list eth0 | \</span><br><span class="line">  perl -MRegexp::Common -lne <span class="string">'print $1 if /($RE&#123;net&#125;&#123;IPv4&#125;)/'</span></span><br></pre></td></tr></table></figure>
<p>So, those are my favorite tricks, but I always love learning more. What tricks have you found or invented for messing with perl on the command-line? What’s the most egregious perl “one-liner” you’ve wielded, continuing to tack on statements well after the point where you should have dropped your code into a real script?</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Perl/" rel="tag"><i class="fa fa-tag"></i> Perl</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/how-to-behave-like-master-for-advanced-coder/" rel="next" title="「转」高级程序员装逼指南">
                <i class="fa fa-chevron-left"></i> 「转」高级程序员装逼指南
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/building-vim-from-source/" rel="prev" title="从源码编译 Vim 8">
                从源码编译 Vim 8 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="comments" id="comments">
        <div id="vcomments"></div>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/img/avatar.jpg"
               alt="Heller" />
          <p class="site-author-name" itemprop="name">Heller</p>
           
              <p class="site-description motion-element" itemprop="description">多做正事少折腾</p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">46</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">59</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/michaelHL" target="_blank" title="Github" rel="external nofollow">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/he-liang-69-62" target="_blank" title="知乎" rel="external nofollow">
                  
                    <i class="fa fa-fw fa-delicious"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://music.163.com/#/user/home?id=43058330" target="_blank" title="网易云" rel="external nofollow">
                  
                    <i class="fa fa-fw fa-music"></i>
                  
                  网易云
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友链
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.cnblogs.com/ocean1100" title="木易修" target="_blank"><i class="fa fa-fire"></i> 木易修</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://woyun.ink" title="卧云博客" target="_blank"><i class="fa fa-fire"></i> 卧云博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://cuijiahua.com" title="Jack Cui" target="_blank"><i class="fa fa-fire"></i> Jack Cui</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://seisman.info" title="SeisMan" target="_blank"><i class="fa fa-fire"></i> SeisMan</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://docs.lvrui.io" title="极地瑞雪" target="_blank"><i class="fa fa-fire"></i> 极地瑞雪</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.daxiblog.com" title="大席的博客" target="_blank"><i class="fa fa-fire"></i> 大席的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://kaito-kidd.com" title="Kaito" target="_blank"><i class="fa fa-fire"></i> Kaito</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.deeplearn.me" title="算法之道" target="_blank"><i class="fa fa-fire"></i> 算法之道</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://blog.yasking.org" title="东东's Blog" target="_blank"><i class="fa fa-fire"></i> 东东's Blog</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#one-liners-primer"><span class="nav-number">1.</span> <span class="nav-text">One-liners primer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#the-top-10-one-liner-tricks"><span class="nav-number">2.</span> <span class="nav-text">The top 10 one-liner tricks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#trick-1--l"><span class="nav-number">2.1.</span> <span class="nav-text">Trick #1: -l</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trick-2--0"><span class="nav-number">2.2.</span> <span class="nav-text">Trick #2: -0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trick-3--i"><span class="nav-number">2.3.</span> <span class="nav-text">Trick #3: -i</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trick-4-the-..-operator"><span class="nav-number">2.4.</span> <span class="nav-text">Trick #4: The .. operator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trick-5--a"><span class="nav-number">2.5.</span> <span class="nav-text">Trick #5: -a</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trick-6--f"><span class="nav-number">2.6.</span> <span class="nav-text">Trick #6: -F</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trick-7-k"><span class="nav-number">2.7.</span> <span class="nav-text">Trick #7: \K</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trick-8-env"><span class="nav-number">2.8.</span> <span class="nav-text">Trick #8: $ENV{}</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trick-9-begin-and-end"><span class="nav-number">2.9.</span> <span class="nav-text">Trick #9: BEGIN and END</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trick-10--mregexpcommon"><span class="nav-number">2.10.</span> <span class="nav-text">Trick #10: -MRegexp::Common</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-chevron-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-paper-plane"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Heller</span>

  <div class="theme-info">
    <div class="powered-by"></div>
    <span class="post-count">码了&nbsp;&nbsp58.6k&nbsp;&nbsp;个字</span>
  </div>

  
</div>


<div class="powered-by">
Hosted by <a href="https://pages.coding.me" rel="external nofollow">Coding Pages</a>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io" rel="external nofollow">Hexo</a> 强力驱动
</div>


<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://theme-next.iissnan.com/" rel="external nofollow">
    NexT.Pisces
  </a>
</div>


        <!-- 
 -->
        
      </div>
    </footer>

    <!--  -->

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





<!-- 
 -->




  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("0DK08zbE8Vf43Mb2ckWn379n-gzGzoHsz", "QuwRw2RL89PtuGLFSikuDugr");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  


  

  

</body>
</html>
